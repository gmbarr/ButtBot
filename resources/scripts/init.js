(function(){var e=false,i=false,n=[],t=[];function s(e,i,n){this.scriptFile=e;this.script=i;this.enabled=n;if(e.indexOf("./core/")>-1){this.enabled=true}this.getModuleName=function(){return this.scriptFile.replace(/([a-z]+)\.js$/i,"$1")}}function r(e,i,n){this.scriptFile=e;this.hook=i;this.handler=n}function o(e){Packages.com.gmt2001.Console.out.println(java.util.Objects.toString(e))}function a(){var e,i=function(e){var i=["getClass","equals","notify","class","hashCode","toString","wait","notifyAll"],n;for(n in i){if(i[n]==e){return true}}return false},n=function(e,i){return function(){var n=[$script];for(var t=0;t<arguments.length;t++){n.push(arguments[t])}e[i].save(e,n)}};for(e in $api){if(i(e)){continue}if(typeof $api[e]=="function"){$[e]=n($api,e)}else{$[e]=$api[e]}}}function c(e,i,t){if(!g(e)||i){try{var r=$api.loadScriptR($script,e),a;if(!$.inidb.exists("modules",e)){a=true;$.setIniDbBoolean("modules",e,a)}else{a=$.getIniDbBoolean("modules",e)}n.push(new s(e,r,a));if(!t){o("Loaded module: "+e.replace(/\.\//g,"")+" ("+(a?"Enabled":"Disabled")+")")}}catch(c){o('Failed loading "'+e+'": '+c);if(g("./core/logging.js")){$.logError("init.js",70,"(loadScript, "+e+") "+c)}}}}function l(e,i){if(e.substring($.strlen(e)-1).equalsIgnoreCase("/")){e=e.substring(0,$.strlen(e)-1)}var n=$.findFiles("./scripts/"+e,""),t;for(t=0;t<n.length;t++){if(e.equalsIgnoreCase(".")){if(n[t].equalsIgnoreCase("util")||n[t].equalsIgnoreCase("lang")||n[t].equalsIgnoreCase("init.js")||n[t].equalsIgnoreCase("dev")){continue}}if($.isDirectory("./scripts/"+e+"/"+n[t])){l(e+"/"+n[t],i)}else{c(e+"/"+n[t],false,i)}}}function u(e){var i;for(i in n){if(n[i].scriptFile.equalsIgnoreCase(e)){return i}}return-1}function f(e){var i=u(e);if(i>-1){return n[i].enabled}return false}function g(e){return u(e)>-1}function d(e){var i=u(e);if(i>-1){return n[i]}return null}function p(e,i){var n;for(n in t){if(t[n].scriptFile.equalsIgnoreCase(e)&&t[n].hook.equalsIgnoreCase(i)){return n}}return-1}function m(e,i){var n=$script.getPath().replace("\\","/").replace("./scripts/",""),s=p(n,e);if(s>-1){t[s].handler=i}else{t.push(new r(n,e,i))}}function h(e){var i=$script.getPath().replace("\\","/").replace("./scripts/",""),n=p(i,e);if(n>-1){t.splice(n,1)}}function C(e,i,n){var s;for(s in t){if(t[s].hook.equalsIgnoreCase(e)&&(f(t[s].scriptFile)||n)){try{t[s].handler(i)}catch(r){$.logError("init.js",173,"(hook.call, "+e+", "+t[s].scriptFile+") "+r)}}}}function w(){a();c("./core/misc.js");c("./core/jsTimers.js");c("./core/updates.js");c("./core/fileSystem.js");c("./core/lang.js");c("./core/logging.js");c("./core/commandRegister.js");c("./core/whisper.js");c("./core/chatModerator.js");c("./core/commandCoolDown.js");c("./core/gameMessages.js");c("./core/patternDetector.js");c("./core/permissions.js");c("./core/streamInfo.js");c("./core/pointSystem.js");c("./core/ranks.js");c("./core/timeSystem.js");$.logEvent("init.js",285,"Core loaded, initializing bot...");l(".");$api.on($script,"ircChannelMessage",function(e){o($.username.resolve(e.getSender().toLowerCase(),e.getTags())+": "+e.getMessage());if(e.getSender().equalsIgnoreCase("jtv")||e.getSender().equalsIgnoreCase("twitchnotify")){C("ircPrivateMessage",e,false)}else{C("ircChannelMessage",e,false)}});$api.on($script,"ircJoinComplete",function(i){e=true;$.channel=i.getChannel()});$api.on($script,"ircChannelUserMode",function(n){if(!e){return}if(n.getChannel().getName().equalsIgnoreCase($.channel.getName())){if(n.getUser().equalsIgnoreCase($.botName)&&n.getMode().equalsIgnoreCase("o")){if(n.getAdd()){if(!i){$.consoleLn($.username.resolve($.botName)+" is ready to receive commands!")}i=true}}}});$api.on($script,"command",function(e){var i=e.getSender().toLowerCase(),n=e.getTags(),t=e.getCommand().toLowerCase(),s,r;if(!$.isModv3(i,n)&&$.commandPause.isPaused()){return}if($.inidb.exists("aliases",t)){e.setCommand($.inidb.get("aliases",t))}r=e.getCommand().toLowerCase();if(!$.commandExists(r)){return}if(!$.permCom(i,r)){$.say($.whisperPrefix(i)+$.lang.get("cmd.noperm",r));return}if(!$.isAdmin(i)){s=$.coolDown.get(r,i);if(s>0){return}}if(f("./core/pointSystem.js")&&!$.isModv3(i,e.getTags())&&$.inidb.exists("pricecom",r)){if($.getUserPoints(i)<$.getCommandPrice(r)){$.say($.whisperPrefix(i)+$.lang.get("cmd.needpoints",$.getPointsString($.inidb.get("pricecom",r))));return}if(parseInt($.inidb.get("pricecom",r))>0){$.inidb.decr("points",i,$.inidb.get("pricecom",r))}}C("command",e,false)});$api.on($script,"consoleInput",function(e){C("consoleInput",e,true)});$api.on($script,"twitchFollow",function(e){C("twitchFollow",e,true)});$api.on($script,"twitchUnfollow",function(e){C("twitchUnfollow",e,true)});$api.on($script,"twitchFollowsInitialized",function(e){C("twitchFollowsInitialized",e,true)});$api.on($script,"twitchHosted",function(e){C("twitchHosted",e,true)});$api.on($script,"twitchUnhosted",function(e){C("twitchUnhosted",e,true)});$api.on($script,"twitchHostsInitialized",function(e){C("twitchHostsInitialized",e,true)});$api.on($script,"twitchSubscribe",function(e){C("twitchSubscribe",e,true)});$api.on($script,"twitchUnsubscribe",function(e){C("twitchUnsubscribe",e,true)});$api.on($script,"twitchSubscribesInitialized",function(e){C("twitchSubscribesInitialized",e,true)});$api.on($script,"ircChannelJoin",function(e){C("ircChannelJoin",e,true)});$api.on($script,"ircChannelLeave",function(e){C("ircChannelLeave",e,true)});$api.on($script,"ircChannelUserMode",function(e){C("ircChannelUserMode",e,true)});$api.on($script,"ircConnectComplete",function(e){C("ircConnectComplete",e,true)});$api.on($script,"ircJoinComplete",function(e){C("ircJoinComplete",e,true)});$api.on($script,"ircPrivateMessage",function(e){C("ircPrivateMessage",e,false)});$api.on($script,"musicPlayerConnect",function(e){C("musicPlayerConnect",e,false)});$api.on($script,"musicPlayerCurrentId",function(e){C("musicPlayerCurrentId",e,false)});$api.on($script,"musicPlayerCurrentVolume",function(e){C("musicPlayerCurrentVolume",e,false)});$api.on($script,"musicPlayerDisconnect",function(e){C("musicPlayerDisconnect",e,false)});$api.on($script,"musicPlayerState",function(e){C("musicPlayerState",e,false)});$.logEvent("init.js",534,"Bot locked & loaded!");$.consoleLn("Bot locked & loaded!");$api.on($script,"command",function(e){var i=e.getSender().toLowerCase(),t=$.username.resolve(i,e.getTags()),s=e.getCommand(),r=e.getArgs(),o=r[0],a,l;if(s.equalsIgnoreCase("reconnect")){if(!$.isModv3(i,e.getTags())){$.say($.whisperPrefix(i)+$.modMsg);return}$.logEvent("init.js",354,t+" requested a reconnect!");$.connmgr.reconnectSession($.hostname);$.say($.lang.get("init.reconnect"))}if(s.equalsIgnoreCase("module")){if(!$.isAdmin(i)){$.say($.whisperPrefix(i)+$.adminMsg);return}if(!o){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}if(o.equalsIgnoreCase("list")){a=[];for(l in n){if(n[l].enabled){a.push(n[l].getModuleName())}}$.say($.whisperPrefix(i)+$.lang.get("init.module.list",a.length,a.join(", ")))}if(o.equalsIgnoreCase("enable")){a=r[1];if(!a){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}if(a.indexOf("./core/")>-1||a.indexOf("./lang/")>-1){return}l=u(a);if(l>-1){$.logEvent("init.js",393,t+' enabled module "'+n[l].scriptFile+'"');n[l].enabled=true;$.setIniDbBoolean("modules",n[l].scriptFile,true);c(n[l].scriptFile,true);C("initReady",null,true);$.say($.whisperPrefix(i)+$.lang.get("init.module.enabled",n[l].getModuleName()))}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.404"))}}if(o.equalsIgnoreCase("disable")){a=r[1];if(!a){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}if(a.indexOf("./core/")>-1||a.indexOf("./lang/")>-1){return}l=u(a);if(l>-1){$.logEvent("init.js",393,t+' disabled module "'+n[l].scriptFile+'"');n[l].enabled=false;$.setIniDbBoolean("modules",n[l].scriptFile,false);$.say($.whisperPrefix(i)+$.lang.get("init.module.disabled",n[l].getModuleName()))}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.404"))}}if(o.equalsIgnoreCase("status")){a=r[1];if(!a){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}l=u(a);if(l>1){if(n[l].enabled){$.say($.whisperPrefix(i)+$.lang.get("init.module.check.enabled",n[l].getModuleName()))}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.check.disabled",n[l].getModuleName()))}}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.404"))}}}if(s.equalsIgnoreCase("chat")){$.say(e.getArguments())}});$.registerChatCommand("./init.js","chat",1);$.registerChatCommand("./init.js","module",1);$.registerChatCommand("./init.js","reconnect",2);C("initReady",null,true)}$.consoleLn=o;$.bind=m;$.unbind=h;$.bot={loadScript:c,loadScriptRecursive:l,isModuleLoaded:g,isModuleEnabled:f,getModule:d};w()})();
