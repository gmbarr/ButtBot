!function(){function e(e,s){$.inidb.set("quotes",e,JSON.stringify([s[0]+"",s[1]+"",s[2]+"",s[3]+""]))}function s(e,s){var t=$.inidb.GetKeyList("quotes","").length,i=""!=$.getGame($.channelName)?$.getGame($.channelName):"Some Game";return $.inidb.set("quotes",t,JSON.stringify([e,s,$.systemTime(),i+""])),t}function t(e){var s,t,i=[];if($.inidb.exists("quotes",e)){$.inidb.del("quotes",e),s=$.inidb.GetKeyList("quotes","");for(t in s)i.push($.inidb.get("quotes",s[t])),$.inidb.del("quotes",s[t]);for(t in i)$.inidb.set("quotes",t,i[t]);return i.length?i.length:0}return-1}function i(e){var s;return(!e||isNaN(e))&&(e=$.rand($.inidb.GetKeyList("quotes","").length-1)),$.inidb.exists("quotes",e)?(s=JSON.parse($.inidb.get("quotes",e)),s.push(e),s):[]}$.bind("command",function(a){var n,o,u=a.getSender(),r=a.getCommand(),g=a.getArgs();if(r.equalsIgnoreCase("editquote")){if(g.length<3)return void $.say($.whisperPrefix(u)+$.lang.get("quotesystem.edit.usage"));n=i(g[0]),n.length>0?g[1].equalsIgnoreCase("user")?($.say($.whisperPrefix(u)+$.lang.get("quotesystem.edit.user.success",g[0],g[2])),n[0]=g[2],e(g[0],n)):g[1].equalsIgnoreCase("game")?($.say($.whisperPrefix(u)+$.lang.get("quotesystem.edit.game.success",g[0],g.splice(2).join(" "))),n[1]=g.splice(2).join(" "),e(g[0],n)):g[1].equalsIgnoreCase("quote")?($.say($.whisperPrefix(u)+$.lang.get("quotesystem.edit.quote.success",g[0],g.splice(2).join(" "))),n[2]=g.splice(2).join(" "),e(g[0],n)):$.say($.whisperPrefix(u)+$.lang.get("quotesystem.edit.usage")):$.say($.whisperPrefix(u)+$.lang.get("quotesystem.edit.404"))}if(r.equalsIgnoreCase("addquote")){if(!isModv3(u,a.getTags())&&!$.isOnline($.channelName))return void $.say($.whisperPrefix(u)+$.lang.get("quotesystem.add.offline"));if(g.length<1)return void $.say($.whisperPrefix(u)+$.lang.get("quotesystem.add.usage"));n=g.splice(0).join(" "),$.say($.lang.get("quotesystem.add.success",$.username.resolve(u),s($.username.resolve(u)+"",n)))}if(r.equalsIgnoreCase("delquote")){if(!g[0]||isNaN(g[0]))return void $.say($.whisperPrefix(u)+$.lang.get("quotesystem.del.usage"));var d;$.say((d=t(g[0]))<0?$.whisperPrefix(u)+$.lang.get("quotesystem.del.404",g[0]):$.whisperPrefix(u)+$.lang.get("quotesystem.del.success",g[0],d))}if(r.equalsIgnoreCase("quote")&&(n=i(g[0]),n.length>0?(o=$.inidb.exists("settings","quoteMessage")?$.inidb.get("settings","quoteMessage"):$.lang.get("quotesystem.get.success"),o=o.replace("(id)",5==n.length?""+n[4]:""+n[3]).replace("(quote)",n[1]).replace("(user)",$.resolveRank(n[0])).replace("(game)",5==n.length?n[3]:"Some Game").replace("(date)",$.getLocalTimeString("dd-MM-yyyy",parseInt(n[2]))),$.say(o)):$.say($.whisperPrefix(u)+$.lang.get("quotesystem.get.404",void 0!==g[0]?g[0]:""))),r.equalsIgnoreCase("quotemessage")){if(!g[0])return void $.say($.whisperPrefix(u)+$.lang.get("quotesystem.quotemessage.usage"));o=g.splice(0).join(" "),$.inidb.set("settings","quoteMessage",o),$.say($.whisperPrefix(u)+$.lang.get("quotesystem.quotemessage.success"))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/quoteSystem.js")&&($.registerChatCommand("./systems/quoteSystem.js","addquote",7),$.registerChatCommand("./systems/quoteSystem.js","delquote",2),$.registerChatCommand("./systems/quoteSystem.js","editquote",2),$.registerChatCommand("./systems/quoteSystem.js","quote"),$.registerChatCommand("./systems/quoteSystem.js","quotemessage",1))})}();
