!function(){function e(e){return $.inidb.exists("points",e)?parseInt($.inidb.get("points",e)):0}function t(e){return 1==parseInt(e)?e+" "+m:e+" "+l}function s(e){e&&$.commandExists(e.toLowerCase())&&"points"!=e.toLowerCase()&&"point"!=e.toLowerCase()&&$.unregisterChatCommand(e.toLowerCase()),$.commandExists(m.toLowerCase())||e||($.registerChatCommand("./systems/pointSystem.js",m.toLowerCase(),7),$.registerChatSubcommand(m.toLowerCase(),"add",1),$.registerChatSubcommand(m.toLowerCase(),"take",1),$.registerChatSubcommand(m.toLowerCase(),"set",1),$.registerChatSubcommand(m.toLowerCase(),"all",1),$.registerChatSubcommand(m.toLowerCase(),"setname",1),$.registerChatSubcommand(m.toLowerCase(),"setgain",1),$.registerChatSubcommand(m.toLowerCase(),"setofflinegain",1),$.registerChatSubcommand(m.toLowerCase(),"setinterval",1),$.registerChatSubcommand(m.toLowerCase(),"user",7)),$.commandExists(l.toLowerCase())||e||($.registerChatCommand("./systems/pointSystem.js",l.toLowerCase(),7),$.registerChatSubcommand(l.toLowerCase(),"add",1),$.registerChatSubcommand(l.toLowerCase(),"take",1),$.registerChatSubcommand(l.toLowerCase(),"set",1),$.registerChatSubcommand(l.toLowerCase(),"all",1),$.registerChatSubcommand(l.toLowerCase(),"setname",1),$.registerChatSubcommand(l.toLowerCase(),"setgain",1),$.registerChatSubcommand(l.toLowerCase(),"setofflinegain",1),$.registerChatSubcommand(l.toLowerCase(),"setinterval",1),$.registerChatSubcommand(l.toLowerCase(),"user",7))}function i(){var e,t,s,i=$.systemTime(),g=[];if($.bot.isModuleEnabled("./systems/pointSystem.js")){if($.isOnline($.channelName)){if(!(a>0&&i>=p+6e4*a))return;t=n}else{if(!(o>0&&i>=p+6e4*o))return;t=r}for(s in $.users)e=$.users[s][0].toLowerCase(),$.isOnline($.channelName)?$.inidb.exists("grouppoints",$.getUserGroupId(e))&&(t=parseInt($.inidb.get("grouppoints",$.getUserGroupId(e)))<0?n:parseInt($.inidb.get("grouppoints",$.getUserGroupId(e)))):$.inidb.exists("grouppointsoffline",$.getUserGroupId(e))&&(t=parseInt($.inidb.get("grouppointsoffline",$.getUserGroupId(e)))<0?r:parseInt($.inidb.get("grouppointsoffline",$.getUserGroupId(e)))),$.bot.isModuleEnabled("./handlers/gameWispHandler.js")&&0!=$.getTierData(e,"bonuspoints")&&(t+=Math.floor(t*($.getTierData(e,"bonuspoints")/100))),$.inidb.incr("points",e,t),g.push(e);$.log("pointSystem","Executed "+l+" payouts. Users: "+(g.length>0?g.join(", "):"none")),p=i}}var n=($.getIniDbBoolean("pointSettings","pointsTimedGain")?$.getIniDbBoolean("pointSettings","pointsTimedGain"):!0,$.inidb.exists("pointSettings","onlineGain")?parseInt($.inidb.get("pointSettings","onlineGain")):1),r=$.inidb.exists("pointSettings","offlineGain")?parseInt($.inidb.get("pointSettings","offlineGain")):1,a=$.inidb.exists("pointSettings","onlinePayoutInterval")?parseInt($.inidb.get("pointSettings","onlinePayoutInterval")):10,o=$.inidb.exists("pointSettings","offlinePayoutInterval")?parseInt($.inidb.get("pointSettings","offlinePayoutInterval")):0,g=$.getIniDbBoolean("pointSettings","modPointsPermToggle")?$.getIniDbBoolean("pointSettings","modPointsPermToggle"):!1,p=0,m=$.inidb.exists("pointSettings","pointNameSingle")?$.inidb.get("pointSettings","pointNameSingle"):"Point",l=$.inidb.exists("pointSettings","pointNameMultiple")?$.inidb.get("pointSettings","pointNameMultiple"):"Points";$.bind("command",function(i){var p,u,d,f=i.getSender().toLowerCase(),y=$.username.resolve(f,i.getTags()),C=i.getCommand(),h=i.getArgs(),c=h[0],w=h[1],b=h[2];if(C.equalsIgnoreCase("points")||C.equalsIgnoreCase("point")||C.equalsIgnoreCase(l)||C.equalsIgnoreCase(m))if(c)if(c.equalsIgnoreCase("user")){if(!w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.user.usage"));if(u=(w+"").toLowerCase(),!$.user.isKnown(u))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",u));$.say($.whisperPrefix(f)+$.lang.get("pointsystem.user.success",$.resolveRank(u),$.getPointsString($.getUserPoints(u))))}else if(c.equalsIgnoreCase("add")){if(w=(w+"").toLowerCase(),b=parseInt(b),isNaN(b))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(0>b)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.error.negative",l));$.user.isKnown(w)&&($.inidb.incr("points",w,b),$.say($.lang.get("pointsystem.add.success",$.getPointsString(b),$.username.resolve(w),$.getPointsString($.getUserPoints(w)))))}else if(c.equalsIgnoreCase("take")){if(w=(w+"").toLowerCase(),b=parseInt(b),isNaN(b))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.take.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(b>$.getUserPoints(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.take.error.toomuch",y,l));$.inidb.decr("points",w,b),$.say($.lang.get("pointsystem.take.success",$.getPointsString(b),$.username.resolve(w),$.getPointsString($.getUserPoints(w))))}else if(c.equalsIgnoreCase("set")){if(w=(w+"").toLowerCase(),b=parseInt(b),isNaN(b))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.setbalance.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(0>b)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.setbalance.error.negative",l));$.inidb.set("points",w,b),$.say($.lang.get("pointsystem.setbalance.success",m,$.username.resolve(w),$.getPointsString($.getUserPoints(w))))}else if(c.equalsIgnoreCase("all")){if(!w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.all.usage"));if(w=parseInt(w),0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.error.negative",l));for(d in $.users)$.inidb.incr("points",$.users[d][0].toLowerCase(),w);$.say($.lang.get("pointsystem.add.all.success",$.getPointsString(w)))}else if(c.equalsIgnoreCase("setname")){if("single"==w&&b)return p=m,m=b,$.inidb.set("pointSettings","pointNameSingle",m),s(p),s(),void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.single.success",p,m));if("multiple"==w&&b)return p=l,l=b,$.inidb.set("pointSettings","pointNameMultiple",l),s(p),s(),void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.multiple.success",p,l));if("delete"==w)return $.inidb.del("pointSettings","pointNameSingle"),$.inidb.del("pointSettings","pointNameMultiple"),s(m),s(l),m="Point",l="Points",void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.delete"));$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.usage"))}else if(c.equalsIgnoreCase("setgain")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.error.negative",l));n=w,$.inidb.set("pointSettings","onlineGain",n),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.success",m,$.getPointsString(n),a))}else if(c.equalsIgnoreCase("setofflinegain")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.offline.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.error.negative",l));r=w,$.inidb.set("pointSettings","offlineGain",r),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.offline.success",m,$.getPointsString(r),o))}else if(c.equalsIgnoreCase("setinterval")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.error.negative",l));a=w,$.inidb.set("pointSettings","onlinePayoutInterval",a),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.success",m,a))}else if(c.equalsIgnoreCase("setofflineinterval")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.offline.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.error.negative",l));o=w,$.inidb.set("pointSettings","offlinePayoutInterval",o),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.offline.success",m,o))}else c.equalsIgnoreCase("modpermtoggle")?(g=!g,$.setIniDbBoolean("pointSettings","modPointsPermToggle",g),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.modpermtoggle.success",g?"moderator":"administrator"))):$.say($.whisperPrefix(f)+$.lang.get("pointsystem.usage.invalid","!"+C));else 0==$.getUserPoints(f)?$.say($.whisperPrefix(f)+$.lang.get("pointsystem.get.self.nopoints",l)):$.say($.whisperPrefix(f)+$.lang.get("pointsystem.get.self.withtime",$.hasRank(f)?"the "+$.getRank(f):"",$.getPointsString($.getUserPoints(f)),$.getUserTimeString(f)));if(C.equalsIgnoreCase("makeitrain")){if(!$.isAdmin(f))return void $.say($.whisperPrefix(f)+$.adminMsg);if(c=parseInt(c),isNaN(c))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.makeitrain.usage"));if(1>c)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.makeitrain.error.negative",l));for(d in $.users){var S=$.randRange(1,c);p=[],$.inidb.incr("points",$.users[d][0].toLowerCase(),S),$.users[d][0].equalsIgnoreCase($.botName)||p.push($.username.resolve($.users[d][0])+": "+$.getPointsString(S))}p.length>0&&$.say($.lang.get("pointsystem.makeitrain.success",y,l,p.join(", ")))}if(C.equalsIgnoreCase("gift")){if(!h[0]||!h[1])return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.usage"));if(parseInt(h[1])>e(f))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.shortpoints"));if(!$.user.isKnown(h[0].toLowerCase()))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.404"));$.inidb.incr("points",h[0].toLowerCase(),parseInt(h[1])),$.inidb.decr("points",f,parseInt(h[1])),$.say($.lang.get("pointsystem.gift.success",$.username.resolve(f),t(parseInt(h[1])),$.username.resolve(h[0])))}}),setInterval(function(){i()},6e4),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/pointSystem.js")&&($.registerChatCommand("./systems/pointSystem.js","makeitrain",2),$.registerChatCommand("./systems/pointSystem.js","points",7),$.registerChatCommand("./systems/pointSystem.js","point",7),$.registerChatCommand("./systems/pointSystem.js","gift",7),$.registerChatSubcommand("points","add",1),$.registerChatSubcommand("points","take",1),$.registerChatSubcommand("points","set",1),$.registerChatSubcommand("points","all",1),$.registerChatSubcommand("points","setname",1),$.registerChatSubcommand("points","setgain",1),$.registerChatSubcommand("points","setofflinegain",1),$.registerChatSubcommand("points","setinterval",1),$.registerChatSubcommand("points","user",7),s())}),$.pointNameSingle=m,$.pointNameMultiple=l,$.getUserPoints=e,$.getPointsString=t}();
