!function(){function e(e){return $.inidb.exists("points",e)?parseInt($.inidb.get("points",e)):0}function t(e){return 1==parseInt(e)?e+" "+p:e+" "+l}function s(e){e&&$.commandExists(e.toLowerCase())&&"points"!=e.toLowerCase()&&"point"!=e.toLowerCase()&&$.unregisterChatCommand(e.toLowerCase()),$.commandExists(p.toLowerCase())||e||($.registerChatCommand("./systems/pointSystem.js",p.toLowerCase(),7),$.registerChatSubcommand(p.toLowerCase(),"add",1),$.registerChatSubcommand(p.toLowerCase(),"take",1),$.registerChatSubcommand(p.toLowerCase(),"set",1),$.registerChatSubcommand(p.toLowerCase(),"all",1),$.registerChatSubcommand(p.toLowerCase(),"setname",1),$.registerChatSubcommand(p.toLowerCase(),"setgain",1),$.registerChatSubcommand(p.toLowerCase(),"setofflinegain",1),$.registerChatSubcommand(p.toLowerCase(),"setinterval",1),$.registerChatSubcommand(p.toLowerCase(),"user",7)),$.commandExists(l.toLowerCase())||e||($.registerChatCommand("./systems/pointSystem.js",l.toLowerCase(),7),$.registerChatSubcommand(l.toLowerCase(),"add",1),$.registerChatSubcommand(l.toLowerCase(),"take",1),$.registerChatSubcommand(l.toLowerCase(),"set",1),$.registerChatSubcommand(l.toLowerCase(),"all",1),$.registerChatSubcommand(l.toLowerCase(),"setname",1),$.registerChatSubcommand(l.toLowerCase(),"setgain",1),$.registerChatSubcommand(l.toLowerCase(),"setofflinegain",1),$.registerChatSubcommand(l.toLowerCase(),"setinterval",1),$.registerChatSubcommand(l.toLowerCase(),"user",7))}function i(){var e,t,s,i=$.systemTime(),g=[];if($.bot.isModuleEnabled("./systems/pointSystem.js")){if($.isOnline($.channelName)){if(!(a>0&&i>=m+6e4*a))return;t=n}else{if(!(o>0&&i>=m+6e4*o))return;t=r}for(s in $.users)e=$.users[s][0].toLowerCase(),$.isOnline($.channelName)?$.inidb.exists("grouppoints",$.getUserGroupId(e))&&(t=parseInt($.inidb.get("grouppoints",$.getUserGroupId(e)))<0?n:parseInt($.inidb.get("grouppoints",$.getUserGroupId(e)))):$.inidb.exists("grouppointsoffline",$.getUserGroupId(e))&&(t=parseInt($.inidb.get("grouppointsoffline",$.getUserGroupId(e)))<0?r:parseInt($.inidb.get("grouppointsoffline",$.getUserGroupId(e)))),$.bot.isModuleEnabled("./handlers/gameWispHandler.js")&&0!=$.getTierData(e,"bonuspoints")&&(t+=Math.floor(t*($.getTierData(e,"bonuspoints")/100))),$.inidb.incr("points",e,t),g.push(e);$.log("pointSystem","Executed "+l+" payouts. Users: "+(g.length>0?g.join(", "):"none")),m=i}}var n=($.getSetIniDbBoolean("pointSettings","pointsTimedGain",!0),$.getSetIniDbNumber("pointSettings","onlineGain",1)),r=$.getSetIniDbNumber("pointSettings","offlineGain",1),a=$.getSetIniDbNumber("pointSettings","onlinePayoutInterval",10),o=$.getSetIniDbNumber("pointSettings","offlinePayoutInterval",0),g=$.getSetIniDbBoolean("pointSettings","modPointsPermToggle",!1),m=0,p=$.getSetIniDbString("pointSettings","pointNameSingle","Point"),l=$.getSetIniDbString("pointSettings","pointNameMultiple","Points");$.bind("command",function(i){var m,u,d,f=i.getSender().toLowerCase(),y=$.username.resolve(f,i.getTags()),C=i.getCommand(),h=i.getArgs(),c=h[0],w=h[1],S=h[2];if(C.equalsIgnoreCase("points")||C.equalsIgnoreCase("point")||C.equalsIgnoreCase(l)||C.equalsIgnoreCase(p))if(c)if(c.equalsIgnoreCase("user")){if(!w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.user.usage"));if(u=(w+"").toLowerCase(),!$.user.isKnown(u))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",u));$.say($.whisperPrefix(f)+$.lang.get("pointsystem.user.success",$.resolveRank(u),$.getPointsString($.getUserPoints(u))))}else if(c.equalsIgnoreCase("add")){if(w=(w+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(0>S)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.error.negative",l));$.user.isKnown(w)&&($.inidb.incr("points",w,S),$.say($.lang.get("pointsystem.add.success",$.getPointsString(S),$.username.resolve(w),$.getPointsString($.getUserPoints(w)))))}else if(c.equalsIgnoreCase("take")){if(w=(w+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.take.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(S>$.getUserPoints(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.take.error.toomuch",y,l));$.inidb.decr("points",w,S),$.say($.lang.get("pointsystem.take.success",$.getPointsString(S),$.username.resolve(w),$.getPointsString($.getUserPoints(w))))}else if(c.equalsIgnoreCase("set")){if(w=(w+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.setbalance.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(0>S)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.setbalance.error.negative",l));$.inidb.set("points",w,S),$.say($.lang.get("pointsystem.setbalance.success",p,$.username.resolve(w),$.getPointsString($.getUserPoints(w))))}else if(c.equalsIgnoreCase("all")){if(!w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.all.usage"));if(w=parseInt(w),0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.error.negative",l));for(d in $.users)$.inidb.incr("points",$.users[d][0].toLowerCase(),w);$.say($.lang.get("pointsystem.add.all.success",$.getPointsString(w)))}else if(c.equalsIgnoreCase("setname")){if("single"==w&&S)return m=p,p=S,$.inidb.set("pointSettings","pointNameSingle",p),s(m),s(),void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.single.success",m,p));if("multiple"==w&&S)return m=l,l=S,$.inidb.set("pointSettings","pointNameMultiple",l),s(m),s(),void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.multiple.success",m,l));if("delete"==w)return $.inidb.del("pointSettings","pointNameSingle"),$.inidb.del("pointSettings","pointNameMultiple"),s(p),s(l),p="Point",l="Points",void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.delete"));$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.usage"))}else if(c.equalsIgnoreCase("setgain")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.error.negative",l));n=w,$.inidb.set("pointSettings","onlineGain",n),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.success",p,$.getPointsString(n),a))}else if(c.equalsIgnoreCase("setofflinegain")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.offline.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.error.negative",l));r=w,$.inidb.set("pointSettings","offlineGain",r),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.offline.success",p,$.getPointsString(r),o))}else if(c.equalsIgnoreCase("setinterval")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.error.negative",l));a=w,$.inidb.set("pointSettings","onlinePayoutInterval",a),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.success",p,a))}else if(c.equalsIgnoreCase("setofflineinterval")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.offline.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.error.negative",l));o=w,$.inidb.set("pointSettings","offlinePayoutInterval",o),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.offline.success",p,o))}else c.equalsIgnoreCase("modpermtoggle")?(g=!g,$.setIniDbBoolean("pointSettings","modPointsPermToggle",g),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.modpermtoggle.success",g?"moderator":"administrator"))):$.say($.whisperPrefix(f)+$.lang.get("pointsystem.usage.invalid","!"+C));else 0==$.getUserPoints(f)?$.say($.whisperPrefix(f)+$.lang.get("pointsystem.get.self.nopoints",l)):$.say($.whisperPrefix(f)+$.lang.get("pointsystem.get.self.withtime",$.hasRank(f)?"the "+$.getRank(f):"",$.getPointsString($.getUserPoints(f)),$.getUserTimeString(f)));if(C.equalsIgnoreCase("makeitrain")){if(!$.isAdmin(f))return void $.say($.whisperPrefix(f)+$.adminMsg);if(c=parseInt(c),isNaN(c))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.makeitrain.usage"));if(1>c)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.makeitrain.error.negative",l));for(d in $.users){var b=$.randRange(1,c);m=[],$.inidb.incr("points",$.users[d][0].toLowerCase(),b),$.users[d][0].equalsIgnoreCase($.botName)||m.push($.username.resolve($.users[d][0])+": "+$.getPointsString(b))}m.length>0&&$.say($.lang.get("pointsystem.makeitrain.success",y,l,m.join(", ")))}if(C.equalsIgnoreCase("gift")){if(!h[0]||!h[1])return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.usage"));if(parseInt(h[1])>e(f))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.shortpoints"));if(!$.user.isKnown(h[0].toLowerCase()))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.404"));if(parseInt(h[1])<=0)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.err.negative",l));$.inidb.incr("points",h[0].toLowerCase(),parseInt(h[1])),$.inidb.decr("points",f,parseInt(h[1])),$.say($.lang.get("pointsystem.gift.success",$.username.resolve(f),t(parseInt(h[1])),$.username.resolve(h[0])))}}),setInterval(function(){i()},6e4),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/pointSystem.js")&&($.registerChatCommand("./systems/pointSystem.js","makeitrain",2),$.registerChatCommand("./systems/pointSystem.js","points",7),$.registerChatCommand("./systems/pointSystem.js","point",7),$.registerChatCommand("./systems/pointSystem.js","gift",7),$.registerChatSubcommand("points","add",1),$.registerChatSubcommand("points","take",1),$.registerChatSubcommand("points","set",1),$.registerChatSubcommand("points","all",1),$.registerChatSubcommand("points","setname",1),$.registerChatSubcommand("points","setgain",1),$.registerChatSubcommand("points","setofflinegain",1),$.registerChatSubcommand("points","setinterval",1),$.registerChatSubcommand("points","user",7),s())}),$.pointNameSingle=p,$.pointNameMultiple=l,$.getUserPoints=e,$.getPointsString=t}();
