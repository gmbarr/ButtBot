!function(){function e(e,t){var i,s,n=e.getSender();e.getArgs();if(r)return void $.say($.whisperPrefix(n)+$.lang.get("betsystem.err.bet.opened"));if(t.length<2)return void $.say($.whisperPrefix(n)+$.lang.get("betsystem.err.options"));for(s=0;s<t.length;s++)a.push(t[s].toLowerCase().trim());i=a.join(" vs "),r=!0,$.say($.lang.get("betsystem.opened",i,$.pointNameMultiple))}function t(e,t,i){var n,m,d=(t.getArgs(),i.toLowerCase()),b=0,u=0,p="",l=0,f=0;if(!r)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.bet.closed"));if(!d)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.win.option"));if(!$.list.contains(a,d))return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.option.404"));r=!1;for(m in g)n=g[m],n.option.equalsIgnoreCase(d)&&(l=n.amount);for(m in g)f++,n=g[m],n.option.equalsIgnoreCase(d)&&(u=o/l,u>0&&(p.length>0&&(p+=", "),p=m));if(s>f){for(m in g)n=g[m],$.inidb.incr("points",m,n.amount);return void $.say($.lang.get("betsystem.not.enough.ppl"))}if(0==l)return void $.say($.lang.get("betsystem.closed.404"));if(0>=o){for(m in g)n=g[m],$.inidb.incr("points",m,n.amount);return void $.say($.lang.get("betsystem.err.points.refunded"))}for(m in g)n=g[m],n.option.equalsIgnoreCase(d)&&(b=n.amount/l,$.inidb.incr("points",m,o*b));$.say($.lang.get("betsystem.closed",d,$.getPointsString(o*b))),o=0,l=0,p=""}var s=$.inidb.exists("betSettings","betMinimum")?parseInt($.inidb.get("betSettings","betMinimum")):0,n=$.inidb.exists("betSettings","betMaximum")?parseInt($.inidb.get("betSettings","betMaximum")):50,r=!1,o=0,a=[],g=[];$.bind("command",function(m){var d=m.getSender(),b=m.getCommand(),u=(m.getArguments().trim(),m.getArgs()),p=u[0],l=u[1],f=u.slice(1);if(b.equalsIgnoreCase("bet")){if(p.equalsIgnoreCase("open"))return $.isModv3(d,m.getTags())?void e(m,f):void $.say($.whisperPrefix(d)+$.modMsg);if(p.equalsIgnoreCase("close"))return $.isModv3(d,m.getTags())?void t(d,m,l):void $.say($.whisperPrefix(d)+$.modMsg);if(p.equalsIgnoreCase("setminimum"))return $.isModv3(d,m.getTags())?l?(s=parseInt(l),$.inidb.set("betSettings","betMinimum",s),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min",s,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(p.equalsIgnoreCase("setmaximum"))return $.isModv3(d,m.getTags())?l?(n=parseInt(l),$.inidb.set("betSettings","betMinimum",n),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max",n,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(isNaN(p)||!isNaN(parseInt(p))){if(!r)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.bet.closed"));var y=parseInt(p),v=l;if(!$.list.contains(a,v.toLowerCase()))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(1>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.neg",$.pointNameMultiple));if(s>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.less",$.getPointString(s)));if(y>n)return $.say($.whisperPrefix(d)+"You can not bet more then "+$.getPointString(n)),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.more",$.getPointString(n)));if($.getUserPoints(d)<y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.points",$.pointNameMultiple));for(i in g)if(d.equalsIgnoreCase(i))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.voted"));$.inidb.decr("points",d,y),0==o?o=y:o+=y,g[d]={amount:y,option:v},$.say($.lang.get("betsystem.bet.updated",d,$.getPointsString(y),v,$.getPointsString(o)))}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/betSystem.js")&&$.registerChatCommand("./systems/betSystem.js","bet",7)})}();
