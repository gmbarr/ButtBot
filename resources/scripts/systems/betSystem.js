!function(){function e(e,t){var i,s,r=e.getSender();e.getArgs();if(o)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.bet.opened"));if(t.length<2)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.options"));for(s=0;s<t.length;s++)if(g.push(t[s].toLowerCase().trim()),!isNaN(t[s]))return $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.open")),void(g=[]);i=g.join(" vs "),o=!0,$.say($.lang.get("betsystem.opened",i,$.pointNameMultiple))}function t(){a=0,betTotal=0,betWinners="",g=[],m=[]}function s(e,i,s){var n,d,b=(i.getArgs(),s),p=0,u=0,f="",y=0,l=0;if(!o)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.bet.closed"));if(!b)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.win.option"));if(!$.list.contains(g,b))return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.option.404"));b=s.toLowerCase(),o=!1;for(d in m)n=m[d],n.option.equalsIgnoreCase(b)&&(y=n.amount);for(d in m)l++,n=m[d],n.option.equalsIgnoreCase(b)&&(u=a/y,u>0&&(f.length>0&&(f+=", "),f=d));if(r>l){for(d in m)n=m[d],$.inidb.incr("points",d,n.amount);return $.say($.lang.get("betsystem.not.enough.ppl")),void t()}if(0==y)return $.say($.lang.get("betsystem.closed.404",b)),void t();if(0>=a){for(d in m)n=m[d],$.inidb.incr("points",d,n.amount);return $.say($.lang.get("betsystem.err.points.refunded")),void t()}for(d in m)n=m[d],n.option.equalsIgnoreCase(b)&&(p=n.amount/y,$.inidb.incr("points",d,a*p));$.say($.lang.get("betsystem.closed",b,$.getPointsString(a*p))),t()}var r=$.inidb.exists("betSettings","betMinimum")?parseInt($.inidb.get("betSettings","betMinimum")):0,n=$.inidb.exists("betSettings","betMaximum")?parseInt($.inidb.get("betSettings","betMaximum")):1e3,o=!1,a=0,g=[],m=[];$.bind("command",function(t){var d=t.getSender(),b=t.getCommand(),p=(t.getArguments().trim(),t.getArgs()),u=p[0],f=p[1],y=p.slice(1);if(b.equalsIgnoreCase("bet")){if(!u)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.command.usage"));if(u.equalsIgnoreCase("open"))return $.isModv3(d,t.getTags())?void e(t,y):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("close"))return $.isModv3(d,t.getTags())?void s(d,t,f):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("setminimum"))return $.isModv3(d,t.getTags())?f?(r=parseInt(f),$.inidb.set("betSettings","betMinimum",r),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min",r,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("setmaximum"))return $.isModv3(d,t.getTags())?f?(n=parseInt(f),$.inidb.set("betSettings","betMinimum",n),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max",n,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(!o)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.bet.closed"));var l,v;if(!u||!f)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(u)&&isNaN(f))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(u)&&!isNaN(f)&&(l=parseInt(f),v=u),!isNaN(u)&&isNaN(f)&&(l=parseInt(u),v=f),!$.list.contains(g,v.toLowerCase()))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(1>l)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.neg",$.pointNameMultiple));if(r>l)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.less",$.getPointsString(r)));if(l>n)return $.say($.whisperPrefix(d)+"You can not bet more then "+$.getPointsString(n)),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.more",$.getPointsString(n)));if(parseInt($.getUserPoints(d.toLowerCase()))<l)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.points",$.pointNameMultiple));for(i in m)if(d.equalsIgnoreCase(i))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.voted"));$.inidb.decr("points",d,l),0==a?a=l:a+=l,m[d]={amount:l,option:v},$.say($.lang.get("betsystem.bet.updated",d,$.getPointsString(l),v,$.getPointsString(a)))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/betSystem.js")&&$.registerChatCommand("./systems/betSystem.js","bet",7)})}();
