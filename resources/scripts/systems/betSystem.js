!function(){function e(e,t){var s,i,r=e.getSender();e.getArgs();if(o)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.bet.opened"));if(t.length<2)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.options"));for(i=0;i<t.length;i++)if(g.push(t[i].toLowerCase().trim()),!isNaN(t[i]))return $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.open")),void(g=[]);s=g.join(" vs "),o=!0,$.say($.lang.get("betsystem.opened",s,$.pointNameMultiple))}function t(){a=0,betTotal=0,betWinners="",g=[],m=[]}function s(e,s,i){var r,n,d=(s.getArgs(),i),u=0,b=0,l="",f=0,p=0;if(!o)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.bet.closed"));if(!d)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.win.option"));if(!$.list.contains(g,d))return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.option.404"));d=i.toLowerCase(),o=!1;for(n in m)r=m[n],r.option.equalsIgnoreCase(d)&&(f=r.amount);for(n in m)p++,r=m[n],r.option.equalsIgnoreCase(d)&&(b=a/f,b>0&&(l.length>0&&(l+=", "),l+=n));if(0==f)return $.say($.lang.get("betsystem.closed.404",d)),void t();if(0>=a){for(n in m)r=m[n],$.inidb.incr("points",n,r.amount);return $.say($.lang.get("betsystem.err.points.refunded")),void t()}for(n in m)r=m[n],r.option.equalsIgnoreCase(d)&&(u=r.amount/f,$.inidb.incr("points",n,a*u));$.inidb.set("betresults","winners",l),$.inidb.set("betresults","amount",a*u),$.say($.lang.get("betsystem.closed",d,$.getPointsString(a*u))),t()}var r=$.getSetIniDbNumber("betSettings","betMinimum",1),n=$.getSetIniDbNumber("betSettings","betMaximum",1e3),o=!1,a=0,g=[],m=[];$.bind("command",function(t){var d=t.getSender(),u=t.getCommand(),b=(t.getArguments().trim(),t.getArgs()),l=b[0],f=b[1],p=b.slice(1);if(u.equalsIgnoreCase("bet")){if(!l)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.command.usage"));if(l.equalsIgnoreCase("open"))return $.isModv3(d,t.getTags())?void e(t,p):void $.say($.whisperPrefix(d)+$.modMsg);if(l.equalsIgnoreCase("close"))return $.isModv3(d,t.getTags())?void s(d,t,f):void $.say($.whisperPrefix(d)+$.modMsg);if(l.equalsIgnoreCase("setminimum"))return $.isModv3(d,t.getTags())?f?(r=parseInt(f),$.inidb.set("betSettings","betMinimum",r),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min",r,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(l.equalsIgnoreCase("setmaximum"))return $.isModv3(d,t.getTags())?f?(n=parseInt(f),$.inidb.set("betSettings","betMaximum",n),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max",n,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(!o)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.bet.closed"));var y,v;if(!l||!f)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(l)&&isNaN(f))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(l)&&!isNaN(f)&&(y=parseInt(f),v=l),!isNaN(l)&&isNaN(f)&&(y=parseInt(l),v=f),!$.list.contains(g,v.toLowerCase()))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(1>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.neg",$.pointNameMultiple));if(r>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.less",$.getPointsString(r)));if(y>n)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.more",$.getPointsString(n)));if(parseInt($.getUserPoints(d.toLowerCase()))<y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.points",$.pointNameMultiple));for(i in m)if(d.equalsIgnoreCase(i))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.voted"));$.inidb.decr("points",d,y),0==a?a=y:a+=y,m[d]={amount:y,option:v},$.say($.lang.get("betsystem.bet.updated",d,$.getPointsString(y),v,$.getPointsString(a)))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/betSystem.js")&&$.registerChatCommand("./systems/betSystem.js","bet",7)})}();
