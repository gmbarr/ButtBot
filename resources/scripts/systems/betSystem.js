!function(){function e(e,t){var i,s,r=e.getSender();e.getArgs();if(a)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.bet.opened"));if(t.length<2)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.options"));for(s=0;s<t.length;s++)if(g.push(t[s].toLowerCase().trim()),!isNaN(t[s]))return $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.open")),void(g=[]);i=g.join(" vs "),a=!0,$.say($.lang.get("betsystem.opened",i,$.pointNameMultiple))}function t(){o=0,betTotal=0,betWinners="",g=[],m=[]}function s(e,i,s){var r,n,d=(i.getArgs(),s),b=0,p=0,u="",f=0,l=0;if(!a)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.bet.closed"));if(!d)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.win.option"));if(!$.list.contains(g,d))return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.option.404"));d=s.toLowerCase(),a=!1;for(n in m)r=m[n],r.option.equalsIgnoreCase(d)&&(f=r.amount);for(n in m)l++,r=m[n],r.option.equalsIgnoreCase(d)&&(p=o/f,p>0&&(u.length>0&&(u+=", "),u=n));if(0==f)return $.say($.lang.get("betsystem.closed.404",d)),void t();if(0>=o){for(n in m)r=m[n],$.inidb.incr("points",n,r.amount);return $.say($.lang.get("betsystem.err.points.refunded")),void t()}for(n in m)r=m[n],r.option.equalsIgnoreCase(d)&&(b=r.amount/f,$.inidb.incr("points",n,o*b));$.say($.lang.get("betsystem.closed",d,$.getPointsString(o*b))),t()}var r=$.inidb.exists("betSettings","betMinimum")?parseInt($.inidb.get("betSettings","betMinimum")):1,n=$.inidb.exists("betSettings","betMaximum")?parseInt($.inidb.get("betSettings","betMaximum")):1e3,a=!1,o=0,g=[],m=[];$.bind("command",function(t){var d=t.getSender(),b=t.getCommand(),p=(t.getArguments().trim(),t.getArgs()),u=p[0],f=p[1],l=p.slice(1);if(b.equalsIgnoreCase("bet")){if(!u)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.command.usage"));if(u.equalsIgnoreCase("open"))return $.isModv3(d,t.getTags())?void e(t,l):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("close"))return $.isModv3(d,t.getTags())?void s(d,t,f):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("setminimum"))return $.isModv3(d,t.getTags())?f?(r=parseInt(f),$.inidb.set("betSettings","betMinimum",r),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min",r,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("setmaximum"))return $.isModv3(d,t.getTags())?f?(n=parseInt(f),$.inidb.set("betSettings","betMinimum",n),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max",n,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(!a)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.bet.closed"));var y,v;if(!u||!f)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(u)&&isNaN(f))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(u)&&!isNaN(f)&&(y=parseInt(f),v=u),!isNaN(u)&&isNaN(f)&&(y=parseInt(u),v=f),!$.list.contains(g,v.toLowerCase()))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(1>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.neg",$.pointNameMultiple));if(r>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.less",$.getPointsString(r)));if(y>n)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.more",$.getPointsString(n)));if(parseInt($.getUserPoints(d.toLowerCase()))<y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.points",$.pointNameMultiple));for(i in m)if(d.equalsIgnoreCase(i))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.voted"));$.inidb.decr("points",d,y),0==o?o=y:o+=y,m[d]={amount:y,option:v},$.say($.lang.get("betsystem.bet.updated",d,$.getPointsString(y),v,$.getPointsString(o)))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/betSystem.js")&&$.registerChatCommand("./systems/betSystem.js","bet",7)})}();
