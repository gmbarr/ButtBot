!function(){function e(e,t){var i,s,r=e.getSender();e.getArgs();if(o)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.bet.opened"));if(t.length<2)return void $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.options"));for(s=0;s<t.length;s++)if(g.push(t[s].toLowerCase().trim()),!isNaN(t[s]))return $.say($.whisperPrefix(r)+$.lang.get("betsystem.err.open")),void(g=[]);i=g.join(" vs "),o=!0,$.say($.lang.get("betsystem.opened",i,$.pointNameMultiple))}function t(){a=0,betTotal=0,betWinners="",g=[],m=[]}function s(e,i,s){var n,d,b=(i.getArgs(),s),p=0,u=0,f="",l=0,y=0;if(!o)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.bet.closed"));if(!b)return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.win.option"));if(!$.list.contains(g,b))return void $.say($.whisperPrefix(e)+$.lang.get("betsystem.err.option.404"));b=s.toLowerCase(),o=!1;for(d in m)n=m[d],n.option.equalsIgnoreCase(b)&&(l=n.amount);for(d in m)y++,n=m[d],n.option.equalsIgnoreCase(b)&&(u=a/l,u>0&&(f.length>0&&(f+=", "),f=d));if(r>y){for(d in m)n=m[d],$.inidb.incr("points",d,n.amount);return $.say($.lang.get("betsystem.not.enough.ppl")),void t()}if(0==l)return $.say($.lang.get("betsystem.closed.404",b)),void t();if(0>=a){for(d in m)n=m[d],$.inidb.incr("points",d,n.amount);return $.say($.lang.get("betsystem.err.points.refunded")),void t()}for(d in m)n=m[d],n.option.equalsIgnoreCase(b)&&(p=n.amount/l,$.inidb.incr("points",d,a*p));$.say($.lang.get("betsystem.closed",b,$.getPointsString(a*p))),t()}var r=$.inidb.exists("betSettings","betMinimum")?parseInt($.inidb.get("betSettings","betMinimum")):1,n=$.inidb.exists("betSettings","betMaximum")?parseInt($.inidb.get("betSettings","betMaximum")):1e3,o=!1,a=0,g=[],m=[];$.bind("command",function(t){var d=t.getSender(),b=t.getCommand(),p=(t.getArguments().trim(),t.getArgs()),u=p[0],f=p[1],l=p.slice(1);if(b.equalsIgnoreCase("bet")){if(!u)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.command.usage"));if(u.equalsIgnoreCase("open"))return $.isModv3(d,t.getTags())?void e(t,l):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("close"))return $.isModv3(d,t.getTags())?void s(d,t,f):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("setminimum"))return $.isModv3(d,t.getTags())?f?(r=parseInt(f),$.inidb.set("betSettings","betMinimum",r),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min",r,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.min.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(u.equalsIgnoreCase("setmaximum"))return $.isModv3(d,t.getTags())?f?(n=parseInt(f),$.inidb.set("betSettings","betMinimum",n),void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max",n,$.pointNameMultiple))):void $.say($.whisperPrefix(d)+$.lang.get("betsystem.set.max.usage")):void $.say($.whisperPrefix(d)+$.modMsg);if(!o)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.bet.closed"));var y,v;if(!u||!f)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(u)&&isNaN(f))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(isNaN(u)&&!isNaN(f)&&(y=parseInt(f),v=u),!isNaN(u)&&isNaN(f)&&(y=parseInt(u),v=f),!$.list.contains(g,v.toLowerCase()))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.option.404"));if(1>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.neg",$.pointNameMultiple));if(r>y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.less",$.getPointsString(r)));if(y>n)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.bet.err.more",$.getPointsString(n)));if(parseInt($.getUserPoints(d.toLowerCase()))<y)return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.points",$.pointNameMultiple));for(i in m)if(d.equalsIgnoreCase(i))return void $.say($.whisperPrefix(d)+$.lang.get("betsystem.err.voted"));$.inidb.decr("points",d,y),0==a?a=y:a+=y,m[d]={amount:y,option:v},$.say($.lang.get("betsystem.bet.updated",d,$.getPointsString(y),v,$.getPointsString(a)))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/betSystem.js")&&$.registerChatCommand("./systems/betSystem.js","bet",7)})}();
