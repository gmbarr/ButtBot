!function(){function e(e,s){var a=parseInt(e),i=parseInt(s);return a>i?1:a==i?0:-1}function s(){r=$.inidb.GetKeyList("ranksMapping",""),r.sort(e)}function a(e){return $.inidb.exists("viewerRanks",e.toLowerCase())?!0:(void 0===r&&s(),0==r.length?!1:!0)}function i(e){var s,i;if(!a(e))return"";if($.inidb.exists("viewerRanks",e.toLowerCase()))return $.inidb.get("viewerRanks",e.toLowerCase());s=parseInt(parseInt($.inidb.get("time",e))/3600);for(var n=0;n<r.length;n++)parseInt(s)>=parseInt(r[n])?i=n:n=r.length;return $.inidb.get("ranksMapping",r[i].toString())}function n(e){return(i(e.toLowerCase())+" "+$.username.resolve(e.toLowerCase())).trim()}rankEligableTime=$.inidb.exists("settings","rankEligableTime")?parseInt($.inidb.get("settings","rankEligableTime")):50,rankEligableCost=$.inidb.exists("settings","rankEligableCost")?parseInt($.inidb.get("settings","rankEligableCost")):200;var r;$.bind("command",function(e){var a,i,n,t,g,o,l,d,k=e.getCommand(),u=e.getArgs(),p=e.getSender().toLowerCase(),m=$.username.resolve(p),b=parseInt(parseInt($.inidb.get("time",p))/3600);if(k.equalsIgnoreCase("rankedit")){if(!u[0])return void $.say($.whisperPrefix(p)+$.lang.get("ranks.edit.usage"));if(u[0].equalsIgnoreCase("settime"))return u.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.usage")):isNaN(u[1])?void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.usage")):(rankEligableTime=parseInt(u[1]),$.inidb.set("settings","rankEligableTime",rankEligableTime),void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.success",rankEligableTime)));if(u[0].equalsIgnoreCase("setcost"))return u.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.setcost.usage",$.pointNameMultiple)):isNaN(u[1])?void $.say($.whisperPrefix(p)+$.lang.get("ranks.setcost.usage",$.pointNameMultiple)):(rankEligableCost=parseInt(u[1]),$.inidb.set("settings","rankEligableCost",rankEligableCost),void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.success",rankEligableCost,$.pointNameMultiple)));if(u[0].equalsIgnoreCase("custom"))return u.length<3?void $.say($.whisperPrefix(p)+$.lang.get("ranks.custom.usage")):(l=u[1],d=u.splice(2).join(" "),$.inidb.exists("time",l.toLowerCase())?($.inidb.set("viewerRanks",l.toLowerCase(),d),void $.say($.whisperPrefix(p)+$.lang.get("ranks.custom.success",$.username.resolve(l),d))):void $.say($.whisperPrefix(p)+$.lang.get("ranks.custom.404",l)));if(u[0].equalsIgnoreCase("customdel"))return u.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.customdel.usage")):(l=u[1],$.inidb.exists("viewerRanks",l.toLowerCase())?($.inidb.del("viewerRanks",l.toLowerCase()),void $.say($.whisperPrefix(p)+$.lang.get("ranks.customdel.success",$.username.resolve(l)))):void $.say($.whisperPrefix(p)+$.lang.get("ranks.customdel.404",l)));if(u[0].equalsIgnoreCase("add"))return u.length<3?void $.say($.whisperPrefix(p)+$.lang.get("ranks.add.usage")):isNaN(u[1])?void $.say($.whisperPrefix(p)+$.lang.get("ranks.add.usage")):(a=u[1],i=u.splice(2).join(" "),o=$.inidb.exists("ranksMapping",a),$.inidb.set("ranksMapping",a,i),o?$.say($.whisperPrefix(p)+$.lang.get("ranks.add.success-update",a,i)):$.say($.whisperPrefix(p)+$.lang.get("ranks.add.success-new",a,i)),void(o||s()));if(u[0].equalsIgnoreCase("del"))return u.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.del.usage")):void($.inidb.exists("ranksMapping",u[1])?($.inidb.del("ranksMapping",u[1]),$.say($.whisperPrefix(p)+$.lang.get("ranks.del.success",u[1])),s()):$.say($.whisperPrefix(p)+$.lang.get("ranks.del.404",u[1])))}if(k.equalsIgnoreCase("rank")){if(u[0]){if(u[0].equalsIgnoreCase("del"))return void(inidb.exists("viewerRanks",p.toLowerCase())?($.say($.whisperPrefix(p)+$.lang.get("ranks.delself.success")),$.inidb.del("viewerRanks",p.toLowerCase())):$.say($.whisperPrefix(p)+$.lang.get("ranks.delself.404")));if(u[0].equalsIgnoreCase("set"))return u[1]?(d=u.splice(1).join(" "),b>=rankEligableTime&&$.bot.isModuleEnabled("./systems/pointSystem.js")&&getUserPoints(p)>rankEligableCost||!$.bot.isModuleEnabled("./systems/pointSystem.js")?($.say($.whisperPrefix(p)+$.lang.get("ranks.set.success",d)),$.inidb.set("viewerRanks",p.toLowerCase(),d),void($.bot.isModuleEnabled("./systems/pointSystem.js")&&$.inidb.decr("points",p.toLowerCase(),rankEligableCost))):void($.bot.isModuleEnabled("./systems/pointSystem.js")?$.say($.whisperPrefix(p)+$.lang.get("ranks.set.failure",rankEligableTime,$.pointNameMultiple,rankEligableCost)):$.say($.whisperPrefix(p)+$.lang.get("ranks.set.failure.nopoints",rankEligableTime)))):void($.bot.isModuleEnabled("./systems/pointSystem.js")?$.say($.whisperPrefix(p)+$.lang.get("ranks.set.usage",rankEligableTime,rankEligableCost,$.pointNameMultiple)):$.say($.whisperPrefix(p)+$.lang.get("ranks.set.usage.nopoints",rankEligableTime)))}if(void 0===r&&s(),0==r.length)return void $.say($.whisperPrefix(p)+$.lang.get("ranks.rank.404"));n=-1;for(var c=0;c<r.length;c++)parseInt(b)>=parseInt(r[c])?n=c:c=r.length;return $.inidb.exists("viewerRanks",m.toLowerCase())?void $.say($.lang.get("ranks.rank.customsuccess",m,$.inidb.get("viewerRanks",m.toLowerCase()))):void(n<=r.length-2?(g=parseInt(n)+1,t=parseInt(r[g])-b,-1==n?$.say($.lang.get("ranks.rank.norank.success",m,t)):$.say($.lang.get("ranks.rank.success",m,$.inidb.get("ranksMapping",r[n].toString()),t))):$.say($.lang.get("ranks.rank.maxsuccess",m,$.inidb.get("ranksMapping",r[n].toString()))))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/ranksSystem.js")&&($.registerChatCommand("./systems/ranksSystem.js","rank",7),$.registerChatCommand("./systems/ranksSystem.js","rankedit",1),$.registerChatSubcommand("rankedit","add",1),$.registerChatSubcommand("rankedit","del",1),$.registerChatSubcommand("rankedit","custom",1),$.registerChatSubcommand("rankedit","customdel",1))}),$.resolveRank=n,$.getRank=i,$.hasRank=a}();
