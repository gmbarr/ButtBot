!function(){function e(e,s){var i=parseInt(e),a=parseInt(s);return i>a?1:i==a?0:-1}function s(){t=$.inidb.GetKeyList("ranksMapping",""),t.sort(e)}function i(e){return $.inidb.exists("viewerRanks",e.toLowerCase())?!0:(void 0===t&&s(),0==t.length?!1:!0)}function a(e){var s,a;if(!i(e))return"";if($.inidb.exists("viewerRanks",e.toLowerCase()))return $.inidb.get("viewerRanks",e.toLowerCase());s=parseInt(parseInt($.inidb.get("time",e))/3600);for(var n=0;n<t.length;n++)parseInt(s)>=parseInt(t[n])?a=n:n=t.length;return $.inidb.get("ranksMapping",t[a].toString())}function n(e){return(a(e.toLowerCase())+" "+$.username.resolve(e.toLowerCase())).trim()}rankEligableTime=$.inidb.exists("settings","rankEligableTime")?parseInt($.inidb.get("settings","rankEligableTime")):50,rankEligableCost=$.inidb.exists("settings","rankEligableCost")?parseInt($.inidb.get("settings","rankEligableCost")):200;var t;$.bind("command",function(e){var i,a,n,r,g,o,l,d,u=e.getCommand(),k=e.getArgs(),p=e.getSender().toLowerCase(),m=$.username.resolve(p),b=parseInt(parseInt($.inidb.get("time",p))/3600);if(u.equalsIgnoreCase("rankedit")){if(!k[0])return void $.say($.whisperPrefix(p)+$.lang.get("ranks.edit.usage"));if(k[0].equalsIgnoreCase("settime"))return k.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.usage")):isNaN(k[1])?void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.usage")):(rankEligableTime=parseInt(k[1]),$.inidb.set("settings","rankEligableTime",rankEligableTime),void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.success",rankEligableTime)));if(k[0].equalsIgnoreCase("setcost"))return k.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.setcost.usage",$.pointNameMultiple)):isNaN(k[1])?void $.say($.whisperPrefix(p)+$.lang.get("ranks.setcost.usage",$.pointNameMultiple)):(rankEligableCost=parseInt(k[1]),$.inidb.set("settings","rankEligableCost",rankEligableCost),void $.say($.whisperPrefix(p)+$.lang.get("ranks.settime.success",rankEligableCost,$.pointNameMultiple)));if(k[0].equalsIgnoreCase("custom"))return k.length<3?void $.say($.whisperPrefix(p)+$.lang.get("ranks.custom.usage")):(l=k[1],d=k.splice(2).join(" "),$.inidb.exists("time",l.toLowerCase())?($.inidb.set("viewerRanks",l.toLowerCase(),d),void $.say($.whisperPrefix(p)+$.lang.get("ranks.custom.success",$.username.resolve(l),d))):void $.say($.whisperPrefix(p)+$.lang.get("ranks.custom.404",l)));if(k[0].equalsIgnoreCase("customdel"))return k.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.customdel.usage")):(l=k[1],$.inidb.exists("viewerRanks",l.toLowerCase())?($.inidb.del("viewerRanks",l.toLowerCase()),void $.say($.whisperPrefix(p)+$.lang.get("ranks.customdel.success",$.username.resolve(l)))):void $.say($.whisperPrefix(p)+$.lang.get("ranks.customdel.404",l)));if(k[0].equalsIgnoreCase("add"))return k.length<3?void $.say($.whisperPrefix(p)+$.lang.get("ranks.add.usage")):isNaN(k[1])?void $.say($.whisperPrefix(p)+$.lang.get("ranks.add.usage")):(i=k[1],a=k.splice(2).join(" "),o=$.inidb.exists("ranksMapping",i),$.inidb.set("ranksMapping",i,a),o?$.say($.whisperPrefix(p)+$.lang.get("ranks.add.success-update",i,a)):$.say($.whisperPrefix(p)+$.lang.get("ranks.add.success-new",i,a)),void(o||s()));if(k[0].equalsIgnoreCase("del"))return k.length<2?void $.say($.whisperPrefix(p)+$.lang.get("ranks.del.usage")):void($.inidb.exists("ranksMapping",k[1])?($.inidb.del("ranksMapping",k[1]),$.say($.whisperPrefix(p)+$.lang.get("ranks.del.success",k[1])),s()):$.say($.whisperPrefix(p)+$.lang.get("ranks.del.404",k[1])))}if(u.equalsIgnoreCase("rank")){if(k[0]){if(k[0].equalsIgnoreCase("del"))return void(inidb.exists("viewerRanks",p.toLowerCase())?($.say($.whisperPrefix(p)+$.lang.get("ranks.delself.success")),$.inidb.del("viewerRanks",p.toLowerCase())):$.say($.whisperPrefix(p)+$.lang.get("ranks.delself.404")));if(k[0].equalsIgnoreCase("set"))return k[1]?(d=k.splice(2).join(" "),b>=rankEligableTime&&$.bot.isModuleEnabled("./systems/pointSystem.js")&&getUserPoints(p)>rankEligableCost||!$.bot.isModuleEnabled("./systems/pointSystem.js")?($.say($.whisperPrefix(p)+$.lang.get("ranks.set.success",d)),$.inidb.set("viewerRanks",p.toLowerCase(),d),void($.bot.isModuleEnabled("./systems/pointSystem.js")&&$.inidb.decr("points",p.toLowerCase(),rankEligableCost))):void($.bot.isModuleEnabled("./systems/pointSystem.js")?$.say($.whisperPrefix(p)+$.lang.get("ranks.set.failure",rankEligableTime,$.pointNameMultiple,rankEligableCost)):$.say($.whisperPrefix(p)+$.lang.get("ranks.set.failure.nopoints",rankEligableTime)))):void($.bot.isModuleEnabled("./systems/pointSystem.js")?$.say($.whisperPrefix(p)+$.lang.get("ranks.set.usage",rankEligableTime,rankEligableCost,$.pointNameMultiple)):$.say($.whisperPrefix(p)+$.lang.get("ranks.set.usage.nopoints",rankEligableTime)))}if(void 0===t&&s(),0==t.length)return void $.say($.whisperPrefix(p)+$.lang.get("ranks.rank.404"));for(var f=0;f<t.length;f++)parseInt(b)>=parseInt(t[f])?n=f:f=t.length;return $.inidb.exists("viewerRanks",m.toLowerCase())?void $.say($.lang.get("ranks.rank.customsuccess",m,$.inidb.get("viewerRanks",m.toLowerCase()))):void(n<=t.length-2?(g=parseInt(n)+1,r=parseInt(t[g])-b,$.say($.lang.get("ranks.rank.success",m,$.inidb.get("ranksMapping",t[n].toString()),r))):$.say($.lang.get("ranks.rank.maxsuccess",m,$.inidb.get("ranksMapping",t[n].toString()))))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/ranksSystem.js")&&($.registerChatCommand("./systems/ranksSystem.js","rank",7),$.registerChatCommand("./systems/ranksSystem.js","rankedit",1),$.registerChatSubcommand("rankedit","add",1),$.registerChatSubcommand("rankedit","del",1),$.registerChatSubcommand("rankedit","custom",1),$.registerChatSubcommand("rankedit","customdel",1))}),$.resolveRank=n,$.getRank=a,$.hasRank=i}();
