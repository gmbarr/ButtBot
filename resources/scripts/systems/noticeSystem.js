!function(){function e(){var e,i=$.inidb.GetKeyList("notices",""),n=0;for(e=0;e<i.length;e++)$.inidb.set("tempnotices",i[e],$.inidb.get("notices",i[e]));for($.inidb.RemoveFile("notices"),i=$.inidb.GetKeyList("tempnotices",""),e=0;e<i.length;e++)$.inidb.set("notices","message_"+n,$.inidb.get("tempnotices",i[e])),n++;$.inidb.RemoveFile("tempnotices")}function i(){var e=Packages.me.mast3rplan.phantombot.event.EventBus,i=Packages.me.mast3rplan.phantombot.event.command.CommandEvent,n=$.randRange(0,a),t=$.inidb.get("notices","message_"+n);t.substr(0,8).equalsIgnoreCase("command:")?(t=t.substring(8),e.instance().postCommand(new i($.botName,t," "))):$.say(t)}var n=parseInt($.inidb.exists("noticeSettings","reqmessages"))?parseInt($.inidb.get("noticeSettings","reqmessages")):25,t=parseInt($.inidb.exists("noticeSettings","interval"))?parseInt($.inidb.get("noticeSettings","interval")):10,s=$.inidb.exists("noticeSettings","noticetoggle")?$.inidb.get("noticeSettings","noticetoggle"):!1,a=parseInt($.inidb.GetKeyList("notices","").length)?parseInt($.inidb.GetKeyList("notices","").length):0,r=0;$.bind("ircChannelMessage",function(){r++}),$.bind("command",function(i){var r=i.getSender(),o=i.getCommand(),g=i.getArguments().trim(),d=i.getArgs(),c=d[0],l="";if(o.equalsIgnoreCase("notice")){if(!$.isAdmin(r))return void $.say($.whisperPrefix(r)+$.adminMsg);if(0==d.length)return void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-usage"));if(c.equalsIgnoreCase("get"))return d.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-get-usage",a)):$.inidb.exists("notices","message_"+d[1])?void $.say($.inidb.get("notices","message_"+d[1])):void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));if(c.equalsIgnoreCase("edit"))return d.length<3?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-edit-usage",a)):$.inidb.exists("notices","message_"+d[1])?(l=g.substring(g.indexOf(c)+c.length()+1),$.inidb.set("notices","message_"+d[1],l),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-edit-success"))):void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));if(c.equalsIgnoreCase("remove"))return d.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-remove-usage",a)):$.inidb.exists("notices","message_"+d[1])?($.inidb.del("notices","message_"+d[1]),a--,e(),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-remove-success"))):void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));if(c.equalsIgnoreCase("add"))return d.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-add-usage")):(l=g.substring(g.indexOf(c)+3),$.inidb.set("notices","message_"+a,l),a++,void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-add-success")));if(c.equalsIgnoreCase("interval"))return d.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-interval-usage")):parseInt(d[1])<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-interval-404")):($.inidb.set("settings","interval",parseInt(d[1])),t=parseInt(d[1]),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-inteval-success")));if(c.equalsIgnoreCase("req"))return d.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-usage")):parseInt(d[1])<1?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-404")):($.inidb.set("settings","reqmessages",parseInt(d[1])),n=parseInt(d[1]),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-success")));if(c.equalsIgnoreCase("config"))return void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-config",s,t,n,a));c.equalsIgnoreCase("toggle")&&(s=!s,$.inidb.set("settings","noticetoggle",s),s?$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-disabled")):$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-enabled"))),c.equalsIgnoreCase("reload")&&e()}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/noticeSystem.js")&&(setInterval(function(){$.bot.isModuleEnabled("./systems/noticeSystem.js")&&a>0&&s&&r>=n&&(i(),r=0)},60*t*1e3),$.registerChatCommand("./systems/noticeSystem.js","notice"))})}();
