!function(){function e(){var e,i=$.inidb.GetKeyList("notices",""),n=0;for(e=0;e<i.length;e++)$.inidb.set("tempnotices",i[e],$.inidb.get("notices",i[e]));for($.inidb.RemoveFile("notices"),i=$.inidb.GetKeyList("tempnotices",""),e=0;e<i.length;e++)$.inidb.set("notices","message_"+n,$.inidb.get("tempnotices",i[e])),n++;$.inidb.RemoveFile("tempnotices")}function i(){var e=Packages.me.mast3rplan.phantombot.event.EventBus,i=Packages.me.mast3rplan.phantombot.event.command.CommandEvent,n=$.inidb.get("notices","message_"+g);g++,g>=a&&(g=0),n.startsWith("command:")?(n=n.substring(8),e.instance().postCommand(new i($.botName,n," "))):$.say(n)}var n=$.getSetIniDbNumber("noticeSettings","reqmessages",25),t=$.getSetIniDbNumber("noticeSettings","interval",10),s=$.getSetIniDbBoolean("noticeSettings","noticetoggle",!1),a=parseInt($.inidb.GetKeyList("notices","").length)?parseInt($.inidb.GetKeyList("notices","").length):0,o=$.getSetIniDbBoolean("noticeSettings","noticeOffline",!0),r=0,g=0;$.bind("ircChannelMessage",function(){r++}),$.bind("command",function(i){var r=i.getSender(),g=i.getCommand(),c=i.getArguments().trim(),l=i.getArgs(),d=l[0];if(g.equalsIgnoreCase("notice")){if(!$.isAdmin(r))return void $.say($.whisperPrefix(r)+$.adminMsg);if(0==l.length)return void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-usage"));if(d.equalsIgnoreCase("get"))return l.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-get-usage",a)):$.inidb.exists("notices","message_"+l[1])?void $.say($.inidb.get("notices","message_"+l[1])):void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));if(d.equalsIgnoreCase("edit"))return l.length<3?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-edit-usage",a)):$.inidb.exists("notices","message_"+l[1])?(c=c.replace(d+" "+l[1],"").trim(),$.inidb.set("notices","message_"+l[1],c),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-edit-success"))):void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));if(d.equalsIgnoreCase("remove"))return l.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-remove-usage",a)):$.inidb.exists("notices","message_"+l[1])?($.inidb.del("notices","message_"+l[1]),a--,e(),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-remove-success"))):void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));if(d.equalsIgnoreCase("add"))return l.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-add-usage")):(c=c.replace(d+"","").trim(),$.inidb.set("notices","message_"+a,c),a++,void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-add-success")));if(d.equalsIgnoreCase("interval"))return l.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-interval-usage")):parseInt(l[1])<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-interval-404")):($.inidb.set("noticeSettings","interval",l[1]),t=parseInt(l[1]),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-inteval-success")));if(d.equalsIgnoreCase("req"))return l.length<2?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-usage")):parseInt(l[1])<1?void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-404")):($.inidb.set("noticeSettings","reqmessages",l[1]),n=parseInt(l[1]),void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-success")));if(d.equalsIgnoreCase("config"))return void $.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-config",s,t,n,a,o));d.equalsIgnoreCase("toggle")&&(s?(s=!1,$.inidb.set("noticeSettings","noticetoggle","false"),$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-disabled"))):(s=!0,$.inidb.set("noticeSettings","noticetoggle","true"),$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-enabled")))),d.equalsIgnoreCase("toggleoffline")&&(o?(o=!1,$.inidb.set("noticeSettings","noticeOffline","false"),$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-disabled.offline"))):(o=!0,$.inidb.set("noticeSettings","noticeOffline","true"),$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-enabled.offline"))))}}),setInterval(function(){if(s&&$.bot.isModuleEnabled("./systems/noticeSystem.js")&&a>0&&r>=n){if(!o&&!$.isOnline($.channelName))return;i(),r=0}},60*t*1e3),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/noticeSystem.js")&&$.registerChatCommand("./systems/noticeSystem.js","notice")})}();
