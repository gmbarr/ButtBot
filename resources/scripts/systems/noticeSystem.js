(function(){var e=$.inidb.exists("noticeSettings","reqmessages")?parseInt($.inidb.get("noticeSettings","reqmessages")):25,i=$.inidb.exists("noticeSettings","interval")?parseInt($.inidb.get("noticeSettings","interval")):10,n=$.inidb.exists("noticeSettings","noticetoggle")?$.getIniDbBoolean("noticeSettings","noticetoggle"):false,t=parseInt($.inidb.GetKeyList("notices","").length)?parseInt($.inidb.GetKeyList("notices","").length):0,s=0,r=0;function a(){var e=$.inidb.GetKeyList("notices",""),i=0,n;for(n=0;n<e.length;n++){$.inidb.set("tempnotices",e[n],$.inidb.get("notices",e[n]))}$.inidb.RemoveFile("notices");e=$.inidb.GetKeyList("tempnotices","");for(n=0;n<e.length;n++){$.inidb.set("notices","message_"+i,$.inidb.get("tempnotices",e[n]));i++}$.inidb.RemoveFile("tempnotices")}function o(){var e=Packages.me.mast3rplan.phantombot.event.EventBus,i=Packages.me.mast3rplan.phantombot.event.command.CommandEvent,n=$.inidb.get("notices","message_"+r);r++;if(r>=t){r=0}if(n.startsWith("command:")){n=n.substring(8);e.instance().postCommand(new i($.botName,n," "))}else{$.say(n)}}$.bind("ircChannelMessage",function(){s++});$.bind("command",function(s){var r=s.getSender(),o=s.getCommand(),g=s.getArguments().trim(),c=s.getArgs(),l=c[0],d="";if(o.equalsIgnoreCase("notice")){if(!$.isAdmin(r)){$.say($.whisperPrefix(r)+$.adminMsg);return}if(c.length==0){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-usage"));return}if(l.equalsIgnoreCase("get")){if(c.length<2){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-get-usage",t));return}else if(!$.inidb.exists("notices","message_"+c[1])){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));return}else{$.say($.inidb.get("notices","message_"+c[1]));return}}if(l.equalsIgnoreCase("edit")){if(c.length<3){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-edit-usage",t));return}else if(!$.inidb.exists("notices","message_"+c[1])){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));return}else{g=g.replace(l+"","").trim();$.inidb.set("notices","message_"+c[1],d);$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-edit-success"));return}}if(l.equalsIgnoreCase("remove")){if(c.length<2){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-remove-usage",t));return}else if(!$.inidb.exists("notices","message_"+c[1])){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-error-notice-404"));return}else{$.inidb.del("notices","message_"+c[1]);t--;a();$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-remove-success"));return}}if(l.equalsIgnoreCase("add")){if(c.length<2){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-add-usage"));return}else{g=g.replace(l+"","").trim();$.inidb.set("notices","message_"+t,g);t++;$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-add-success"));return}}if(l.equalsIgnoreCase("interval")){if(c.length<2){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-interval-usage"));return}else if(parseInt(c[1])<2){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-interval-404"));return}else{$.inidb.set("noticeSettings","interval",c[1]);i=parseInt(c[1]);$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-inteval-success"));return}}if(l.equalsIgnoreCase("req")){if(c.length<2){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-usage"));return}else if(parseInt(c[1])<1){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-404"));return}else{$.inidb.set("noticeSettings","reqmessages",c[1]);e=parseInt(c[1]);$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-req-success"));return}}if(l.equalsIgnoreCase("config")){$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-config",n,i,e,t));return}if(l.equalsIgnoreCase("toggle")){if(n){n=false;$.inidb.set("noticeSettings","noticetoggle","false");$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-disabled"))}else{n=true;$.inidb.set("noticeSettings","noticetoggle","true");$.say($.whisperPrefix(r)+$.lang.get("noticehandler.notice-enabled"))}}if(l.equalsIgnoreCase("reload")){a()}}});setInterval(function(){if(n){if($.bot.isModuleEnabled("./systems/noticeSystem.js")&&t>0){if(s>=e){o();s=0}}}},i*60*1e3);$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/noticeSystem.js")){$.registerChatCommand("./systems/noticeSystem.js","notice")}})})();
