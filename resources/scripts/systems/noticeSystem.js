(function(){var e=parseInt($.inidb.exists("noticeSettings","reqmessages"))?parseInt($.inidb.get("noticeSettings","reqmessages")):25,n=parseInt($.inidb.exists("noticeSettings","interval"))?parseInt($.inidb.get("noticeSettings","interval")):10,i=$.inidb.exists("noticeSettings","noticetoggle")?$.inidb.get("noticeSettings","noticetoggle"):false,t=parseInt($.inidb.GetKeyList("notices","").length)?parseInt($.inidb.GetKeyList("notices","").length):0,s=0;function r(){var e=$.inidb.GetKeyList("notices",""),n=0,i;for(i=0;i<e.length;i++){$.inidb.set("tempnotices",e[i],$.inidb.get("notices",e[i]))}$.inidb.RemoveFile("notices");e=$.inidb.GetKeyList("tempnotices","");for(i=0;i<e.length;i++){$.inidb.set("notices","message_"+n,$.inidb.get("tempnotices",e[i]));n++}$.inidb.RemoveFile("tempnotices")}function a(){var e=Packages.me.mast3rplan.phantombot.event.EventBus;var n=Packages.me.mast3rplan.phantombot.event.command.CommandEvent;var i=$.randRange(0,t);var s=$.inidb.get("notices","message_"+i);if(s.startsWith("command:")){s=s.substring(8);e.instance().postCommand(new n($.botName,s," "))}else{$.say(s)}}$.bind("ircChannelMessage",function(){s++});$.bind("command",function(s){var a=s.getSender(),o=s.getCommand(),g=s.getArguments().trim(),c=s.getArgs(),l=c[0],d="";if(o.equalsIgnoreCase("notice")){if(!$.isAdmin(a)){$.say($.whisperPrefix(a)+$.adminMsg);return}if(c.length==0){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-usage"));return}if(l.equalsIgnoreCase("get")){if(c.length<2){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-get-usage",t));return}else if(!$.inidb.exists("notices","message_"+c[1])){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-error-notice-404"));return}else{$.say($.inidb.get("notices","message_"+c[1]));return}}if(l.equalsIgnoreCase("edit")){if(c.length<3){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-edit-usage",t));return}else if(!$.inidb.exists("notices","message_"+c[1])){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-error-notice-404"));return}else{g=g.replace(l+"","").trim();$.inidb.set("notices","message_"+c[1],d);$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-edit-success"));return}}if(l.equalsIgnoreCase("remove")){if(c.length<2){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-remove-usage",t));return}else if(!$.inidb.exists("notices","message_"+c[1])){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-error-notice-404"));return}else{$.inidb.del("notices","message_"+c[1]);t--;r();$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-remove-success"));return}}if(l.equalsIgnoreCase("add")){if(c.length<2){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-add-usage"));return}else{g=g.replace(l+"","").trim();$.inidb.set("notices","message_"+t,g);t++;$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-add-success"));return}}if(l.equalsIgnoreCase("interval")){if(c.length<2){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-interval-usage"));return}else if(parseInt(c[1])<2){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-interval-404"));return}else{$.inidb.set("noticeSettings","interval",parseInt(c[1]));n=parseInt(c[1]);$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-inteval-success"));return}}if(l.equalsIgnoreCase("req")){if(c.length<2){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-req-usage"));return}else if(parseInt(c[1])<1){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-req-404"));return}else{$.inidb.set("noticeSettings","reqmessages",parseInt(c[1]));e=parseInt(c[1]);$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-req-success"));return}}if(l.equalsIgnoreCase("config")){$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-config",i,n,e,t));return}if(l.equalsIgnoreCase("toggle")){if(i){i=false;$.inidb.set("noticeSettings","noticetoggle",i);$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-disabled"))}else{i=true;$.inidb.set("noticeSettings","noticetoggle",i);$.say($.whisperPrefix(a)+$.lang.get("noticehandler.notice-enabled"))}}if(l.equalsIgnoreCase("reload")){r()}}});setInterval(function(){if(i){if($.bot.isModuleEnabled("./systems/noticeSystem.js")&&t>0){if(s>=e){a();s=0}}}},n*60*1e3);$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/noticeSystem.js")){$.registerChatCommand("./systems/noticeSystem.js","notice")}})})();
