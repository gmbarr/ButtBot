!function(){function e(){var e,i=$.inidb.GetKeyList("notices",""),n=0;for(e=0;e<i.length;e++)$.inidb.set("tempnotices",i[e],$.inidb.get("notices",i[e]));for($.inidb.RemoveFile("notices"),i=$.inidb.GetKeyList("tempnotices",""),e=0;e<i.length;e++)$.inidb.set("notices","message_"+n,$.inidb.get("tempnotices",i[e])),n++;$.inidb.RemoveFile("tempnotices")}function i(){var e=Packages.me.mast3rplan.phantombot.event.EventBus,i=Packages.me.mast3rplan.phantombot.event.command.CommandEvent,n=$.inidb.get("notices","message_"+g);g++,g>=a&&(g=0),n.startsWith("command:")?(n=n.substring(8),e.instance().postCommand(new i($.botName,n," "))):$.say(n)}var n=$.getSetIniDbNumber("noticeSettings","reqmessages",25),t=$.getSetIniDbNumber("noticeSettings","interval",10),s=$.getSetIniDbBoolean("noticeSettings","noticetoggle",!1),a=parseInt($.inidb.GetKeyList("notices","").length)?parseInt($.inidb.GetKeyList("notices","").length):0,o=$.getSetIniDbBoolean("noticeSettings","noticeOffline",!0),r=0,g=0;$.bind("ircChannelMessage",function(){r++}),$.bind("command",function(g){var c=g.getSender(),l=g.getCommand(),d=g.getArguments().trim(),h=g.getArgs(),m=h[0];if(l.equalsIgnoreCase("notice")){if(!$.isAdmin(c))return void $.say($.whisperPrefix(c)+$.adminMsg);if(0==h.length)return void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-usage"));if(m.equalsIgnoreCase("get"))return h.length<2?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-get-usage",a)):$.inidb.exists("notices","message_"+h[1])?void $.say($.inidb.get("notices","message_"+h[1])):void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-error-notice-404"));if(m.equalsIgnoreCase("edit"))return h.length<3?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-edit-usage",a)):$.inidb.exists("notices","message_"+h[1])?(d=d.replace(m+" "+h[1],"").trim(),$.inidb.set("notices","message_"+h[1],d),void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-edit-success"))):void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-error-notice-404"));if(m.equalsIgnoreCase("remove"))return h.length<2?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-remove-usage",a)):$.inidb.exists("notices","message_"+h[1])?($.inidb.del("notices","message_"+h[1]),a--,e(),void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-remove-success"))):void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-error-notice-404"));if(m.equalsIgnoreCase("add"))return h.length<2?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-add-usage")):(d=d.replace(m+"","").trim(),$.inidb.set("notices","message_"+a,d),a++,void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-add-success")));if(m.equalsIgnoreCase("interval"))return h.length<2?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-interval-usage")):parseInt(h[1])<2?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-interval-404")):($.inidb.set("noticeSettings","interval",h[1]),t=parseInt(h[1]),$.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-inteval-success")),void setInterval(function(){s&&$.bot.isModuleEnabled("./systems/noticeSystem.js")&&a>0&&r>=n&&o&&$.isOnline($.channelName)&&(i(),r=0)},60*t*1e3,"noticeTimer"));if(m.equalsIgnoreCase("req"))return h.length<2?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-req-usage")):parseInt(h[1])<1?void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-req-404")):($.inidb.set("noticeSettings","reqmessages",h[1]),n=parseInt(h[1]),void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-req-success")));if(m.equalsIgnoreCase("config"))return void $.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-config",s,t,n,a,o));m.equalsIgnoreCase("toggle")&&(s?(s=!1,$.inidb.set("noticeSettings","noticetoggle","false"),$.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-disabled"))):(s=!0,$.inidb.set("noticeSettings","noticetoggle","true"),$.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-enabled")))),m.equalsIgnoreCase("toggleoffline")&&(o?(o=!1,$.inidb.set("noticeSettings","noticeOffline","false"),$.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-disabled.offline"))):(o=!0,$.inidb.set("noticeSettings","noticeOffline","true"),$.say($.whisperPrefix(c)+$.lang.get("noticehandler.notice-enabled.offline"))))}}),setInterval(function(){s&&$.bot.isModuleEnabled("./systems/noticeSystem.js")&&a>0&&r>=n&&o&&$.isOnline($.channelName)&&(i(),r=0)},60*t*1e3,"noticeTimer"),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/noticeSystem.js")&&$.registerChatCommand("./systems/noticeSystem.js","notice",1)})}();
