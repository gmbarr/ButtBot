(function(){var e=0,t=[],s=0,r=false,f=false,i=$.inidb.exists("settings","tRaffleMSGToggle")?$.getIniDbBoolean("settings","tRaffleMSGToggle"):false,a="";function n(t,i,n,g){if(f){$.say($.whisperPrefix(t)+$.lang.get("ticketrafflesystem.err.raffle.opened"));return}if(!i){$.say($.whisperPrefix(sender)+$.lang.get("ticketrafflesystem.err.missing.syntax"));return}if(i){s=parseInt(i)}if(n){e=parseInt(n)}if(g&&g.equalsIgnoreCase("-followers")){r=true;a=$.lang.get("ticketrafflesystem.msg.need.to.be.follwing")}l(s,r,e)}function l(e,t,s){$.say($.lang.get("ticketrafflesystem.raffle.opened",e,$.getPointsString(s),a));f=true}function g(i){if(!f){$.say($.whisperPrefix(i)+$.lang.get("ticketrafflesystem.err.raffle.not.opened"));return}f=false;r=false;s=0;e=0;a="";$.say($.lang.get("ticketrafflesystem.raffle.closed"));o();t=[]}function o(e){if(t.length==0){$.say($.lang.get("ticketrafflesystem.raffle.close.err"));return}if(e){$.say($.lang.get("ticketrafflesystem.raffle.repick",$.username.resolve($.randElement(t))));return}o=$.randElement(t);$.say($.lang.get("ticketrafflesystem.winner",$.username.resolve(o)))}function y(a,n){if(!f){$.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.err.raffle.not.opened"));return}if(n>s){$.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.only, buy.amount",s));return}for(var l=0,g=0;l<t.length;l++){if(t[l].equalsIgnoreCase(a)){g++;if(g>=s){$.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.litmi.hit",s));return}}}if(r){if(!$.user.isFollower(a)){$.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.err.not.following"));return}}if(e>0){if(e>$.getUserPoints(a)){$.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.err.points",$.pointNameMultiple));return}}$.inidb.decr("points",a,n*e);if(i){$.say($.lang.get("ticketrafflesystem.entered",$.username.resolve(a),tickets))}for(var l=0;l<n;l++){t.push(a)}}$.bind("command",function(e){var t=e.getSender(),s=e.getCommand(),r=e.getArguments(),f=e.getArgs(),a=f[0];if(s.equalsIgnoreCase("traffle")){if(!$.isModv3(t,e.getTags())){$.say($.whisperPrefix(t)+$.modMsg);return}if(!a){$.say($.whisperPrefix(t)+$.lang.get("ticketrafflesystem.usage"));return}if(a.equalsIgnoreCase("open")){n(t,f[1],f[2],f[3])}if(a.equalsIgnoreCase("close")){g(t)}if(a.equalsIgnoreCase("repick")){o(true)}if(a.equalsIgnoreCase("messagetoggle")){if(i){i=false;$.inidb.set("settings","tRaffleMSGToggle",i);$.say($.whisperPrefix(t)+$.lang.get("ticketrafflesystem.msg.disabled"))}else{i=true;$.inidb.set("settings","tRaffleMSGToggle",i);$.say($.whisperPrefix(t)+$.lang.get("ticketrafflesystem.msg.enabled"))}}}if(s.equalsIgnoreCase("tickets")){if(!a){$.say($.whisperPrefix(t)+$.lang.get("ticketrafflesystem.ticket.usage"));return}y(t,parseInt(a))}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/ticketRaffleSystem.js")){$.registerChatCommand("./systems/ticketRaffleSystem.js","traffle",2)}})})();
