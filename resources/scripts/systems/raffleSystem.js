(function(){var e=0,s=[],r="",f=false,a=false,t=$.inidb.exists("settings","raffleMSGToggle")?$.getIniDbBoolean("settings","raffleMSGToggle"):false,n="";function i(s,t,i,g){if(a){$.say($.whisperPrefix(s)+$.lang.get("rafflesystem.err.raffle.opened"));return}if(!t){$.say($.whisperPrefix(s)+$.lang.get("rafflesystem.err.missing.syntax"));return}if(t.contains("!")){t=t.replace("!","")}if(t){r=t}if(i){e=parseInt(i)}if(g&&g.equalsIgnoreCase("-followers")){f=true;n=$.lang.get("rafflesystem.msg.need.to.be.follwing")}l(t,f,e)}function l(e,r,f){$.say($.lang.get("rafflesystem.raffle.opened",$.getPointsString(f),e,n));$.registerChatCommand("./systems/raffleSystem.js",e,7);s=[];a=true}function g(s){if(!a){$.say($.whisperPrefix(s)+$.lang.get("rafflesystem.err.raffle.not.opened"));return}a=false;f=false;r="";e=0;n="";$.say($.lang.get("rafflesystem.raffle.closed"));o()}function o(e){if(s.length==0){$.say($.lang.get("rafflesystem.raffle.close.err"));return}if(e){$.say($.lang.get("rafflesystem.raffle.repick",$.username.resolve($.randElement(s))));return}o=$.randElement(s);$.say($.lang.get("rafflesystem.winner",$.username.resolve(o)))}function m(e,r){if(!a){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.raffle.not.opened"));return}if(f){if(!$.user.isFollower(e)){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.not.following"));return}}if($.list.contains(s,e)){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.enter.error.alreadyentered"));return}if(r>0){$.inidb.decr("points",e,r);if(r>$.getUserPoints(e)){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.points",$.pointNameMultiple));return}}if(t){$.say($.lang.get("rafflesystem.entered",$.username.resolve(e)))}s.push(e)}$.bind("command",function(s){var f=s.getSender(),a=s.getCommand(),n=s.getArguments(),l=s.getArgs(),y=l[0];if(a.equalsIgnoreCase("raffle")){if(!$.isModv3(f,s.getTags())){$.say($.whisperPrefix(f)+$.modMsg);return}if(!y){$.say($.whisperPrefix(f)+$.lang.get("rafflesystem.usage"));return}if(y.equalsIgnoreCase("open")){i(f,l[1],l[2],l[3])}if(y.equalsIgnoreCase("close")){g(f)}if(y.equalsIgnoreCase("repick")){o(true)}if(y.equalsIgnoreCase("messagetoggle")){if(t){t=false;$.inidb.set("settings","raffleMSGToggle",t);$.say($.whisperPrefix(f)+$.lang.get("rafflesystem.msg.disabled"))}else{t=true;$.inidb.set("settings","raffleMSGToggle",t);$.say($.whisperPrefix(f)+$.lang.get("rafflesystem.msg.enabled"))}}}if(a.equalsIgnoreCase(r)){m(f,e)}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/raffleSystem.js")){$.registerChatCommand("./systems/raffleSystem.js","raffle",2)}})})();
