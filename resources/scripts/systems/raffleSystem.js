!function(){function e(e){var r=!0;0==startTime&&(f.startTime=$.systemTime(),r=!1),$.isDirectory("./addons/raffleSystem")||$.mkDir("./addons/raffleSystem"),$.writeToFile(e,"./addons/raffleSystem/raffle_"+$.logging.getLogDateString(startTime)+"_"+$.logging.getLogTimeString(startTime)+".txt",r)}function r(r,t,a,i,o){return f.raffleActive?void $.say($.whisperPrefix(o)+$.lang.get("rafflesystem.start.error.alreadyrunning")):($.registerChatCommand("./systems/raffleSystem.js",r,7),f.keyWord=r,o&&(f.raffleMaster=o),t&&(f.forFollowers=t),!isNaN(a)&&a>0&&(f.raffleTimerId=setTimeout(function(){s()},1e3*a)),!isNaN(i)&&i>0&&(f.cost=i),f.raffleActive=!0,$.say(n(o)),void e("New Raffle: "+(o?"By "+o:"")+(r?", Keyword !"+r:"")+(t?", followers only":"")+(a?", Run time "+a+"seconds":"")+(i?", Cost "+i+" "+$.pointNameMultiple:"")))}function s(){return raffleActive?(raffleTimerId>-1&&(clearTimeout(raffleTimerId),f.raffleTimerId=-1),e("Raffle ended"),t(),f.raffleActive=!1,void(f.startTime=0)):void $.say($.whisperPrefix(f.raffleMaster)+$.lang.get("rafflesystem.close.error.notrunning"))}function t(r){if(f.winner=$.randElement(f.users),r){if(0==f.users.length)return void $.say($.lang.get("rafflesystem.redraw.error.noentries"));$.say($.lang.get("rafflesystem.redraw.success",$.username.resolve(winner))),e("Redraw winner: "+winner)}else{if(0==f.users.length)return void $.say($.lang.get("rafflesystem.close.success.noentries"));$.say($.lang.get("rafflesystem.close.success",$.username.resolve(winner))),e("Winner: "+winner)}}function a(r){if(raffleActive){if(r==$.channelName)return void $.say($.whisperPrefix(r)+$.lang.get("rafflesystem.enter.error.iscaster"));if($.list.contains(f.users,r))return void $.say($.whisperPrefix(r)+$.lang.get("rafflesystem.enter.error.alreadyentered"));if(f.forFollowers&&!$.user.isFollower(r))return void $.say($.whisperPrefix(r)+$.lang.get("rafflesystem.enter.error.notfollows"));if(f.cost>0&&f.cost>$.getUserPoints(r))return void $.say($.whisperPrefix(r)+$.lang.get("rafflesystem.enter.error.needpoints"));f.users.push(r),e("Join: "+r),$.say($.whisperPrefix(r)+$.lang.get("rafflesystem.enter.success"))}else $.say($.whisperPrefix(r)+$.lang.get("rafflesystem.enter.error.notrunning"))}function n(e){return f.raffleActive?$.lang.get("rafflesystem.enter.notkeyword",f.keyWord):$.whisperPrefix(e)+$.lang.get("rafflesystem.enter.error.notrunning")}function i(e,r,s){var t=!0;return e&&""!=e||(t=!1),r&&isNaN(parseInt(r))&&(t=!1),s&&isNaN(parseInt(s))&&(t=!1),t?!0:($.say($.whisperPrefix(f.raffleMaster)+$.lang.get("rafflesystem.start.usage")),!1)}var f={raffleActive:!1,keyWord:"",time:0,forFollowers:!1,cost:0,users:[],winner:"",raffleMaster:$.ownerName,raffleTimerId:-1,startTime:0};$.bind("command",function(e){var o,l,g=e.getSender().toLowerCase(),m=e.getCommand(),d=e.getArgs();if(m.equalsIgnoreCase("raffle")){if(0==d.length)return void $.say(n(g));if(o=d[0],l=(e.getArguments()+"").replace(o,"").trim(),o){if(!$.isModv3(g,e.getTags()))return void $.say($.whisperPrefix(g)+$.modMsg);if(o.equalsIgnoreCase("start")){var y=l.indexOf("-follow")>-1,u=l.match(/-k\s([a-z]+)/i),c=l.match(/-t\s([0-9]+)/i),w=l.match(/-c\s([0-9]+)/i);u=u?u[1]:"",c=c?c[1]:"",w=w?w[1]:"",i(u.toString(),parseInt(c),parseInt(w))&&r(u.toString(),y,parseInt(c),parseInt(w),$.username.resolve(g))}o.equalsIgnoreCase("close")&&s(),o.equalsIgnoreCase("redraw")&&(f.raffleActive?$.say($.whisperPrefix(g)+"You can't repick a winner during a raffle!"):t(!0))}}m.equalsIgnoreCase(u)&&a(g)}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/raffleSystem.js")&&$.registerChatCommand("./systems/raffleSystem.js","raffle",2)}),$.bot.isModuleEnabled("./systems/raffleSystem.js")&&!$.bot.isModuleEnabled("./systems/pointSystem.js")&&$.logError("raffleSystem.js",402,"Disabled. ./systems/pointSystem.js is not enabled.")}();
