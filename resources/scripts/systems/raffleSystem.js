!function(){function e(e,r,a,n,t){return o?void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.raffle.opened")):r&&a?0>a?void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.negative")):(r.contains("!")&&(r=r.replace("!","")),r&&(l=r),a&&(f=parseInt(a)),n&&(y=parseInt(n)),t&&t.equalsIgnoreCase("-followers")&&(g=!0,d=$.lang.get("rafflesystem.msg.need.to.be.follwing")),void s(r,f,g,y,d)):void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.missing.syntax"))}function s(e,s,a,n,t){if($.say($.lang.get("rafflesystem.raffle.opened",$.getPointsString(s),e,t)),$.registerChatCommand("./systems/raffleSystem.js",e,7),i=[],o=!0,n>0)var t=setInterval(function(){$.say($.lang.get("rafflesystem.warn",e)),clearInterval(t)},n/2*1e3),f=setInterval(function(){r(),clearInterval(f)},1e3*n)}function r(e,s){return o?(t(),$.unregisterChatCommand(s),$.say($.lang.get("rafflesystem.raffle.closed")),void a()):void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.raffle.not.opened"))}function a(e){if(0==i.length)return void $.say($.lang.get("rafflesystem.raffle.close.err"));if(e)return void $.say($.lang.get("rafflesystem.raffle.repick",$.username.resolve($.randElement(i))));var s=$.randElement(i);$.say($.lang.get("rafflesystem.winner",$.username.resolve(s)))}function n(e,s){if(!o)return void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.raffle.not.opened"));if(g&&!$.user.isFollower(e))return void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.not.following"));if($.list.contains(i,e))return void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.enter.error.alreadyentered"));if(s>0){if(s>$.getUserPoints(e))return void $.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.points",$.pointNameMultiple));$.inidb.decr("points",e,s)}m&&$.say($.lang.get("rafflesystem.entered",e)),i.push(e)}function t(){o=!1,g=!1,l="",f=0,y=0,d=""}var f=0,i=[],l="",g=!1,o=!1,m=$.inidb.exists("settings","raffleMSGToggle")?$.getIniDbBoolean("settings","raffleMSGToggle"):!0,y=0,d="";$.bind("command",function(s){var t=s.getSender(),i=s.getCommand(),g=(s.getArguments(),s.getArgs()),o=g[0];if(i.equalsIgnoreCase("raffle")){if(!$.isModv3(t,s.getTags()))return void $.say($.whisperPrefix(t)+$.modMsg);if(!o)return void $.say($.whisperPrefix(t)+$.lang.get("rafflesystem.usage"));o.equalsIgnoreCase("open")&&e(t,g[1],g[2],g[3],g[4]),o.equalsIgnoreCase("close")&&r(t,l),o.equalsIgnoreCase("repick")&&a(!0),o.equalsIgnoreCase("messagetoggle")&&(m?(m=!1,$.inidb.set("settings","raffleMSGToggle",m),$.say($.whisperPrefix(t)+$.lang.get("rafflesystem.msg.disabled"))):(m=!0,$.inidb.set("settings","raffleMSGToggle",m),$.say($.whisperPrefix(t)+$.lang.get("rafflesystem.msg.enabled"))))}i.equalsIgnoreCase(l)&&n(t,f)}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/raffleSystem.js")&&$.registerChatCommand("./systems/raffleSystem.js","raffle",2)})}();
