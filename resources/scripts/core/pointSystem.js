!function(){function e(e){return $.inidb.exists("points",e)?parseInt($.inidb.get("points",e)):0}function i(e){return 1==parseInt(e)?e+" "+m:e+" "+u}function t(e){if(p){if(!$.isModv3(e.getSender().toLowerCase(),e.getTags()))return $.say($.whisperPrefix(e.getSender().toLowerCase())+$.modMsg),!1}else if(!$.isAdmin(e.getSender().toLowerCase()))return $.say($.whisperPrefix(e.getSender().toLowerCase())+$.adminMsg),!1;return!0}function n(e){e&&$.commandExists(e)&&$.unregisterChatCommand(e),$.commandExists(m)||e||$.registerChatCommand("./core/pointSystem.js",$.pointNameSingle,7),$.commandExists(u)||e||$.registerChatCommand("./core/pointSystem.js",$.pointNameMultiple,7)}function s(){var e,i,t,n=$.systemTime(),s=[];if($.bot.isModuleEnabled("./core/pointSystem.js")){if($.isOnline($.channelName)){if(!(r>0&&n>=l+6e4*r))return;i=o}else{if(!(g>0&&n>=l+6e4*g))return;i=a}for(t in $.users)e=$.users[t][0].toLowerCase(),$.inidb.incr("points",e,i),s.push(e);$.log("pointSystem","Executed "+$.pointNameMultiple+" payouts. Amount: "+i+". Users: "+(s.length>0?s.join(", "):"none")),l=n}}var o=($.getIniDbBoolean("pointSettings","pointsTimedGain")?$.getIniDbBoolean("pointSettings","pointsTimedGain"):!0,$.inidb.exists("pointSettings","onlineGain")?parseInt($.inidb.get("pointSettings","onlineGain")):1),a=$.inidb.exists("pointSettings","offlineGain")?parseInt($.inidb.get("pointSettings","offlineGain")):1,r=$.inidb.exists("pointSettings","onlinePayoutInterval")?parseInt($.inidb.get("pointSettings","onlinePayoutInterval")):10,g=$.inidb.exists("pointSettings","offlinePayoutInterval")?parseInt($.inidb.get("pointSettings","offlinePayoutInterval")):0,p=$.getIniDbBoolean("pointSettings","modPointsPermToggle")?$.getIniDbBoolean("pointSettings","modPointsPermToggle"):!1,l=0,m=$.inidb.exists("pointSettings","pointNameSingle")?$.inidb.get("pointSettings","pointNameSingle"):"Point",u=$.inidb.exists("pointSettings","pointNameMultiple")?$.inidb.get("pointSettings","pointNameMultiple"):"Points";$.bind("command",function(e){var i,s,l=e.getSender().toLowerCase(),m=$.username.resolve(l,e.getTags()),u=e.getCommand(),f=e.getArgs(),d=f[0],y=f[1],S=f[2];if(u.equalsIgnoreCase("points")||u.equalsIgnoreCase($.pointNameMultiple)||u.equalsIgnoreCase($.pointNameSingle))if(d){if(!t(e))return;if(d.equalsIgnoreCase("add")){if(y=(y+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.add.usage"));if(!y||!$.user.isKnown(y))return void $.say($.whisperPrefix(l)+$.lang.get("common.user.404",y));if(0>S)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.add.error.negative",$.pointNameMultiple));$.user.isKnown(y)&&($.inidb.incr("points",y,S),$.say($.lang.get("pointsystem.add.success",$.getPointsString(S),$.username.resolve(y),$.getPointsString($.getUserPoints(y)))))}if(d.equalsIgnoreCase("take")){if(y=(y+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.take.usage"));if(!y||!$.user.isKnown(y))return void $.say($.whisperPrefix(l)+$.lang.get("common.user.404",y));if(S>$.getUserPoints(y))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.take.error.toomuch",m,$.pointNameMultiple));$.inidb.decr("points",y,S),$.say($.lang.get("pointsystem.take.success",$.getPointsString(S),$.username.resolve(y),$.getPointsString($.getUserPoints(y))))}if(d.equalsIgnoreCase("set")){if(y=(y+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.setbalance.usage"));if(!y||!$.user.isKnown(y))return void $.say($.whisperPrefix(l)+$.lang.get("common.user.404",y));if(0>S)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.setbalance.error.negative",$.pointNameMultiple));$.inidb.set("points",y,S),$.say($.lang.get("pointsystem.setbalance.success",$.pointNameSingle,$.username.resolve(y),$.getPointsString($.getUserPoints(y))))}if(d.equalsIgnoreCase("all")){if(y=parseInt(y),isNaN(y))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.add.all.usage"));if(parseInt(y)<0)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.add.error.negative",$.pointNameMultiple));for(s in $.users)$.inidb.incr("points",$.users[s][0].toLowerCase(),parseInt(y));$.say($.lang.get("pointsystem.add.all.success",$.getPointsString(y)))}if(d.equalsIgnoreCase("setname")){if("single"==y&&S)return i=$.pointNameSingle,$.pointNameSingle=S,$.inidb.set("pointSettings","pointNameSingle",$.pointNameSingle),n(i),n(),void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.name.single.success",i,$.pointNameSingle));if("multiple"==y&&S)return i=$.pointNameMultiple,$.pointNameMultiple=S,$.inidb.set("pointSettings","pointNameMultiple",$.pointNameMultiple),n(i),n(),void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.name.multiple.success",i,$.pointNameMultiple));if(!S)return i=$.pointNameMultiple,$.pointNameMultiple=$.pointNameSingle=S,$.inidb.set("pointSettings","pointNameSingle",$.pointNameSingle),$.inidb.set("pointSettings","pointNameMultiple",$.pointNameSingle),n(i),void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.name.both.success",i,$.pointNameMultiple));$.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.name.usage"))}if(d.equalsIgnoreCase("setgain")){if(y=parseInt(y),isNaN(y))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.gain.usage"));if(0>y)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.gain.error.negative",$.pointNameMultiple));o=y,$.inidb.set("pointSettings","onlineGain",o),$.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.gain.success",$.pointNameSingle,$.getPointsString(o),r))}if(d.equalsIgnoreCase("setofflinegain")){if(y=parseInt(y),isNaN(y))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.gain.offline.usage"));if(0>y)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.gain.error.negative",$.pointNameMultiple));a=y,$.inidb.set("pointSettings","offlineGain",a),$.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.gain.offline.success",$.pointNameSingle,$.getPointsString(a),g))}if(d.equalsIgnoreCase("setinterval")){if(y=parseInt(y),isNaN(y))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.interval.usage"));if(0>y)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.interval.error.negative",$.pointNameMultiple));r=y,$.inidb.set("pointSettings","onlinePayoutInterval",r),$.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.interval.success",$.pointNameSingle,r))}if(d.equalsIgnoreCase("setofflineinterval")){if(y=parseInt(y),isNaN(y))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.interval.offline.usage"));if(0>y)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.interval.error.negative",$.pointNameMultiple));g=y,$.inidb.set("pointSettings","offlinePayoutInterval",g),$.say($.whisperPrefix(l)+$.lang.get("pointsystem.set.interval.offline.success",$.pointNameSingle,g))}d.equalsIgnoreCase("modpermtoggle")&&(p=!p,$.setIniDbBoolean("pointSettings","modPointsPermToggle",p),$.say($.whisperPrefix(l)+$.lang.get("pointsystem.modpermtoggle.success",p?"moderator":"administrator")))}else 0==$.getUserPoints(l)?$.say($.whisperPrefix(l)+$.lang.get("pointsystem.get.self.nopoints",$.pointNameMultiple)):$.say($.whisperPrefix(l)+$.lang.get("pointsystem.get.self.withtime",$.resolveRank(l),$.getPointsString($.getUserPoints(l)),$.getUserTimeString(l)));if(u.equalsIgnoreCase("makeitrain")){if(!$.isAdmin(l))return void $.say($.whisperPrefix(l)+$.adminMsg);if(d=parseInt(d),isNaN(d))return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.makeitrain.usage"));if(1>d)return void $.say($.whisperPrefix(l)+$.lang.get("pointsystem.makeitrain.error.negative",$.pointNameMultiple));for(s in $.users){var P=$.randRange(1,d);i=[],$.inidb.incr("points",$.users[s][0].toLowerCase(),P),$.users[s][0].equalsIgnoreCase($.botName)||i.push($.username.resolve($.users[s][0])+": "+$.getPointsString(P))}i.length>0&&$.say($.lang.get("pointsystem.makeitrain.success",m,$.pointNameMultiple,i.join(", ")))}}),setInterval(function(){s()},6e4),$.bind("initReady",function(){$.bot.isModuleEnabled("./core/pointSystem.js")&&($.registerChatCommand("./core/pointSystem.js","makeitrain",2),$.registerChatCommand("./core/pointSystem.js","points",7),n())}),$.pointNameSingle=m,$.pointNameMultiple=u,$.getUserPoints=e,$.getPointsString=i}();
