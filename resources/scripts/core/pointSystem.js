(function(){var e=$.getIniDbBoolean("pointSettings","pointsTimedGain")?$.getIniDbBoolean("pointSettings","pointsTimedGain"):true,i=$.inidb.exists("pointSettings","onlineGain")?parseInt($.inidb.get("pointSettings","onlineGain")):1,t=$.inidb.exists("pointSettings","offlineGain")?parseInt($.inidb.get("pointSettings","offlineGain")):1,n=$.inidb.exists("pointSettings","onlinePayoutInterval")?parseInt($.inidb.get("pointSettings","onlinePayoutInterval")):10,s=$.inidb.exists("pointSettings","offlinePayoutInterval")?parseInt($.inidb.get("pointSettings","offlinePayoutInterval")):0,a=$.getIniDbBoolean("pointSettings","modPointsPermToggle")?$.getIniDbBoolean("pointSettings","modPointsPermToggle"):false,r=0,o=$.inidb.exists("pointSettings","pointNameSingle")?$.inidb.get("pointSettings","pointNameSingle"):"Point",g=$.inidb.exists("pointSettings","pointNameMultiple")?$.inidb.get("pointSettings","pointNameMultiple"):"Points";function l(e){if($.inidb.exists("points",e)){return parseInt($.inidb.get("points",e))}else{return 0}}function p(e){if(parseInt(e)==1){return e+" "+o}return e+" "+g}function m(e){if(a){if(!$.isModv3(e.getSender().toLowerCase(),e.getTags())){$.say($.whisperPrefix(e.getSender().toLowerCase())+$.modMsg);return false}}else if(!$.isAdmin(e.getSender().toLowerCase())){$.say($.whisperPrefix(e.getSender().toLowerCase())+$.adminMsg);return false}return true}function u(e){if(e&&$.commandExists(e)){$.unregisterChatCommand(e)}if(!$.commandExists(o)){$.registerChatCommand("./core/pointSystem.js",o,7)}if(!$.commandExists(g)){$.registerChatCommand("./core/pointSystem.js",g,7)}}function f(){var e=$.systemTime(),a=[],o,g,l;if(!$.bot.isModuleEnabled("./core/pointSystem.js")){return}if($.isOnline($.channelName)){if(n>0&&r+n*6e4<=e){g=i}else{return}}else{if(s>0&&r+s*6e4<=e){g=t}else{return}}for(l in $.users){o=$.users[l][0].toLowerCase();$.inidb.incr("points",o,g);a.push(o)}$.log("pointSystem","Executed "+$.pointNameMultiple+" payouts. Amount: "+g+". Users: "+(a.length>0?a.join(", "):"none"));r=e}$.bind("command",function(e){var r=e.getSender().toLowerCase(),o=$.username.resolve(r,e.getTags()),g=e.getCommand(),l=e.getArgs(),p=l[0],f=l[1],y=l[2],d,P;if(g.equalsIgnoreCase("points")||g.equalsIgnoreCase($.pointNameMultiple)||g.equalsIgnoreCase($.pointNameSingle)){if(!p){if($.getUserPoints(r)==0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.get.self.nopoints",$.pointNameMultiple))}else{$.say($.whisperPrefix(r)+$.lang.get("pointsystem.get.self.withtime",$.resolveRank(r),$.getPointsString($.getUserPoints(r)),$.getUserTimeString(r)))}}else{if(!m(e)){return}if(p.equalsIgnoreCase("add")){f=(f+"").toLowerCase();y=parseInt(y);if(isNaN(y)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.add.usage"));return}if(!f||!$.user.isKnown(f)){$.say($.whisperPrefix(r)+$.lang.get("common.user.404",f));return}if(y<0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.add.error.negative",$.pointNameMultiple));return}if($.user.isKnown(f)){$.inidb.incr("points",f,y);$.say($.lang.get("pointsystem.add.success",$.getPointsString(y),$.username.resolve(f),$.getPointsString($.getUserPoints(f))))}}if(p.equalsIgnoreCase("take")){f=(f+"").toLowerCase();y=parseInt(y);if(isNaN(y)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.take.usage"));return}if(!f||!$.user.isKnown(f)){$.say($.whisperPrefix(r)+$.lang.get("common.user.404",f));return}if(y>$.getUserPoints(f)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.take.error.toomuch",o,$.pointNameMultiple));return}$.inidb.decr("points",f,y);$.say($.lang.get("pointsystem.take.success",$.getPointsString(y),$.username.resolve(f),$.getPointsString($.getUserPoints(f))))}if(p.equalsIgnoreCase("set")){f=(f+"").toLowerCase();y=parseInt(y);if(isNaN(y)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.setbalance.usage"));return}if(!f||!$.user.isKnown(f)){$.say($.whisperPrefix(r)+$.lang.get("common.user.404",f));return}if(y<0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.setbalance.error.negative",$.pointNameMultiple));return}$.inidb.set("points",f,y);$.say($.lang.get("pointsystem.setbalance.success",$.pointNameSingle,$.username.resolve(f),$.getPointsString($.getUserPoints(f))))}if(p.equalsIgnoreCase("all")){f=parseInt(f);if(isNaN(f)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.add.all.usage"));return}if(f<0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.add.error.negative",$.pointNameMultiple));return}for(P in $.users){$.inidb.incr("points",$.users[P][0].toLowerCase())}$.say($.lang.get("pointsystem.add.all.success",$.getPointsString(f)))}if(p.equalsIgnoreCase("setname")){f+"";y+"";if(f=="single"&&y){d=$.pointNameSingle;$.pointNameSingle=y;$.inidb.set("pointSettings","pointNameSingle",$.pointNameSingle);u(d);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.name.single.success",d,$.pointNameSingle));return}if(f=="multiple"&&y){d=$.pointNameMultiple;$.pointNameMultiple=y;$.inidb.set("pointSettings","pointNameMultiple",$.pointNameMultiple);u(d);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.name.multiple.success",d,$.pointNameMultiple));return}if(!y){d=$.pointNameMultiple;$.pointNameMultiple=$.pointNameSingle=y;$.inidb.set("pointSettings","pointNameSingle",$.pointNameSingle);$.inidb.set("pointSettings","pointNameMultiple",$.pointNameSingle);u(d);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.name.both.success",d,$.pointNameMultiple));return}$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.name.usage"))}if(p.equalsIgnoreCase("setgain")){f=parseInt(f);if(isNaN(f)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.gain.usage"));return}if(f<0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.gain.error.negative",$.pointNameMultiple));return}i=f;$.inidb.set("pointSettings","onlineGain",i);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.gain.success",$.pointNameSingle,$.getPointsString(i),n))}if(p.equalsIgnoreCase("setofflinegain")){f=parseInt(f);if(isNaN(f)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.gain.offline.usage"));return}if(f<0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.gain.error.negative",$.pointNameMultiple));return}t=f;$.inidb.set("pointSettings","offlineGain",t);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.gain.offline.success",$.pointNameSingle,$.getPointsString(t),s))}if(p.equalsIgnoreCase("setinterval")){f=parseInt(f);if(isNaN(f)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.interval.usage"));return}if(f<0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.interval.error.negative",$.pointNameMultiple));return}n=f;$.inidb.set("pointSettings","onlinePayoutInterval",n);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.interval.success",$.pointNameSingle,n))}if(p.equalsIgnoreCase("setofflineinterval")){f=parseInt(f);if(isNaN(f)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.interval.offline.usage"));return}if(f<0){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.interval.error.negative",$.pointNameMultiple));return}s=f;$.inidb.set("pointSettings","offlinePayoutInterval",s);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.set.interval.offline.success",$.pointNameSingle,s))}if(p.equalsIgnoreCase("modpermtoggle")){a=!a;$.setIniDbBoolean("pointSettings","modPointsPermToggle",a);$.say($.whisperPrefix(r)+$.lang.get("pointsystem.modpermtoggle.success",a?"moderator":"administrator"))}}}if(g.equalsIgnoreCase("makeitrain")){if(!$.isAdmin(r)){$.say($.whisperPrefix(r)+$.adminMsg);return}p=parseInt(p);if(isNaN(p)){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.makeitrain.usage"));return}if(p<1){$.say($.whisperPrefix(r)+$.lang.get("pointsystem.makeitrain.error.negative",$.pointNameMultiple));return}for(P in $.users){var S=$.randRange(1,p);d=[];$.inidb.incr("points",$.users[P][0].toLowerCase(),S);if(!$.users[P][0].equalsIgnoreCase($.botName)){d.push($.username.resolve($.users[P][0])+": "+$.getPointsString(S))}}if(d.length>0){$.say($.lang.get("pointsystem.makeitrain.success",o,$.pointNameMultiple,d.join(", ")))}}});setInterval(function(){f()},6e4);$.bind("initReady",function(){if($.bot.isModuleEnabled("./core/pointSystem.js")){$.registerChatCommand("./core/pointSystem.js","makeitrain",2);$.registerChatCommand("./core/pointSystem.js","points",7);u()}});$.pointNameSingle=o;$.pointNameMultiple=g;$.getUserPoints=l;$.getPointsString=p})();
