!function(){function e(e){return $.list.contains(N,e,0)}function s(e){return e.equalsIgnoreCase($.botName)}function r(e){return e.equalsIgnoreCase($.ownerName)}function i(e){return 0==$.getUserGroupId(e)||$.isOwner(e)||$.isBot(e)}function n(e){return $.getUserGroupId(e)<=1||$.isOwner(e)||$.isBot(e)}function o(e){return $.getUserGroupId(e)<=2||$.isOwner(e)||$.isBot(e)}function t(e,s){return $.isAdmin(e)||null!=s&&"{}"!=s&&s.get("user-type").equalsIgnoreCase("mod")||$.isMod(e)}function u(e){var s;for(s in q)if(q[s][0].equalsIgnoreCase(e))return!0;return!1}function a(e,s){return null!=s&&"{}"!=s&&s.get("subscriber").equalsIgnoreCase("1")||$.isSub(e)}function g(e){return null!=e&&"{}"!=e&&e.get("turbo").equalsIgnoreCase("1")||!1}function d(e){return 4==$.getUserGroupId(e)}function p(e){return 5==$.getUserGroupId(e)}function l(e){return $.getUserGroupId(e)<=6||$.isOwner(e)||$.isBot(e)}function b(e){return $.list.contains(L,e.toLowerCase(),0)}function m(e){return $.list.contains(B,e.toLowerCase())}function f(e){return e=e.toLowerCase(),$.inidb.exists("group",e)?parseInt($.inidb.get("group",e)):7}function c(e){return $.getGroupNameById($.getUserGroupId(e))}function C(e){return e=parseInt(e),$.inidb.exists("groups",e)?$.inidb.get("groups",e):M[7]}function I(e){var s;for(s in M)if(M[s].toLowerCase().indexOf(e.toLowerCase()))return s;return 7}function h(e){return parseInt($.inidb.get("grouppoints",$.getUserGroupName(e)))}function w(e,s){$.userExists(e.toLowerCase())&&$.inidb.set("group",e.toLowerCase(),s)}function y(e,s){$.setUserGroupById(e,$.getGroupIdByName(s))}function v(){var e,s=$.inidb.GetKeyList("groups","");M=[];for(e in s)M[parseInt(s[e])]=$.inidb.get("groups",s[e])}function x(e){var s,r=[];for(s in N)e?$.getUserGroupId(N[s][0])<=e&&r.push(N[s][0]):r.push(N[s][0]);return r}function G(e){$.bot.isModuleEnabled("./handlers/subscribeHandler.js")&&$.inidb.exists("subscribed",e)&&!$.isSub(e)&&($.setIniDbBoolean("subscribed",e,!1),$.inidb.exists("tempsubgroup",e)&&!$.isMod(e)?($.inidb.set("group",e,$.inidb.get("tempsubgroup",e)),$.inidb.del("tempsubgroup",e)):$.inidb.set("group",e,7))}function U(){M[0]&&"Caster"==M[0]||(M[0]="Caster",$.inidb.set("grouppoints","Caster","7"),$.inidb.set("groups","0","Caster")),M[1]&&"Administrator"==M[1]||(M[1]="Administrator",$.inidb.set("grouppoints","Administrator","6"),$.inidb.set("groups","1","Administrator")),M[2]&&"Moderator"==M[2]||(M[2]="Moderator",$.inidb.set("grouppoints","Moderator","5"),$.inidb.set("groups","2","Moderator")),M[3]&&"Subscriber"==M[3]||(M[3]="Subscriber",$.inidb.set("grouppoints","Subscriber","4"),$.inidb.set("groups","3","Subscriber")),M[4]&&"Donator"==M[4]||(M[4]="Donator",$.inidb.set("grouppoints","Donator","3"),$.inidb.set("groups","4","Donator")),M[5]&&"Hoster"==M[5]||(M[5]="Hoster",$.inidb.set("grouppoints","Hoster","2"),$.inidb.set("groups","5","Hoster")),M[6]&&"Regular"==M[6]||(M[6]="Regular",$.inidb.set("grouppoints","Regular","1"),$.inidb.set("groups","6","Regular")),M[7]&&"Viewer"==M[7]||(M[7]="Viewer",$.inidb.set("grouppoints","Viewer","0"),$.inidb.set("groups","7","Viewer"))}var M=[],L=[],q=[],B=[],N=[],O=$.systemTime();$.bind("ircJoinComplete",function(e){var s,r=e.getChannel().getNicks().iterator();for(O=$.systemTime();r.hasNext();)s=r.next().toLowerCase(),$.userExists(s)||N.push([s,$.systemTime()])}),$.bind("ircChannelJoin",function(e){var s=e.getUser().toLowerCase();$.user.isKnown(s)||$.setIniDbBoolean("visited",s,!0),O=$.systemTime(),$.userExists(s)||N.push([s,$.systemTime()])}),$.bind("ircChannelLeave",function(e){var s,r=e.getUser().toLowerCase();for(s in N)N[s][0].equalsIgnoreCase(r)&&(N.splice(s,1),G(r));for(s in L)L[s][0].equalsIgnoreCase(r)&&(L.splice(s,1),G(r))}),$.bind("ircChannelUserMode",function(e){var s,r=e.getUser().toLowerCase();if(e.getMode().equalsIgnoreCase("o"))if(e.getAdd())$.hasModeO(r)||($.isOwner(r)?(L.push([r,0]),$.inidb.set("group",r,0)):$.isAdmin(r)?(L.push([r,1]),$.inidb.set("group",r,1)):(L.push([r,2]),$.inidb.set("group",r,2)));else for(s in L)L[s][0].equalsIgnoreCase(r)&&(L.splice(s,1),G(r))}),$.bind("ircPrivateMessage",function(e){var s,r,i=e.getSender().toLowerCase(),n=e.getMessage().toLowerCase().trim(),o="the moderators of this room are: ",t=[];if(i.equalsIgnoreCase("jtv")){if(n.indexOf(o)>-1){s=n.replace(o,"").split(", "),B=[];for(r in s)B.push(s[r]);$.saveArray(B,"addons/mods.txt",!1)}if(n.indexOf("specialuser")>-1&&(s=n.split(" "),s[2].equalsIgnoreCase("subscriber"))){for(r in q)if(q[r][0].equalsIgnoreCase(s[1]))return void(q[r][1]=$.systemTime()+1e4);q.push([s[1],$.systemTime()+1e4]);for(r in q)t.push(q[r][0]);$.saveArray(t,"addons/subs.txt",!1)}}}),$.bind("command",function(e){var s=e.getSender().toLowerCase(),r=e.getCommand(),i=e.getArgs();if(r.equalsIgnoreCase("users")&&(N.length>20?$.say($.whisperPrefix(s)+$.lang.get("permissions.current.listtoolong",N.length)):$.say($.whisperPrefix(s)+$.lang.get("permissions.current.users",x().join(", ")))),r.equalsIgnoreCase("mods")){var n=x(2);n.length>20?$.say($.whisperPrefix(s)+$.lang.get("permissions.current.listtoolong",n.length)):$.say($.whisperPrefix(s)+$.lang.get("permissions.current.mods",n.join(", ")))}if(r.equalsIgnoreCase("group")){if(!$.isModv3(s,e.getTags())||!i[0])return void $.say($.whisperPrefix(s)+$.lang.get("permissions.group.self.current",$.getUserGroupName(s)));var o=i[0],t=parseInt(i[1]);if(i.length<2||isNaN(t)||$.outOfRange(t,0,M.length-1))return void $.say($.whisperPrefix(s)+$.lang.get("permissions.group.usage"));if(t<$.getUserGroupId(s))return void $.say($.whisperPrefix(s)+$.lang.get("permissions.group.set.error.abovegroup"));if(t==$.getUserGroupId(s))return void $.say($.whisperPrefix(s)+$.lang.get("permissions.group.set.error.samegroup"));$.inidb.set("group",o.toLowerCase(),t),$.say($.whisperPrefix(s)+$.lang.get("permissions.group.set.success",$.username.resolve(o),C(t)+" ("+t+")"))}}),v(),U(),$.bind("initReady",function(){$.registerChatCommand("./core/permissions.js","group",7),$.registerChatCommand("./core/permissions.js","users",7),$.registerChatCommand("./core/permissions.js","mods",7)}),$.casterMsg=$.lang.get("cmd.casteronly"),$.adminMsg=$.lang.get("cmd.adminonly"),$.modMsg=$.lang.get("cmd.modonly"),$.userGroups=M,$.modeOUsers=L,$.subUsers=q,$.modListUsers=B,$.users=N,$.lastJoinPart=O,$.userExists=e,$.isBot=s,$.isOwner=r,$.isCaster=i,$.isAdmin=n,$.isMod=o,$.isModv3=t,$.isOwner=r,$.isSub=u,$.isSubv3=a,$.isTurbo=g,$.isDonator=d,$.isHoster=p,$.isReg=l,$.hasModeO=b,$.hasModList=m,$.getUserGroupId=f,$.getUserGroupName=c,$.getGroupNameById=C,$.getGroupIdByName=I,$.getGroupPointMultiplier=h,$.setUserGroupById=w,$.setUserGroupByName=y}();
