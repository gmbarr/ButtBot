!function(){function e(e){if(a){if(!$.isModv3(e.getSender().toLowerCase(),e.getTags()))return!1}else if(!$.isAdmin(e.getSender().toLowerCase()))return!1;return!0}function t(e,t){var i=e.getFullYear(),s=e.getMonth()+1,r=e.getDate(),n=e.getHours(),o=e.getMinutes();return t?n+":"+o:r+"-"+s+"-"+i+" "+n+":"+o}function i(e,t){var i=Math.floor,s=e/3600,r=s%1*60;return t?i(s)+"hrs ":e>60?(i(s)+"hrs "+i(~~r)+"min ").replace(/^0hrs/,""):i(r%1*60)+"sec"}function s(e){return $.inidb.exists("time",e)?$.inidb.get("time",e):0}function r(e){return $.getTimeString($.getUserTime(e))}var n=$.inidb.exists("timeSettings","timeLevel")?$.getIniDbBoolean("timeSettings","timeLevel"):!1,o=$.inidb.exists("timeSettings","keepTimeWhenOffline")?$.getIniDbBoolean("timeSettings","keepTimeWhenOffline"):!1,a=$.inidb.exists("timeSettings","modTimePermToggle")?$.getIniDbBoolean("timeSettings","modTimePermToggle"):!1,m=$.inidb.exists("timeSettings","timePromoteHours")?parseInt($.inidb.get("timeSettings","timePromoteHours")):50,g=6;$.bind("command",function(t){var i,s,r=t.getSender().toLowerCase(),l=$.username.resolve(r),u=t.getCommand(),d=t.getArgs(),f=d[0];if(u.equalsIgnoreCase("time"))if(e(t)&&f){if(i=d[1],s=parseInt(d[2]),f.equalsIgnoreCase("add")){if(!i||isNaN(s))return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.add.usage"));if(i=i.toLowerCase(),0>s)return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.add.error.negative"));$.user.isKnown(i)?($.inidb.incr("time",i,s),$.say($.whisperPrefix(r)+$.lang.get("timesystem.add.success",$.getTimeString(s),$.username.resolve(i),$.getUserTimeString(i)))):$.say($.whisperPrefix(r)+$.lang.get("common.user.404",$.username.resolve(i)))}if(f.equalsIgnoreCase("take")){if(!i||isNaN(s))return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.take.usage"));if($.user.isKnown(r)&&$.say($.whisperPrefix(r)+$.lang.get("common.user.404",l)),s>$.getUserTime(r))return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.take.error.toomuch",l));$.inidb.decr("time",i,s),$.say($.whisperPrefix(r)+$.lang.get("timesystem.take.success",$.getTimeString(s),$.username.resolve(i),$.getUserTimeString(r)))}if(f.equalsIgnoreCase("set")){if(!i||isNaN(s))return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.settime.usage"));if(0>s)return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.settime.error.negative"));$.user.isKnown(i.toLowerCase())?($.inidb.set("time",i,s),$.say($.whisperPrefix(r)+$.lang.get("timesystem.settime.success",$.username.resolve(i),$.getUserTimeString(i.toLowerCase())))):$.say($.whisperPrefix(r)+$.lang.get("common.user.404",i))}if(f.equalsIgnoreCase("promotehours")){if(isNaN(i))return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.set.promotehours.usage"));if(0>i)return void $.say($.whisperPrefix(r)+$.lang.get("timesystem.set.promotehours.error.negative",$.getGroupNameById(g).toLowerCase()));$.inidb.set("settings","timePromoteHours",d[1]),m=parseInt($.inidb.get("settings","timePromoteHours")),$.say($.whisperPrefix(r)+$.lang.get("timesystem.set.promotehours.success",$.getGroupNameById(g).toLowerCase(),m))}f.equalsIgnoreCase("autolevel")&&(n=!n,$.setIniDbBoolean("timeSettings","timeLevel",n),n?$.say($.whisperPrefix(r)+$.lang.get("timesystem.autolevel.enabled",$.getGroupNameById(g).toLowerCase(),m)):$.say($.whisperPrefix(r)+$.lang.get("timesystem.autolevel.disabled",$.getGroupNameById(g).toLowerCase(),m))),(f.equalsIgnoreCase("offline")||f.equalsIgnoreCase("offlinetime"))&&(o=!o,$.setIniDbBoolean("timeSettings","keepTimeWhenOffline",o),o?$.say($.whisperPrefix(r)+$.lang.get("timesystem.offlinetime.enabled")):$.say($.whisperPrefix(r)+$.lang.get("timesystem.offlinetime.disabled"))),f.equalsIgnoreCase("modpermtoggle")&&(a=!a,$.setIniDbBoolean("timeSettings","modTimePermToggle",a),$.say($.whisperPrefix(r)+$.lang.get("timesystem.modpermtoggle.success",a?"Moderator":"Administrator"))),f.equalsIgnoreCase("help")&&$.say($.whisperPrefix(r)+$.lang.get("timesystem.help"))}else $.say($.whisperPrefix(r)+$.lang.get("timesystem.get.other",$.resolveRank(r),$.getUserTimeString(r)));u.equalsIgnoreCase("streamertime")&&$.say($.whisperPrefix(r)+$.lang.get("timesystem.streamertime",(new Date).toLocaleString("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),$.username.resolve($.ownerName)))}),setInterval(function(){var e;if($.bot.isModuleEnabled("./core/timeSystem.js")){if($.isOnline($.channelName)||o)for(e in $.users)$.inidb.incr("time",$.users[e][0].toLowerCase(),60);if(n)for(e in $.users){var t=$.users[e][0].toLowerCase();!$.isMod(t)&&$.inidb.exists("time",t)&&Math.floor(parseInt($.inidb.get("time",t))/3600)>m&&parseInt($.getUserGroupId(t))>g&&($.setUserGroupById(t,g),$.say($.whisperPrefix(t)+$.lang.get("timesystem.autolevel.promoted",$.username.resolve(t),$.getGroupNameById(g).toLowerCase(),m)))}}},6e4),$.bind("initReady",function(){$.bot.isModuleEnabled("./core/timeSystem.js")&&($.registerChatCommand("./core/timeSystem.js","time"),$.registerChatCommand("./core/timeSystem.js","streamertime"))}),$.dateToString=t,$.getTimeString=i,$.getUserTime=s,$.getUserTimeString=r}();
