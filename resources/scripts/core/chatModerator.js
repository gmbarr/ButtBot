!function(){function e(){var e=$.inidb.GetKeyList("blackList","");for(c in e)b.push($.inidb.get("blackList",e[c]));$.consoleDebug("blacklist loaded")}function r(){var e=$.inidb.GetKeyList("whiteList","");for(c in e)p.push($.inidb.get("whiteList",e[c]));$.consoleDebug("whitelist loadee")}function t(e,r){$.say(".timeout "+e+" "+r),setTimeout(function(){$.say(".timeout "+e+" "+r)},1e3)}function a(e){for(c in u)if(u[c].equalsIgnoreCase(e))return t(e,z),i(e),void(J=$.lang.get("chatmoderator.timeout"));t(e,W),i(e),J=$.lang.get("chatmoderator.warning")}function s(e,r){f.length<=1&&$.say("@"+$.username.resolve(e)+", "+r+" "+J)}function i(e){u.push(e),o(e),H>0&&f.push($.systemTime())}function o(e){if(H>0)var r=setTimeout(function(){f.splice(0),clearTimeout(r)},1e3*H);var t=setTimeout(function(){for(c in u)if(u[c].equalsIgnoreCase(e)){u.splice(c,0);break}clearTimeout(t)},36e5)}function n(e){h.push(e);var r=setTimeout(function(){for(c in h)if(h[c].equalsIgnoreCase(e)){h.splice(c,1);break}clearTimeout(r)},1e3*w)}function g(e){return e?$.lang.get("common.enabled"):$.lang.get("common.disabled")}function d(e){var r=e.getSender(),a=e.getMessage().toLowerCase();for(c in b)if(a.contains(b[c].toLowerCase()))return t(r,z),J=$.lang.get("chatmoderator.timeout"),s(r,U),!0;return!1}function l(e){var r=e.getSender();e.getMessage().toLowerCase();for(c in h)if(h[c].equalsIgnoreCase(r)&&$.patternDetector.hasLinks(e))return h.splice(c,1),!0;return!1}function m(e){var r=(e.getSender(),e.getMessage().toLowerCase());for(c in p)if(r.contains(p[c]))return!0;return!1}var c,h=[],u=[],f=[],p=[],b=[],y=$.inidb.exists("chatModerator","linksToggle")?$.getIniDbBoolean("chatModerator","linksToggle"):!0,M=$.inidb.exists("chatModerator","linksMessage")?$.inidb.get("chatModerator","linksMessage"):"you were timed out for linking",w=$.inidb.exists("chatModerator","linkPermitTime")?parseInt($.inidb.get("chatModerator","linkPermitTime")):120,x=$.inidb.exists("chatModerator","capsToggle")?$.getIniDbBoolean("chatModerator","capsToggle"):!0,v=$.inidb.exists("chatModerator","capsMessage")?$.inidb.get("chatModerator","capsMessage"):"you were timed out for overusing caps",P=$.inidb.exists("chatModerator","capsLimitPercent")?parseFloat($.inidb.get("chatModerator","capsLimitPercent")):50,I=$.inidb.exists("chatModerator","capsTriggerLength")?parseInt($.inidb.get("chatModerator","capsTriggerLength")):10,C=$.inidb.exists("chatModerator","spamToggle")?$.getIniDbBoolean("chatModerator","spamToggle"):!0,q=$.inidb.exists("chatModerator","spamMessage")?$.inidb.get("chatModerator","spamMessage"):"you were timed out for spamming",T=$.inidb.exists("chatModerator","spamLimit")?parseInt($.inidb.get("chatModerator","spamLimit")):15,L=$.inidb.exists("chatModerator","symbolsToggle")?$.getIniDbBoolean("chatModerator","symbolsToggle"):!0,k=$.inidb.exists("chatModerator","symbolsMessage")?$.inidb.get("chatModerator","symbolsMessage"):"you were timed out for overusing symbols",D=$.inidb.exists("chatModerator","symbolsLimitPercent")?parseFloat($.inidb.get("chatModerator","symbolsLimitPercent")):50,S=$.inidb.exists("chatModerator","symbolsGroupLimit")?parseFloat($.inidb.get("chatModerator","symbolsGroupLimit")):10,_=$.inidb.exists("chatModerator","symbolsTriggerLength")?parseInt($.inidb.get("chatModerator","symbolsTriggerLength")):5,B=$.inidb.exists("chatModerator","emotesToggle")?$.getIniDbBoolean("chatModerator","emotesToggle"):!0,F=$.inidb.exists("chatModerator","emotesMessage")?$.inidb.get("chatModerator","emotesMessage"):"you were timed out for overusing emotes",j=$.inidb.exists("chatModerator","emotesLimit")?parseInt($.inidb.get("chatModerator","emotesLimit")):15,A=$.inidb.exists("chatModerator","longMessageToggle")?$.getIniDbBoolean("chatModerator","longMessageToggle"):!0,G=$.inidb.exists("chatModerator","longMessageMessage")?$.inidb.get("chatModerator","longMessageMessage"):"you were timed out for posting a long message",N=$.inidb.exists("chatModerator","longMessageLimit")?parseInt($.inidb.get("chatModerator","longMessageLimit")):300,R=$.inidb.exists("chatModerator","colorsToggle")?$.getIniDbBoolean("chatModerator","colorsToggle"):!0,E=$.inidb.exists("chatModerator","colorsMessage")?$.inidb.get("chatModerator","colorsMessage"):"you were timed out for posting a colored message",K=$.inidb.exists("chatModerator","regularsToggle")?$.getIniDbBoolean("chatModerator","regularsToggle"):!1,O=$.inidb.exists("chatModerator","subscribersToggle")?$.getIniDbBoolean("chatModerator","subscribersToggle"):!1,U=$.inidb.exists("chatModerator","blacklistMessage")?$.inidb.get("chatModerator","blacklistMessage"):"you were timed out using a blacklisted phrase",W=$.inidb.exists("chatModerator","warningTime")?parseInt($.inidb.get("chatModerator","warningTime")):5,z=$.inidb.exists("chatModerator","timeoutTime")?parseInt($.inidb.get("chatModerator","timeoutTime")):600,H=$.inidb.exists("chatModerator","msgCooldownSec")?parseInt($.inidb.get("chatModerator","msgCooldownSec")):20,J="";$.bind("ircChannelMessage",function(e){var r=e.getSender(),t=e.getMessage(),i=t.length();if(!$.isModv3(r,e.getTags())){if(t&&d(e))return;if(y&&$.patternDetector.hasLinks(e)){if($.youtubePlayerConnected&&(t.contains("youtube.com")||t.contains("youtu.be")))return;if(t&&l(e)||m(e))return;if(K&&$.isReg(r))return;if(O&&$.isSubv3(r,e.getTags()))return;return a(r),void s(r,M)}if(x&&i>I&&parseFloat(e.getCapsCount())/i*100>P)return a(r),void s(r,v);if(L&&i>_){if($.patternDetector.getLongestNonLetterSequence(e)>S)return a(r),void s(r,k);if(parseFloat($.patternDetector.getNumberOfNonLetters(e))/i*100>D)return a(r),void s(r,k)}if(C&&$.patternDetector.getLongestRepeatedSequence(e)>T)return a(r),void s(r,q);if(B&&$.patternDetector.getNumberOfEmotes(e)>j)return a(r),void s(r,F);if(R&&t.startsWith("/me"))return a(r),void s(r,E);A&&i>N&&(a(r),s(r,G))}}),$.bind("command",function(t){var a=t.getSender(),s=t.getCommand(),i=t.getArguments(),o=t.getArgs(),d=o[0],l=o[1];if(s.equalsIgnoreCase("permit"))return $.isModv3(a,t.getTags())?d?(n(d),void $.say($.username.resolve(d)+$.lang.get("chatmoderator.permited",w))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.permit.usage")):void $.say($.whisperPrefix(a)+$.modMsg);if(s.equalsIgnoreCase("blacklist")){if(!$.isAdmin(a))return void $.say($.whisperPrefix(a)+$.adminMsg);if(!d)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.usage"));if(d.equalsIgnoreCase("add")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.add.usage"));var m=i.replace(d,"").trim().toLowerCase();$.inidb.set("blackList","phrase_"+b.length,m),b.push(m),$.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.added"))}if(d.equalsIgnoreCase("remove")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.remove.usage"));if(!$.inidb.exists("blackList","phrase_"+parseInt(l)))return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.err"));$.inidb.del("blackList","phrase_"+parseInt(l)),e(),$.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.removed"))}if(d.equalsIgnoreCase("show")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.show.usage"));if(!$.inidb.exists("blackList","phrase_"+parseInt(l)))return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.err"));$.say($.whisperPrefix(a)+$.inidb.get("blackList","phrase_"+parseInt(l)))}}if(s.equalsIgnoreCase("whiteList")){if(!$.isAdmin(a))return void $.say($.whisperPrefix(a)+$.adminMsg);if(!d)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.whitelist.usage"));if(d.equalsIgnoreCase("add")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.whitelist.add.usage"));var c=i.replace(d,"").trim().toLowerCase();$.inidb.set("whiteList","link_"+p.length,c),p.push(c),$.say($.whisperPrefix(a)+$.lang.get("chatmoderator.whitelist.link.added"))}if(d.equalsIgnoreCase("remove")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.whitelist.remove.usage"));if(!$.inidb.exists("whiteList","link_"+parseInt(l)))return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.err"));$.inidb.del("whiteList","link_"+parseInt(l)),r(),$.say($.whisperPrefix(a)+$.lang.get("chatmoderator.whitelist.removed"))}if(d.equalsIgnoreCase("show")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.whitelist.show.usage"));if(!$.inidb.exists("whiteList","link_"+parseInt(l)))return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.err"));$.say($.whisperPrefix(a)+$.inidb.get("whiteList","link_"+parseInt(l)))}}if(s.equalsIgnoreCase("moderation")||s.equalsIgnoreCase("mod")){if(!$.isAdmin(a))return void $.say($.whisperPrefix(a)+$.adminMsg);if(!d)return $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.usage.toggles")),$.say($.whisperPrefix(a)+$.lang.get("chatmoderator.usage.messages")),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.options"));if(d.equalsIgnoreCase("links")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.link.usage",g(y)));if(l.equalsIgnoreCase("on"))return y=!0,$.inidb.set("chatModerator","linksToggle",y),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.link.filter.enabled"));if(l.equalsIgnoreCase("off"))return y=!1,$.inidb.set("chatModerator","linksToggle",y),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.link.filter.disabled"))}if(d.equalsIgnoreCase("caps")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.usage",g(x)));if(l.equalsIgnoreCase("on"))return x=!0,$.inidb.set("chatModerator","capsToggle",x),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.filter.enabled"));if(l.equalsIgnoreCase("off"))return x=!1,$.inidb.set("chatModerator","capsToggle",x),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.filter.disabled"))}if(d.equalsIgnoreCase("spam")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.spam.usage",g(C)));if(l.equalsIgnoreCase("on"))return C=!0,$.inidb.set("chatModerator","spamToggle",C),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.spam.filter.enabled"));if(l.equalsIgnoreCase("off"))return C=!1,$.inidb.set("chatModerator","spamToggle",C),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.spam.filter.disabled"))}if(d.equalsIgnoreCase("symbols")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.usage",g(L)));if(l.equalsIgnoreCase("on"))return L=!0,$.inidb.set("chatModerator","symbolsToggle",L),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.filter.enabled"));if(l.equalsIgnoreCase("off"))return L=!1,$.inidb.set("chatModerator","symbolsToggle",L),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.filter.disabled"))}if(d.equalsIgnoreCase("emotes")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.emotes.usage",g(B)));if(l.equalsIgnoreCase("on"))return B=!0,$.inidb.set("chatModerator","emotesToggle",B),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.emotes.filter.enabled"));if(l.equalsIgnoreCase("off"))return B=!1,$.inidb.set("chatModerator","emotesToggle",B),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.emotes.filter.disabled"))}if(d.equalsIgnoreCase("colors")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.colors.usage",g(R)));if(l.equalsIgnoreCase("on"))return R=!0,$.inidb.set("chatModerator","colorsToggle",R),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.colors.filter.enabled"));if(l.equalsIgnoreCase("off"))return R=!1,$.inidb.set("chatModerator","colorsToggle",R),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.colors.filter.disabled"))}if(d.equalsIgnoreCase("longmessages")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.message.usage",g(A)));if(l.equalsIgnoreCase("on"))return A=!0,$.inidb.set("chatModerator","longMessageToggle",A),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.message.filter.enabled"));if(l.equalsIgnoreCase("off"))return A=!1,$.inidb.set("chatModerator","longMessageToggle",A),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.message.filter.disabled"))}if(d.equalsIgnoreCase("regulars")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.regulars.usage"));if(l.equalsIgnoreCase("true"))return K=!0,$.inidb.set("chatModerator","regularsToggle",K),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.regulars.enabled"));if(l.equalsIgnoreCase("false"))return K=!1,$.inidb.set("chatModerator","regularsToggle",K),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.regulars.disabled"))}if(d.equalsIgnoreCase("subscribers")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.subscribers.usage"));if(l.equalsIgnoreCase("true"))return O=!0,$.inidb.set("chatModerator","subscribersToggle",O),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.subscribers.enabled"));if(l.equalsIgnoreCase("false"))return O=!1,$.inidb.set("chatModerator","subscribersToggle",O),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.subscribers.disabled"))}if(d.equalsIgnoreCase("linksmessage"))return l?(M=i.replace(d,"").trim(),$.inidb.set("chatModerator","linksMessage",M),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.link.message.set",M))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.link.message.usage"));if(d.equalsIgnoreCase("capsmessage"))return l?(v=i.replace(d,"").trim(),$.inidb.set("chatModerator","capsMessage",v),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.message.set",v))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.message.usage"));if(d.equalsIgnoreCase("symbolsmessage"))return l?(k=i.replace(d,"").trim(),$.inidb.set("chatModerator","symbolsMessage",k),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.message.set",k))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.message.usage"));if(d.equalsIgnoreCase("emotesmessage"))return l?(F=i.replace(d,"").trim(),$.inidb.set("chatModerator","emotesMessage",F),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.emotes.message.set",F))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.emotes.message.usage"));if(d.equalsIgnoreCase("colorsmessage"))return l?(E=i.replace(d,"").trim(),$.inidb.set("chatModerator","colorsMessage",E),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.colors.message.set",E))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.colors.message.usage"));if(d.equalsIgnoreCase("longmsgmessage"))return l?(G=i.replace(d,"").trim(),$.inidb.set("chatModerator","longMessageMessage",G),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.message.message.set",G))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.message.message.usage"));if(d.equalsIgnoreCase("spammessage"))return l?(q=i.replace(d,"").trim(),$.inidb.set("chatModerator","spamMessage",q),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.spam.message.set",q))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.spam.message.usage"));if(d.equalsIgnoreCase("blacklistmessage"))return l?(U=i.replace(d,"").trim(),$.inidb.set("chatModerator","blacklistMessage",U),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.message.set",U))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.blacklist.message.usage"));if(d.equalsIgnoreCase("permittime"))return l?(w=parseInt(l),$.inidb.set("chatModerator","linkPermitTime",w),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.permit.time.set",w))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.permit.time.usage"));if(d.equalsIgnoreCase("capslimit"))return l?(P=parseFloat(l),$.inidb.set("chatModerator","capsLimitPercent",P),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.limit.set",P))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.limit.usage"));if(d.equalsIgnoreCase("capstriggerlength"))return l?(I=parseInt(l),$.inidb.set("chatModerator","capsTriggerLength",I),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.trigger.length.set",capsLimit))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.caps.trigger.length.usage"));if(d.equalsIgnoreCase("spamlimit"))return l?(T=parseInt(l),$.inidb.set("chatModerator","spamLimit",T),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.spam.limit.set",T))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.spam.limit.usage"));if(d.equalsIgnoreCase("symbolslimit"))return l?(D=parseFloat(l),$.inidb.set("chatModerator","symbolsLimitPercent",D),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.limit.set",D))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.limit.usage"));if(d.equalsIgnoreCase("symbolsgrouplimit"))return l?(S=parseInt(l),$.inidb.set("chatModerator","symbolsLimitPercent",S),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.group.limit.set",S))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.group.limit.usage"));if(d.equalsIgnoreCase("symbolsTriggerLength"))return l?(_=parseInt(l),$.inidb.set("chatModerator","symbolsTriggerLength",_),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.trigger.length.set",_))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.symbols.trigger.length.usage"));if(d.equalsIgnoreCase("emoteslimit"))return l?(j=parseInt(l),$.inidb.set("chatModerator","emotesLimit",j),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.emotes.limit.set",j))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.emotes.limit.usage"));if(d.equalsIgnoreCase("messagecharacterlimit"))return l?(N=parseInt(l),$.inidb.set("chatModerator","longMessageLimit",N),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.message.limit.set",N))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.message.limit.usage"));if(d.equalsIgnoreCase("timeouttime"))return l?(z=parseInt(l),$.inidb.set("chatModerator","timeoutTime",z),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.timeout.time.set",z))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.timeout.time.usage"));if(d.equalsIgnoreCase("warningtime"))return l?(W=parseInt(l),$.inidb.set("chatModerator","warningTime",W),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.warning.time.set",W))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.warning.time.usage"));if(d.equalsIgnoreCase("messagecooldown"))return l?(H=parseInt(l),$.inidb.set("chatModerator","msgCooldownSec",H),void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.msgcooldown.set",H))):void $.say($.whisperPrefix(a)+$.lang.get("chatmoderator.msgcooldown.usage"))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./core/chatmoderator.js")&&(r(),e(),$.registerChatCommand("./core/chatmoderator.js","permit",2),$.registerChatCommand("./core/chatmoderator.js","moderation",1),$.registerChatCommand("./core/chatmoderator.js","mod",1),$.registerChatCommand("./core/chatmoderator.js","blacklist",1),$.registerChatCommand("./core/chatmoderator.js","whitelist",1))}),$.timeoutUser=t,$.permitUserLink=n}();
