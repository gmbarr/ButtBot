!function(){function e(e){var r=$.inidb.GetKeyList("blacklist","");if(e)for(var a in r)c.push($.inidb.get("blacklist",r[a]))}function r(e){var r=$.inidb.GetKeyList("whitelist","");if(e)for(var a in r)m.push($.inidb.get("whitelist",r[a]))}function a(e,r){$.say(".timeout "+e+" "+r),setTimeout(function(){$.say(".timeout "+e+" "+r)},1e3)}function t(e){for(var r in l)if(l[r].equalsIgnoreCase(e))return a(e,_),s(e),void(j="(timeout)");a(e,B),s(e),j="(warning)"}function i(e,r){h.length>1||$.say("@"+$.username.resolve(e)+", "+r+" "+j)}function s(e){l.push(e),o(e),h.push($.systemTime())}function o(e){var r=setTimeout(function(){h.splice(0),clearTimeout(r)},2e4),a=setTimeout(function(){for(var r in l)if(l[r].equalsIgnoreCase(e)){l.splice(r,0);break}clearTimeout(a)},36e5)}function n(e){d.push(e);var r=setTimeout(function(){for(var a in d)if(d[a].equalsIgnoreCase(e)){d.splice(a,1);break}clearTimeout(r)},1e3*p)}function g(e){return $.lang.get(e?"common.enabled":"common.disabled")}var d=[],l=[],h=[],m=[],c=[],u=$.inidb.exists("chatModerator","linksToggle")?$.getIniDbBoolean("chatModerator","linksToggle"):!0,f=$.inidb.exists("chatModerator","linksMessage")?$.inidb.get("chatModerator","linksMessage"):"you were timed out for linking",p=parseInt($.inidb.exists("chatModerator","linkPermitTime"))?parseInt($.getIniDbBoolean("chatModerator","linkPermitTime")):120,b=$.inidb.exists("chatModerator","capsToggle")?$.getIniDbBoolean("chatModerator","capsToggle"):!0,y=$.inidb.exists("chatModerator","capsMessage")?$.inidb.get("chatModerator","capsMessage"):"you were timed out for overusing caps",w=parseInt($.inidb.exists("chatModerator","capsLimit"))?parseInt($.getIniDbBoolean("chatModerator","capsLimit")):50,v=parseInt($.inidb.exists("chatModerator","capsTriggerLength"))?parseInt($.getIniDbBoolean("chatModerator","capsTriggerLength")):10,x=$.inidb.exists("chatModerator","spamToggle")?$.getIniDbBoolean("chatModerator","spamToggle"):!0,I=$.inidb.exists("chatModerator","spamMessage")?$.inidb.get("chatModerator","spamMessage"):"you were timed out for spamming",M=parseInt($.inidb.exists("chatModerator","spamLimit"))?parseInt($.getIniDbBoolean("chatModerator","spamLimit")):25,P=$.inidb.exists("chatModerator","symbolsToggle")?$.getIniDbBoolean("chatModerator","symbolsToggle"):!0,C=$.inidb.exists("chatModerator","symbolsMessage")?$.inidb.get("chatModerator","symbolsMessage"):"you were timed out for overusing symbols",k=parseInt($.inidb.exists("chatModerator","symbolsLimit"))?parseInt($.getIniDbBoolean("chatModerator","symbolsLimit")):25,T=parseInt($.inidb.exists("chatModerator","symbolsTriggerLength"))?parseInt($.getIniDbBoolean("chatModerator","symbolsTriggerLength")):5,q=$.inidb.exists("chatModerator","regularsToggle")?$.getIniDbBoolean("chatModerator","regularsToggle"):!1,L=$.inidb.exists("chatModerator","subscribersToggle")?$.getIniDbBoolean("chatModerator","subscribersToggle"):!0,D=$.inidb.exists("chatModerator","blacklistMessage")?$.inidb.get("chatModerator","blacklistMessage"):"you were timed out using a blacklisted phrase",B=parseInt($.inidb.exists("chatModerator","warningTime"))?parseInt($.getIniDbBoolean("chatModerator","warningTime")):5,_=parseInt($.inidb.exists("chatModerator","timeoutTime"))?parseInt($.getIniDbBoolean("chatModerator","timeoutTime")):600,j="";$.bind("ircChannelMessage",function(e){var r,s=e.getSender(),o=e.getMessage();if(!$.isModv3(s,e.getTags())){for(r in c)if(o.contains(c[r]))return a(s,_),j="(timeout)",void i(s,D);for(r in d)if(d[r].equalsIgnoreCase(s)&&$.patternDetector.hasLinks(e))return void d.splice(r,1);if(u&&$.patternDetector.hasLinks(e)){for(r in m)if(o.contains(m[r]))return;if($.youtubePlayerConnected&&(o.contains("youtube.com")||o.contains("youtu.be")||o.contains("m.youtube.com")))return;if(q&&$.isReg(s))return;if(L&&$.isSubv3(s,e.getTags()))return;return t(s),void i(s,f)}if(b&&o.length()>v&&e.getCapsCount()>w)return t(s),void i(s,y);if(P&&o.length()>T&&$.patternDetector.getNumberOfNonLetters(e)>k)return t(s),void i(s,C);if(x&&$.patternDetector.getLongestRepeatedSequence(e)>M)return t(s),void i(s,I)}}),$.bind("command",function(a){var t=a.getSender(),i=a.getCommand(),s=a.getArguments(),o=a.getArgs(),d=o[0],l=o[1];if(i.equalsIgnoreCase("permit"))return $.isModv3(t,a.getTags())?d?(n(d),void $.say($.username.resolve(d)+$.lang.get("chatmoderator.permited",p))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.permit.usage")):void $.say($.whisperPrefix(t)+$.modMsg);if(i.equalsIgnoreCase("blacklist")){if(!$.isAdmin(t))return void $.say($.whisperPrefix(t)+$.adminMsg);if(!d)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.usage"));if(d.equalsIgnoreCase("add")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.add.usage"));var h=s.replace(d,"").trim();$.inidb.set("blackList","phrase_"+c.length,h),c.push(h),$.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.added"))}if(d.equalsIgnoreCase("remove")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.remove.usage"));if(!$.inidb.exists("blackList","phrase_"+parseInt(l)))return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.err"));$.inidb.del("blackList","phrase_"+parseInt(l)),e(!0),$.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.removed"))}if(d.equalsIgnoreCase("show")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.show.usage"));if(!$.inidb.exists("blackList","phrase_"+parseInt(l)))return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.err"));$.say($.whisperPrefix(t)+$.inidb.get("blackList","phrase_"+parseInt(l)))}}if(i.equalsIgnoreCase("whiteList")){if(!$.isAdmin(t))return void $.say($.whisperPrefix(t)+$.adminMsg);if(!d)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.whitelist.usage"));if(d.equalsIgnoreCase("add")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.whitelist.add.usage"));var j=s.replace(d,"").trim();$.inidb.set("whiteList","link_"+m.length,j),m.push(j),$.say($.whisperPrefix(t)+$.lang.get("chatmoderator.whitelist.link.added"))}if(d.equalsIgnoreCase("remove")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.whitelist.remove.usage"));if(!$.inidb.exists("whiteList","link_"+parseInt(l)))return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.err"));$.inidb.del("whiteList","link_"+parseInt(l)),r(!0),$.say($.whisperPrefix(t)+$.lang.get("chatmoderator.whitelist.removed"))}if(d.equalsIgnoreCase("show")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.whitelist.show.usage"));if(!$.inidb.exists("whiteList","link_"+parseInt(l)))return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.err"));$.say($.whisperPrefix(t)+$.inidb.get("whiteList","link_"+parseInt(l)))}}if(i.equalsIgnoreCase("moderation")||i.equalsIgnoreCase("mod")){if(!$.isAdmin(t))return void $.say($.whisperPrefix(t)+$.adminMsg);if(!d)return $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.usage.toggles")),$.say($.whisperPrefix(t)+$.lang.get("chatmoderator.usage.messages")),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.options"));if(d.equalsIgnoreCase("links")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.link.usage",g(u)));if(l.equalsIgnoreCase("on"))return u=!0,$.inidb.set("chatModerator","linksToggle",u),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.link.filter.enabled"));if(l.equalsIgnoreCase("off"))return u=!1,$.inidb.set("chatModerator","linksToggle",u),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.link.filter.disabled"))}if(d.equalsIgnoreCase("caps")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.usage",g(b)));if(l.equalsIgnoreCase("on"))return b=!0,$.inidb.set("chatModerator","capsToggle",b),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.filter.enabled"));if(l.equalsIgnoreCase("off"))return b=!1,$.inidb.set("chatModerator","capsToggle",b),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.filter.disabled"))}if(d.equalsIgnoreCase("spam")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.spam.usage",g(x)));if(l.equalsIgnoreCase("on"))return x=!0,$.inidb.set("chatModerator","spamToggle",x),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.spam.filter.enabled"));if(l.equalsIgnoreCase("off"))return x=!1,$.inidb.set("chatModerator","spamToggle",x),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.spam.filter.disabled"))}if(d.equalsIgnoreCase("symbols")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.usage",g(P)));if(l.equalsIgnoreCase("on"))return P=!0,$.inidb.set("chatModerator","symbolsToggle",P),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.filter.enabled"));if(l.equalsIgnoreCase("off"))return P=!1,$.inidb.set("chatModerator","symbolsToggle",P),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.filter.disabled"))}if(d.equalsIgnoreCase("regulars")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.regulars.usage"));if(l.equalsIgnoreCase("true"))return q=!0,$.inidb.set("chatModerator","regularsToggle",q),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.regulars.enabled"));if(l.equalsIgnoreCase("false"))return q=!1,$.inidb.set("chatModerator","regularsToggle",q),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.regulars.disabled"))}if(d.equalsIgnoreCase("subscribers")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.subscribers.usage"));if(l.equalsIgnoreCase("true"))return L=!0,$.inidb.set("chatModerator","subscribersToggle",L),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.subscribers.enabled"));if(l.equalsIgnoreCase("false"))return L=!1,$.inidb.set("chatModerator","subscribersToggle",L),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.subscribers.disabled"))}if(d.equalsIgnoreCase("linksmessage"))return l?(f=s.replace(d,"").trim(),$.inidb.set("chatModerator","linksMessage",f),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.link.message.set",f))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.link.message.usage"));if(d.equalsIgnoreCase("capsmessage"))return l?(y=s.replace(d,"").trim(),$.inidb.set("chatModerator","capsMessage",y),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.message.set",y))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.message.usage"));if(d.equalsIgnoreCase("symbolsmessage"))return l?(C=s.replace(d,"").trim(),$.inidb.set("chatModerator","symbolsMessage",C),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.message.set",C))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.message.usage"));if(d.equalsIgnoreCase("spammessage"))return l?(I=s.replace(d,"").trim(),$.inidb.set("chatModerator","spamMessage",I),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.spam.message.set",I))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.spam.message.usage"));if(d.equalsIgnoreCase("blacklistmessage"))return l?(D=s.replace(d,"").trim(),$.inidb.set("chatModerator","blacklistMessage",D),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.message.set",D))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.blacklist.message.usage"));if(d.equalsIgnoreCase("permittime"))return l?(p=parseInt(l),$.inidb.set("chatModerator","linkPermitTime",p),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.permit.time.set",p))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.permit.time.usage"));if(d.equalsIgnoreCase("capslimit"))return l?(w=parseInt(l),$.inidb.set("chatModerator","capsLimit",w),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.limit.set",w))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.limit.usage"));if(d.equalsIgnoreCase("capstriggerlength"))return l?(v=parseInt(l),$.inidb.set("chatModerator","capsTriggerLength",v),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.trigger.length.set",w))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.caps.trigger.length.usage"));if(d.equalsIgnoreCase("spamlimit"))return l?(M=parseInt(l),$.inidb.set("chatModerator","spamLimit",M),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.spam.limit.set",M))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.spam.limit.usage"));if(d.equalsIgnoreCase("symbolslimit"))return l?(k=parseInt(l),$.inidb.set("chatModerator","symbolsLimit",k),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.limit.set",k))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.limit.usage"));if(d.equalsIgnoreCase("symbolsTriggerLength"))return l?(T=parseInt(l),$.inidb.set("chatModerator","symbolsTriggerLength",T),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.trigger.length.set",T))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.symbols.trigger.length.usage"));if(d.equalsIgnoreCase("timeouttime"))return l?(_=parseInt(l),$.inidb.set("chatModerator","timeoutTime",_),void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.timeout.time.set",_))):void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.timeout.time.usage"));if(d.equalsIgnoreCase("warningtime")){if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("chatmoderator.warning.time.usage"));B=parseInt(l),$.inidb.set("chatModerator","warningTime",B),$.say($.whisperPrefix(t)+$.lang.get("chatmoderator.warning.time.set",B))}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./core/chatmoderator.js")&&(r(!0),e(!0),$.registerChatCommand("./core/chatmoderator.js","permit",2),$.registerChatCommand("./core/chatmoderator.js","moderation",1),$.registerChatCommand("./core/chatmoderator.js","mod",1),$.registerChatCommand("./core/chatmoderator.js","blacklist",1),$.registerChatCommand("./core/chatmoderator.js","whitelist",1))}),$.timeoutUser=a,$.permitUserLink=n}();
