!function(){var n=$.inidb.exists("donations","announce")?$.getIniDbBoolean("donations","announce"):!0,e=parseFloat($.inidb.exists("donations","reward")?$.inidb.get("donations","reward"):0),a="./addons/donationHandler";$.bind("twitchAlertsDonationInitialized",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.isDirectory(a)||($.consoleLn(">> Creating Donation Handler Directory: "+a),$.mkDir(a)),$.consoleLn(">> Enabling Twitch Alerts donation announcements"),$.logEvent("donationHandler.js",25,"Donation announcements enabled"),n=!0)}),$.bind("twitchAlertsDonation",function(o){if($.bot.isModuleEnabled("./handlers/donationHandler.js")){var t=o.getJsonString(),i=Packages.org.json.JSONObject,s=new i(t),d=s.getString("donation_id"),r=(s.getString("created_at"),s.getString("currency")),l=parseFloat(s.getString("amount")),g=s.getString("name");s.getString("message");if(!$.inidb.exists("donations",d)&&($.inidb.set("donations",d,s),$.inidb.set("donations","last_donation",d),$.writeToFile(g+": "+l.toFixed(2),a+"/latestDonation.txt",!1),n))if(e>0&&$.bot.isModuleEnabled("./systems/pointSystem.js")){var c=Math.round(l*e),u=$.inidb.exists("donations","rewardmessage")?$.inidb.get("donations","rewardmessage"):$.lang.get("donationhandler.donation.newreward");u=u.replace("(name)",g),u=u.replace("(amount)",l.toFixed(2)),u=u.replace("(points)",c.toString()),u=u.replace("(pointname)",(1==c?$.pointNameSingle:$.pointNameMultiple).toLowerCase()),u=u.replace("(currency)",r),$.say(u),$.inidb.exists("points",g.toLowerCase())&&$.inidb.incr("points",g.toLowerCase(),c)}else{var u=$.inidb.exists("donations","message")?$.inidb.get("donations","message"):$.lang.get("donationhandler.donation.new");u=u.replace("(name)",g),u=u.replace("(amount)",l.toFixed(2)),u=u.replace("(currency)",r),$.say(u)}}}),$.bind("command",function(a){var o=a.getSender().toLowerCase(),t=a.getCommand(),i=a.getArgs();if(t.equalsIgnoreCase("lastdonation")){if(!$.inidb.exists("donations","last_donation"))return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.lastdonation.no-donations"));var s=$.inidb.get("donations","last_donation");if(!$.inidb.exists("donations",s))return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.lastdonation.404"));var d=$.inidb.get("donations",s),r=Packages.org.json.JSONObject,l=new r(d),s=l.getString("donation_id"),g=(l.getString("created_at"),l.getString("currency")),c=parseFloat(l.getString("amount")),u=l.getString("name"),m=(l.getString("message"),$.inidb.exists("donations","lastmessage")?$.inidb.get("donations","lastmessage"):$.lang.get("donationhandler.lastdonation.success"));m=m.replace("(name)",u),m=m.replace("(amount)",c.toFixed(2)),m=m.replace("(currency)",g),$.say(m)}if(t.equalsIgnoreCase("donations")){if(!i[0])return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.usage"));if(i[0].equalsIgnoreCase("announce"))return void(n?($.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.announce.disable")),n=!1,$.inidb.set("donations","announce","false"),$.logEvent("donationHandler.js",140,o+" disabled donation announcements")):($.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.announce.enable")),n=!0,$.inidb.set("donations","announce","true"),$.logEvent("donationHandler.js",145,o+" enabled donation announcements")));if(i[0].equalsIgnoreCase("reward"))return i[1]?isNaN(i[1])?void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.reward.usage")):($.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.reward.success",i[1],("1"==i[1]?$.pointNameSingle:$.pointNameMultiple).toLowerCase())),$.inidb.set("donations","reward",i[1]),e=parseFloat(i[1]),void $.logEvent("donationHandler.js",166,o+" changed donation reward to "+i[1])):void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.reward.usage"));if(i[0].equalsIgnoreCase("message")||i[0].equalsIgnoreCase("rewardmessage")||i[0].equalsIgnoreCase("lastmessage")){var b=i[0].toLowerCase();if(!i[1])return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations."+b+".usage"));var h=i.splice(1).join(" ");if(-1==h.search(/\(name\)/))return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations."+b+".no-name"));$.inidb.set("donations",b,h),$.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations."+b+".success",h)),$.logEvent("donationHandler.js",191,o+" set the donation message to "+h)}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.registerChatCommand("./handlers/donationHandler.js","lastdonation",7),$.registerChatCommand("./handlers/donationHandler.js","donations",1))})}();
