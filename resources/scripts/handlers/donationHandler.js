!function(){var n=$.inidb.exists("donations","announce")?$.getIniDbBoolean("donations","announce"):!0,e=parseFloat($.inidb.exists("donations","reward")?$.inidb.get("donations","reward"):0),a="./addons/donationHandler";$.bind("twitchAlertsDonationInitialized",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.isDirectory(a)||($.consoleLn(">> Creating Donation Handler Directory: "+a),$.mkDir(a)),$.consoleLn(">> Enabling Twitch Alerts donation announcements"),n=!0)}),$.bind("twitchAlertsDonation",function(o){if($.bot.isModuleEnabled("./handlers/donationHandler.js")){var t=o.getJsonString(),i=Packages.org.json.JSONObject,d=new i(t),s=d.getString("donation_id"),r=(d.getString("created_at"),d.getString("currency"),parseFloat(d.getString("amount"))),l=d.getString("name");d.getString("message");if(!$.inidb.exists("donations",s)&&($.inidb.set("donations",s,d),$.inidb.set("donations","last_donation",s),$.writeToFile(l+": "+r.toFixed(2),a+"/latestDonation.txt",!1),n))if(e>0){var g=Math.round(r*e),c=$.lang.get("donationhandler.donation.newreward");c=c.replace("(name)",l),c=c.replace("(amount)",r.toFixed(2)),c=c.replace("(points)",g),c=c.replace("(pointname)",(1==g?$.pointNameSingle:$.pointNameMultiple).toLowerCase()),$.say(c),$.inidb.exists("points",l.toLowerCase())&&$.inidb.incr("points",l.toLowerCase(),g)}else{var c=$.lang.get("donationhandler.donation.new");c=c.replace("(name)",l),c=c.replace("(amount)",r.toFixed(2)),$.say(c)}}}),$.bind("command",function(a){var o=a.getSender().toLowerCase(),t=a.getCommand(),i=a.getArgs();if(t.equalsIgnoreCase("lastdonation")){if(!$.inidb.exists("donations","last_donation"))return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.lastdonation.no-donations"));var d=$.inidb.get("donations","last_donation");if(!$.inidb.exists("donations",d))return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.lastdonation.404"));var s=$.inidb.get("donations",d),r=Packages.org.json.JSONObject,l=new r(s),d=l.getString("donation_id"),g=(l.getString("created_at"),l.getString("currency"),parseFloat(l.getString("amount"))),c=l.getString("name"),u=(l.getString("message"),$.lang.get("donationhandler.lastdonation.success"));u=u.replace("(name)",c),u=u.replace("(amount)",g.toFixed(2)),$.say(u)}if(t.equalsIgnoreCase("donations")){if(!i[0])return void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.usage"));if(i[0].equalsIgnoreCase("announce"))return void(n?($.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.announce.disable")),n=!1,$.inidb.set("donations","announce","false")):($.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.announce.enable")),n=!0,$.inidb.set("donations","announce","true")));if(i[0].equalsIgnoreCase("reward"))return i[1]?isNaN(i[1])?void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.reward.usage")):($.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.reward.success",i[1],("1"==i[1]?$.pointNameSingle:$.pointNameMultiple).toLowerCase())),$.inidb.set("donations","reward",i[1]),void(e=parseFloat(i[1]))):void $.say($.whisperPrefix(o)+$.lang.get("donationhandler.donations.reward.usage"))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.registerChatCommand("./handlers/donationHandler.js","lastdonation",7),$.registerChatCommand("./handlers/donationHandler.js","donations",1))})}();
