!function(){function n(){e=$.getIniDbBoolean("donations","announce"),a=$.getIniDbFloat("donations","reward"),o=$.getIniDbString("donations","message"),t=$.getIniDbString("donations","lastmessage")}var e=$.getSetIniDbBoolean("donations","announce",!0),a=$.getSetIniDbFloat("donations","reward",0),o=$.getSetIniDbString("donations","message",$.lang.get("donationhandler.donation.new")),t=$.getSetIniDbString("donations","lastmessage",$.lang.get("donationhandler.lastdonation.success")),i="./addons/donationHandler";$.bind("twitchAlertsDonationInitialized",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.isDirectory(i)||($.consoleLn(">> Creating Donation Handler Directory: "+i),$.mkDir(i)),$.consoleLn(">> Enabling Twitch Alerts donation announcements"),$.logEvent("donationHandler.js",25,"Donation announcements enabled"),e=!0)}),$.bind("twitchAlertsDonation",function(n){if($.bot.isModuleEnabled("./handlers/donationHandler.js")){var o=n.getJsonString(),t=Packages.org.json.JSONObject,s=new t(o),d=s.getString("donation_id"),r=(s.getString("created_at"),s.getString("currency")),l=parseFloat(s.getString("amount")),g=s.getString("name"),c=s.getString("message");if(!$.inidb.exists("donations",d)){if($.inidb.set("donations",d,s),$.inidb.set("donations","last_donation",d),$.writeToFile(g+": "+l.toFixed(2),i+"/latestDonation.txt",!1),e){var u=Math.round(l*a),h=c;h=h.replace("(name)",g),h=h.replace("(amount)",l.toFixed(2)),h=h.replace("(points)",u.toString()),h=h.replace("(pointname)",(1==u?$.pointNameSingle:$.pointNameMultiple).toLowerCase()),h=h.replace("(currency)",r),$.say(h)}$.inidb.exists("points",g.toLowerCase())&&u>0&&$.inidb.incr("points",g.toLowerCase(),u)}}}),$.bind("command",function(o){var i=o.getSender().toLowerCase(),s=o.getCommand(),d=o.getArgs();if(s.equalsIgnoreCase("donationpanelupdate")&&n(),s.equalsIgnoreCase("lastdonation")){if(!$.inidb.exists("donations","last_donation"))return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.lastdonation.no-donations"));var r=$.inidb.get("donations","last_donation");if(!$.inidb.exists("donations",r))return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.lastdonation.404"));var l=$.inidb.get("donations",r),g=Packages.org.json.JSONObject,c=new g(l),r=c.getString("donation_id"),u=(c.getString("created_at"),c.getString("currency")),h=parseFloat(c.getString("amount")),m=c.getString("name"),b=(c.getString("message"),t);b=b.replace("(name)",m),b=b.replace("(amount)",h.toFixed(2)),b=b.replace("(currency)",u),$.say(b)}if(s.equalsIgnoreCase("donations")){if(!d[0])return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.usage"));if(d[0].equalsIgnoreCase("announce"))return void(e?($.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.announce.disable")),e=!1,$.inidb.set("donations","announce","false"),$.logEvent("donationHandler.js",140,i+" disabled donation announcements")):($.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.announce.enable")),e=!0,$.inidb.set("donations","announce","true"),$.logEvent("donationHandler.js",145,i+" enabled donation announcements")));if(d[0].equalsIgnoreCase("rewardmultiplier"))return d[1]?isNaN(d[1])?void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.reward.usage")):($.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.reward.success",d[1],("1"==d[1]?$.pointNameSingle:$.pointNameMultiple).toLowerCase())),$.inidb.set("donations","reward",d[1]),a=parseFloat(d[1]),void $.logEvent("donationHandler.js",166,i+" changed donation reward to "+d[1])):void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.reward.usage"));if(d[0].equalsIgnoreCase("message")||d[0].equalsIgnoreCase("lastmessage")){var p=d[0].toLowerCase();if(!d[1])return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations."+p+".usage"));var w=d.splice(1).join(" ");if(-1==w.search(/\(name\)/))return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations."+p+".no-name"));$.inidb.set("donations",p,w),$.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations."+p+".success",w)),$.logEvent("donationHandler.js",191,i+" set the donation message to "+w)}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.registerChatCommand("./handlers/donationHandler.js","lastdonation",7),$.registerChatCommand("./handlers/donationHandler.js","donations",1),$.registerChatCommand("./handlers/donationHandler.js","donationpanelupdate",1))})}();
