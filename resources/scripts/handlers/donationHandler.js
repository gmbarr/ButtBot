!function(){var n=!1,t="./addons/donationHandler";$.bind("twitchAlertsDonationInitialized",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.isDirectory(t)||($.consoleLn(">> Creating Donation Handler Directory: "+t),$.mkDir(t)),$.consoleLn(">> Enabling Twitch Alerts donation announcements"),n=!0)}),$.bind("twitchAlertsDonation",function(a){if($.bot.isModuleEnabled("./handlers/donationHandler.js")){{var o=a.getJsonString(),e=Packages.org.json.JSONObject,i=new e(o),d=i.getString("donation_id"),s=(i.getString("created_at"),i.getString("currency"),parseFloat(i.getString("amount"))),r=i.getString("name");i.getString("message")}if(n&&!$.inidb.exists("donations",d)&&($.inidb.set("donations",d,i),$.inidb.set("donations","last_donation",d),$.writeToFile(r+": "+s.toFixed(2),t+"/latestDonation.txt",!1),$.lang.exists("donationhandler.donation.new"))){var g=$.lang.get("donationhandler.donation.new");g=g.replace("(name)",r),g=g.replace("(amount)",s.toFixed(2)),$.say(g)}}}),$.bind("command",function(n){{var t=(n.getSender().toLowerCase(),n.getCommand()),a=n.getArgs();parseInt(a[0])}if(t.equalsIgnoreCase("lastdonation")){if(!$.inidb.exists("donations","last_donation"))return void $.say($.lang.get("donationhandler.lastdonation.no-donations"));var o=$.inidb.get("donations","last_donation");if(!$.inidb.exists("donations",o))return void $.say($.lang.get("donationhandler.lastdonation.404"));var e=$.inidb.get("donations",o),i=Packages.org.json.JSONObject,d=new i(e),o=d.getString("donation_id"),s=(d.getString("created_at"),d.getString("currency"),parseFloat(d.getString("amount"))),r=d.getString("name"),g=(d.getString("message"),$.lang.get("donationhandler.lastdonation.success"));g=g.replace("(name)",r),g=g.replace("(amount)",s.toFixed(2)),$.say(g)}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&$.registerChatCommand("./handlers/donationHandler.js","lastdonation",7)})}();
