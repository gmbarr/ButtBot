(function(){var e=0,l=0,o=false,s=$.inidb.exists("settings","followReward")?parseInt($.inidb.get("settings","followReward")):100,a=$.inidb.exists("settings","followMessage")?$.inidb.get("settings","followMessage"):$.lang.get("followhandler.follow.message"),n=$.inidb.exists("settings","followToggle")?$.inidb.get("settings","followToggle"):false;function t(){if($.systemTime()-e>3e5){if(l==3){$.say($.lang.get("followhandler.followtrain.triple"))}else if(l==4){$.say($.lang.get("followhandler.followtrain.quad"))}else if(l==5){$.say($.lang.get("followhandler.followtrain.penta"))}else if(l==20){$.say($.lang.get("followhandler.followtrain.mega",l))}else if(l==30){$.say($.lang.get("followhandler.followtrain.ultra",l))}else if(l==50){$.say($.lang.get("followhandler.followtrain.unbelievable",l))}else{++l}}else{l=1}e=$.systemTime()}$.bind("twitchFollowsInitialized",function(){if(!$.bot.isModuleEnabled("./handlers/followHandler.js")){return}$.consoleLn($.lang.get("followhandler.anouncements.enabled"));o=true});$.bind("twitchFollow",function(e){if(!$.bot.isModuleEnabled("./handlers/followHandler.js")){return}if(!n){return}var l=e.getFollower().toLowerCase();if($.inidb.exists("followed",l)){return}if($.bot.isModuleEnabled("./commands/lastseenCommand.js")){$.inidb.set("lastseen",l,$.systemTime())}if(s>0){$.inidb.incr("points",l,s)}if(o){followmsg=a.replace("(name)",$.username.resolve(l));if(s>0){followmsg=followmsg.replace("(reward)",$.getPointsString(s));$.say(followmsg)}else{$.say(followmsg.replace("(name)",$.username.resolve(l)))}}$.setIniDbBoolean("followed",l,true);$.writeToFile($.username.resolve(l),"./addons/followHandler/latestFollower.txt",false);t()});$.bind("twitchUnfollow",function(e){if(!$.bot.isModuleEnabled("./handlers/followHandler.js")){return}var l=e.getFollows().toLowerCase(),o=$.getIniDbBoolean("followed",l);if(o){$.setIniDbBoolean("followed",l,false)}});$.bind("command",function(e){var l=e.getSender().toLowerCase(),o=e.getCommand(),t=e.getArgs(),r=e.getArguments(),i=t[0],f,g,w,d;if(o.equalsIgnoreCase("followreward")){i=parseInt(i);if(!i||isNaN(i)){$.say($.whisperPrefix(l)+$.lang.get("followhandler.set.followreward.usage",$.pointNameMultiple))}s=i;$.inidb.set("settings","followReward",s);$.say($.whisperPrefix(l)+$.lang.get("followhandler.set.followreward.success",$.getPointsString(s)))}if(o.equalsIgnoreCase("followmessage")){if(!i||i<=0){$.say($.whisperPrefix(l)+$.lang.get("followhandler.set.followmessage.usage"));return}a=r;$.inidb.set("settings","followMessage",a);$.say($.whisperPrefix(l)+$.lang.get("followhandler.set.followmessage.success"))}if(o.equalsIgnoreCase("followtoggle")){if(n){n=false;$.inidb.set("settings","followToggle",n);$.say($.whisperPrefix(l)+$.lang.get("followhandler.shoutout.toggle.off"))}else if(!n){n=true;$.inidb.set("settings","followToggle",n);$.say($.whisperPrefix(l)+$.lang.get("followhandler.shoutout.toggle.on"))}}if(o.equalsIgnoreCase("followers")){$.say($.lang.get("followhandler.followers",$.getFollows($.channelName)))}if(o.equalsIgnoreCase("checkfollow")){i=i.toLowerCase();if(!i||i==""){$.say($.whisperPrefix(l)+$.lang.get("followhandler.check.usage"));return}if($.user.isFollower(i)){$.say($.lang.get("followhandler.check.follows",$.username.resolve(i)))}else{$.say($.lang.get("followhandler.check.notfollows",$.username.resolve(i)))}}if(o.equalsIgnoreCase("follow")||o.equalsIgnoreCase("shoutout")||o.equalsIgnoreCase("caster")){if(!i||i==""){$.say($.whisperPrefix(l)+$.lang.get("followhandler.shoutout.usage",o.toLowerCase()));return}f=$.username.resolve(t[0]);g=$.getGame(f);w="http://twitch.tv/"+f;if(g==null||g==""){$.say($.whisperPrefix(l)+$.lang.get("followhandler.shoutout.404",t[0]));return}if(!$.isOnline(f)){d=$.lang.get("followhandler.shoutout.offline",f,w,g)}else{d=$.lang.get("followhandler.shoutout.online",f,w,g)}$.say(d);return}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./handlers/followHandler.js")){$.registerChatCommand("./handlers/followHandler.js","followreward",1);$.registerChatCommand("./handlers/followHandler.js","followtoggle",1);$.registerChatCommand("./handlers/followHandler.js","followmessage",1);$.registerChatCommand("./handlers/followHandler.js","checkfollow",2);$.registerChatCommand("./handlers/followHandler.js","followers",7);$.registerChatCommand("./handlers/followHandler.js","follow",2);$.registerChatCommand("./handlers/followHandler.js","shoutout",2);$.registerChatCommand("./handlers/followHandler.js","caster",2)}})})();
