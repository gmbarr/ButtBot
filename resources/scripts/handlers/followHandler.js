!function(){function e(){s=$.getIniDbNumber("settings","followReward"),t=$.getIniDbString("settings","followMessage"),r=$.getIniDbBoolean("settings","followToggle")}function l(){$.systemTime()-o>3e5?(3==n?$.say($.lang.get("followhandler.followtrain.triple")):4==n?$.say($.lang.get("followhandler.followtrain.quad")):5==n?$.say($.lang.get("followhandler.followtrain.penta")):20==n?$.say($.lang.get("followhandler.followtrain.mega",n)):30==n?$.say($.lang.get("followhandler.followtrain.ultra",n)):50==n&&$.say($.lang.get("followhandler.followtrain.unbelievable",n)),++n):n=1,o=$.systemTime()}var o=0,n=0,a=!1,s=$.getSetIniDbNumber("settings","followReward",0),t=$.getSetIniDbString("settings","followMessage",$.lang.get("followhandler.follow.message")),r=$.getSetIniDbBoolean("settings","followToggle",!1);$.bind("twitchFollowsInitialized",function(){$.bot.isModuleEnabled("./handlers/followHandler.js")&&($.consoleLn(">> Enabling follower announcements"),$.logEvent("followHandler.js",56,"Follow announcements enabled"),a=!0)}),$.bind("twitchFollow",function(e){var o,n=e.getFollower();$.bot.isModuleEnabled("./commands/lastseenCommand.js")&&$.inidb.set("lastseen",n,$.systemTime()),$.bot.isModuleEnabled("./handlers/followHandler.js")&&($.inidb.exists("followed",n)||(r&&a&&(o=t,o=o.replace("(name)",$.username.resolve(n)),o=o.replace("(reward)",$.getPointsString(s)),l(),$.say(o)),$.setIniDbBoolean("followed",n,!0),s>0&&$.inidb.incr("points",n,s),$.writeToFile(n,"./addons/followHandler/latestFollower.txt",!1)))}),$.bind("twitchUnfollow",function(e){if($.bot.isModuleEnabled("./handlers/followHandler.js")){var l=e.getFollows().toLowerCase(),o=$.getIniDbBoolean("followed",l);o&&$.setIniDbBoolean("followed",l,!1)}}),$.bind("command",function(l){var o=l.getSender().toLowerCase(),n=l.getCommand(),a=l.getArgs(),g=l.getArguments(),i=a[0],w=$.username.resolve($.channelName),f=$.username.resolve(o);if(n.equalsIgnoreCase("followerpanelupdate")&&e(),n.equalsIgnoreCase("followreward")){if(i=parseInt(i),!a[0]||isNaN(i))return void $.say($.whisperPrefix(o)+$.lang.get("followhandler.set.followreward.usage",$.pointNameMultiple,s));s=i,$.inidb.set("settings","followReward",s),$.say($.whisperPrefix(o)+$.lang.get("followhandler.set.followreward.success",$.getPointsString(s))),$.logEvent("followHandler.js",141,o+" set the follow reward to "+s)}if(n.equalsIgnoreCase("followmessage")){if(!i||0>=i)return void $.say($.whisperPrefix(o)+$.lang.get("followhandler.set.followmessage.usage"));t=g,$.inidb.set("settings","followMessage",t),$.say($.whisperPrefix(o)+$.lang.get("followhandler.set.followmessage.success",t)),$.logEvent("followHandler.js",156,o+" set the follow message to "+t)}if(n.equalsIgnoreCase("followtoggle")&&(r?(r=!1,$.inidb.set("settings","followToggle",r),$.say($.whisperPrefix(o)+$.lang.get("followhandler.followtoggle.off")),$.logEvent("followHandler.js",181,o+" turned follow announcements off")):r||(r=!0,$.inidb.set("settings","followToggle",r),$.say($.whisperPrefix(o)+$.lang.get("followhandler.followtoggle.on")),$.logEvent("followHandler.js",181,o+" turned follow announcements on"))),n.equalsIgnoreCase("followers")&&$.say($.lang.get("followhandler.followers",$.getFollows($.channelName))),n.equalsIgnoreCase("checkfollow")){if(!i||""==i)return void $.say($.whisperPrefix(o)+$.lang.get("followhandler.check.usage"));i=i.toLowerCase(),$.user.isFollower(i)?$.say($.lang.get("followhandler.check.follows",$.username.resolve(i))):$.say($.lang.get("followhandler.check.notfollows",$.username.resolve(i)))}if(n.equalsIgnoreCase("follow")||n.equalsIgnoreCase("shoutout")||n.equalsIgnoreCase("caster")){if(!i||""==i)return void $.say($.whisperPrefix(o)+$.lang.get("followhandler.shoutout.usage",n.toLowerCase()));var d=$.username.resolve(a[0]),h=$.getGame(d),u="https://twitch.tv/"+d;if(null==h||""==h)return void $.say($.whisperPrefix(o)+$.lang.get("followhandler.shoutout.404",a[0]));if(!$.isOnline(d))return $.say($.lang.get("followhandler.shoutout.offline",d,u,h)),void $.logEvent("followHandler.js",181,o+" shouted out streamer "+d);$.say($.lang.get("followhandler.shoutout.online",d,u,h)),$.logEvent("followHandler.js",181,o+" shouted out streamer "+d)}if(n.equalsIgnoreCase("followage")){if(a.length>0&&(f=$.username.resolve(a[0])),a.length>1&&(w=$.username.resolve(a[1])),200==$.twitch.GetUserFollowsChannel(f,w).getInt("_http"))return void $.say($.lang.get("followhandler.follow.age.time",f,w,$.getFollowAge(f,w)));$.say($.lang.get("followhandler.follow.age.err.404",f,w))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/followHandler.js")&&($.registerChatCommand("./handlers/followHandler.js","followreward",1),$.registerChatCommand("./handlers/followHandler.js","followtoggle",1),$.registerChatCommand("./handlers/followHandler.js","followmessage",1),$.registerChatCommand("./handlers/followHandler.js","checkfollow",2),$.registerChatCommand("./handlers/followHandler.js","followers",7),$.registerChatCommand("./handlers/followHandler.js","follow",2),$.registerChatCommand("./handlers/followHandler.js","shoutout",2),$.registerChatCommand("./handlers/followHandler.js","caster",2),$.registerChatCommand("./handlers/followHandler.js","followerpanelupdate",1),$.registerChatCommand("./handlers/followHandler.js","followage"))})}();
