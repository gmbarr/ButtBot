(function(){var e=$.inidb.exists("adventureSettings","joinTime")?parseInt($.inidb.get("adventureSettings","joinTime")):60,t=$.inidb.exists("adventureSettings","coolDown")?parseInt($.inidb.get("adventureSettings","coolDown")):900,n=$.inidb.exists("adventureSettings","gainPercent")?parseInt($.inidb.get("adventureSettings","gainPercent")):30,s=$.inidb.exists("adventureSettings","minBet")?parseInt($.inidb.get("adventureSettings","minBet")):10,i=$.inidb.exists("adventureSettings","maxBet")?parseInt($.inidb.get("adventureSettings","maxBet")):1e3,r=1,a=.5,u=.25,o=1,g=[];function v(){var e=1,t,n;for(e;$.lang.exists("adventuresystem.stories."+e+".title");e++){n=[];for(t=1;$.lang.exists("adventuresystem.stories."+e+".chapter."+t);t++){n.push($.lang.get("adventuresystem.stories."+e+".chapter."+t))}g.push({title:$.lang.get("adventuresystem.stories."+e+".title"),lines:n})}$.consoleLn($.lang.get("adventuresystem.loaded",e-1))}function d(){var e=$.inidb.GetKeyList("adventurePayouts",""),t=[],n=1,s=[],i;if(e.length==0){$.say($.lang.get("adventuresystem.top5.empty"))}for(i in e){if(e[i].equalsIgnoreCase($.ownerName)||e[i].equalsIgnoreCase($.botName)){continue}t.push({username:e[i],amount:parseInt($.inidb.get("adventurePayouts",e[i]))})}t.sort(function(e,t){return e.amount<t.amount?1:-1});for(i in t){if(n<=5){s.push(n+". "+t[i].username+": "+$.getPointsString(t[i].amount));n++}}$.say($.lang.get("adventuresystem.top5",s.join(", ")))}function l(e){var t;for(t in o.users){if(o.users[t].username==e){return true}}return false}function m(e){var t=[],n;for(n in e){t.push($.username.resolve(e[n].username))}return t.join(", ")}function f(){var e;for(e in o.users){if($.randRange(0,20)>5){o.survivors.push(o.users[e])}else{o.caught.push(o.users[e])}}}function c(e){if(e.indexOf("(caught)")>-1){if(o.caught.length>0){return e.replace("(caught)",m(o.caught))}else{return""}}if(e.indexOf("(survivors)")>-1){if(o.survivors.length>0){return e.replace("(survivors)",m(o.survivors))}else{return""}}return e}function y(e,t){if($.bot.isModuleEnabled("./games/tamagotchi.js")){var n=$.tamagotchi.getByOwner(e);if(n){if(n.isHappy()){n.incrFunLevel(r).incrExpLevel(a).decrFoodLevel(u).save();$.say($.lang.get("adventuresystem.tamagotchijoined",n.name));o.users.push({username:n.name,tgOwner:e,bet:t/2})}else{n.sayFunLevel()}}}}function p(t){o.gameState=1;var n=setTimeout(function(){b();clearTimeout(n)},e*1e3);$.say($.lang.get("adventuresystem.start.success",$.resolveRank(t),$.pointNameMultiple))}function h(e,t){if(o.gameState>1){$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.notpossible"));return}if(l(e)){$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.alreadyjoined"));return}if(t>$.getUserPoints(e)){$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.needpoints",$.getPointsString(t),$.getPointsString($.getUserPoints(e))));return}if(t<s){$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.bettoolow",$.getPointsString(t),$.getPointsString(s)));return}if(t>i){$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.bettoohigh",$.getPointsString(t),$.getPointsString(i)));return}o.users.push({username:e,bet:parseInt(t)});$.inidb.decr("points",e,t);y(e,t);if(o.gameState==0){p(e)}else{$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.success",$.getPointsString(t)))}return true}function b(){var e=0,t=$.randElement(g),n,s;o.gameState=2;f();$.say($.lang.get("adventuresystem.runstory",t.title,o.users.length));s=setInterval(function(){if(e<t.lines.length){n=c(t.lines[e]);if(n!=""){$.say(n)}}else{S();clearInterval(s)}e++},5e3)}function S(){var e,s;for(e in o.survivors){if(o.survivors[e].tgOwner){o.survivors[e].username=o.survivors[e].tgOwner}s=o.survivors[e].bet*(n/100);$.inidb.incr("adventurePayouts",o.survivors[e].username,s);$.inidb.incr("points",o.survivors[e].username,o.survivors[e].bet+s)}$.say($.lang.get("adventuresystem.completed",o.survivors.length,o.caught.length));P();$.coolDown.set("adventure",t*1e3)}function P(){o={gameState:0,users:[],tgOwners:[],survivors:[],caught:[]}}$.bind("command",function(r){var a=r.getSender().toLowerCase(),u=r.getCommand(),o=r.getArgs(),g=o[0],v=o[1],l=parseInt(o[2]);if(u.equalsIgnoreCase("adventure")){if(!g){$.say($.whisperPrefix(a)+$.lang.get("adventuresystem.adventure.usage",$.pointNameMultiple));return}if(!isNaN(parseInt(g))){h(a,parseInt(g));return}if(g.equalsIgnoreCase("top5")){d()}if(g.equalsIgnoreCase("set")){if(!$.isAdmin(a)){$.say($.whisperPrefix(a)+$.adminMsg);return}if(!v||isNaN(l)){$.say($.whisperPrefix(a)+$.lang.get("adventuresystem.set.usage"));return}if(v.equalsIgnoreCase("joinTime")){e=l;$.inidb.set("adventureSettings","joinTime",l)}if(v.equalsIgnoreCase("coolDown")){t=l;$.inidb.set("adventureSettings","coolDown",l)}if(v.equalsIgnoreCase("gainPercent")){n=l;$.inidb.set("adventureSettings","gainPercent",l)}if(v.equalsIgnoreCase("minBet")){s=l;$.inidb.set("adventureSettings","minBet",l)}if(v.equalsIgnoreCase("maxBet")){i=l;$.inidb.set("adventureSettings","maxBet",l)}$.say($.whisperPrefix(a)+$.lang.get("adventuresystem.set.success",v,l))}}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./games/adventureSystem.js")){P();v();$.registerChatCommand("./games/adventureSystem.js","adventure",7)}})})();
