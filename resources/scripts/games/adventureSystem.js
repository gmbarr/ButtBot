!function(){function e(){var e,t,i=1;for(i;$.lang.exists("adventuresystem.stories."+i+".title");i++){for(t=[],e=1;$.lang.exists("adventuresystem.stories."+i+".chapter."+e);e++)t.push($.lang.get("adventuresystem.stories."+i+".chapter."+e));b.push({title:$.lang.get("adventuresystem.stories."+i+".title"),lines:t})}$.consoleLn($.lang.get("adventuresystem.loaded",i-1))}function t(){var e,t=$.inidb.GetKeyList("adventurePayouts",""),i=[],n=1,s=[];0==t.length&&$.say($.lang.get("adventuresystem.top5.empty"));for(e in t)t[e].equalsIgnoreCase($.ownerName)||t[e].equalsIgnoreCase($.botName)||i.push({username:t[e],amount:parseInt($.inidb.get("adventurePayouts",t[e]))});i.sort(function(e,t){return e.amount<t.amount?1:-1});for(e in i)n>5||(s.push(n+". "+i[e].username+": "+$.getPointsString(i[e].amount)),n++);$.say($.lang.get("adventuresystem.top5",s.join(", ")))}function i(e){var t;for(t in h.users)if(h.users[t].username==e)return!0;return!1}function n(e){var t,i=[];for(t in e)i.push($.username.resolve(e[t].username));return i.join(", ")}function s(){var e;for(e in h.users)$.randRange(0,20)>5?h.survivors.push(h.users[e]):h.caught.push(h.users[e])}function r(e){return e.indexOf("(caught)")>-1?h.caught.length>0?e.replace("(caught)",n(h.caught)):"":e.indexOf("(survivors)")>-1?h.survivors.length>0?e.replace("(survivors)",n(h.survivors)):"":e}function a(e,t){if($.bot.isModuleEnabled("./games/tamagotchi.js")){var i=$.tamagotchi.getByOwner(e);i&&(i.isHappy()?(i.incrFunLevel(c).incrExpLevel(S).decrFoodLevel(P).save(),$.say($.lang.get("adventuresystem.tamagotchijoined",i.name)),h.users.push({username:i.name,tgOwner:e,bet:t/2})):i.sayFunLevel())}}function o(e){h.gameState=1;var t=setTimeout(function(){u(),clearTimeout(t)},1e3*m);$.say($.lang.get("adventuresystem.start.success",$.resolveRank(e),$.pointNameMultiple))}function g(e,t){return h.gameState>1?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.notpossible")):i(e)?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.alreadyjoined")):t>$.getUserPoints(e)?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.needpoints",$.getPointsString(t),$.getPointsString($.getUserPoints(e)))):v>t?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.bettoolow",$.getPointsString(t),$.getPointsString(v))):t>y?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.bettoohigh",$.getPointsString(t),$.getPointsString(y))):(h.users.push({username:e,bet:parseInt(t)}),$.inidb.decr("points",e,t),a(e,t),0==h.gameState?o(e):$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.success",$.getPointsString(t))),!0)}function u(){var e,t,i=0,n=$.randElement(b);h.gameState=2,s(),$.say($.lang.get("adventuresystem.runstory",n.title,h.users.length)),t=setInterval(function(){i<n.lines.length?(e=r(n.lines[i]),""!=e&&$.say(e)):(l(),clearInterval(t)),i++},5e3)}function l(){var e,t;for(e in h.survivors)h.survivors[e].tgOwner&&(h.survivors[e].username=h.survivors[e].tgOwner),t=h.survivors[e].bet*(f/100),$.inidb.incr("adventurePayouts",h.survivors[e].username,t),$.inidb.incr("points",h.survivors[e].username,h.survivors[e].bet+t);$.say($.lang.get("adventuresystem.completed",h.survivors.length,h.caught.length)),p(),$.coolDown.set("adventure",1e3*d)}function p(){h={gameState:0,users:[],tgOwners:[],survivors:[],caught:[]}}var m=$.inidb.exists("adventureSettings","joinTime")?parseInt($.inidb.get("adventureSettings","joinTime")):60,d=$.inidb.exists("adventureSettings","coolDown")?parseInt($.inidb.get("adventureSettings","coolDown")):900,f=$.inidb.exists("adventureSettings","gainPercent")?parseInt($.inidb.get("adventureSettings","gainPercent")):30,v=$.inidb.exists("adventureSettings","minBet")?parseInt($.inidb.get("adventureSettings","minBet")):10,y=$.inidb.exists("adventureSettings","maxBet")?parseInt($.inidb.get("adventureSettings","maxBet")):1e3,c=1,S=.5,P=.25,h=1,b=[];$.bind("command",function(e){var i=e.getSender().toLowerCase(),n=e.getCommand(),s=e.getArgs(),r=s[0],a=s[1],o=parseInt(s[2]);if(n.equalsIgnoreCase("adventure")){if(!r)return void $.say($.whisperPrefix(i)+$.lang.get("adventuresystem.adventure.usage",$.pointNameMultiple));if(!isNaN(parseInt(r)))return void g(i,parseInt(r));if(r.equalsIgnoreCase("top5")&&t(),r.equalsIgnoreCase("set")){if(!$.isAdmin(i))return void $.say($.whisperPrefix(i)+$.adminMsg);if(!a||isNaN(o))return void $.say($.whisperPrefix(i)+$.lang.get("adventuresystem.set.usage"));a.equalsIgnoreCase("joinTime")&&(m=o,$.inidb.set("adventureSettings","joinTime",o)),a.equalsIgnoreCase("coolDown")&&(d=o,$.inidb.set("adventureSettings","coolDown",o)),a.equalsIgnoreCase("gainPercent")&&(f=o,$.inidb.set("adventureSettings","gainPercent",o)),a.equalsIgnoreCase("minBet")&&(v=o,$.inidb.set("adventureSettings","minBet",o)),a.equalsIgnoreCase("maxBet")&&(y=o,$.inidb.set("adventureSettings","maxBet",o)),$.say($.whisperPrefix(i)+$.lang.get("adventuresystem.set.success",a,o))}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./games/adventureSystem.js")&&(p(),e(),$.registerChatCommand("./games/adventureSystem.js","adventure",7))})}();
