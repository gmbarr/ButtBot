!function(){function e(e){var s=(Packages.com.gmt2001.HttpResponse,Packages.com.gmt2001.HttpRequest),a=Packages.java.util.HashMap,t=s.getData(s.RequestType.GET,e,"",new a);return t.content}function s(e,s){e=e.toLowerCase(),s=s.toLowerCase(),$.inidb.exists("pricecom",s)&&parseInt($.inidb.get("pricecom",s))>0&&($.isMod(e)||($.inidb.incr("points",e,$.inidb.get("pricecom",s)),$.inidb.SaveAll()))}function a(s,a,t,m,n){var i,P,j,E,I,R,N=Packages.org.json.JSONObject,M="",G="",O="",S="",s=s+"",q=a.getSender(),L=a.getArgs();if(-1!=s.indexOf("(touser)")&&(P=L[0]?L[0]:q),-1!=s.indexOf("(price)")&&(j=null==$.inidb.get("pricecom",t)?0:$.inidb.get("pricecom",t)),-1!=s.indexOf("(count)")&&$.inidb.incr("commandCount",t,1),E=s.match(r)){if(-1!=E[1].indexOf("$1"))for(var T=1;9>=T&&-1!=E[1].indexOf("$"+T);T++){if(!L[T-1])return $.lang.get("customcommands.customapi.404",t);E[1]=E[1].replace("$"+T,L[T-1])}O=e(E[1])}if(E=s.match(o)){if(-1!=E[1].indexOf("$1"))for(var T=1;9>=T&&-1!=E[1].indexOf("$"+T);T++){if(!L[T-1])return $.lang.get("customcommands.customapi.404",t);E[1]=E[1].replace("$"+T,L[T-1])}G=e(E[1]),I=E[2].split(" ");for(var A=0;A<I.length;A++)if(I[A].startsWith("{")&&I[A].endsWith("}"))O+=" "+I[A].match(d)[1];else if(I[A].startsWith("{")&&!I[A].endsWith("}")){for(S="";!I[A].endsWith("}");)S+=I[A++]+" ";S+=I[A],O+=" "+S.match(d)[1]}else if(R=I[A].split("."),1==R.length){try{M=new N(G).getString(R[0])}catch(W){if(-1==W.message.indexOf("not a string"))return $.lang.get("customcommands.customapijson.err",t);try{M=i.getInt(R[0])}catch(W){return $.lang.get("customcommands.customapijson.err",t)}}O+=" "+M}else{for(var T=0;T<R.length-1;T++)i=0==T?new N(G).getJSONObject(R[T]):i.getJSONObject(R[T]);try{M=i.getString(R[T])}catch(W){if(-1==W.message.indexOf("not a string"))return $.lang.get("customcommands.customapijson.err",t);try{M=i.getInt(R[T])}catch(W){return $.lang.get("customcommands.customapijson.err",t)}}O+=" "+M}}if(m)for(T in m){var k=new RegExp("/"+m[T].replace(/([\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|])/g,"\\$&")+"/","ig");s=s.replace(k,n[T])}return s.match(c)?s.replace(g,$.username.resolve(a.getSender())).replace(u,$.username.resolve(P)).replace(l,"@"+$.username.resolve(a.getSender())).replace(p,a.getSender()).replace(f,$.username.resolve($.randElement($.users)[0])).replace(h,$.pointNameMultiple).replace(C,$.getStreamUptime($.channelName)).replace(x,$.getGame($.channelName)).replace(w,$.getStatus($.channelName)).replace(v,$.getFollows($.channelName)).replace(y,$.inidb.get("commandCount",t)).replace(b,j).replace(r,O).replace(o,O):s}function t(e,s,a){return $.isAdmin(e)?!0:""==a?$.getCommandGroup(s)>=$.getUserGroupId(e):$.getSubcommandGroup(s,a)>=$.getUserGroupId(e)}function m(e){return parseInt($.inidb.exists("pricecom",e)?$.inidb.get("pricecom",e):0)}function n(){var e,s=$.inidb.GetKeyList("command","");for(e in s)$.commandExists(s[e])||$.registerChatCommand("./commands/customCommands.js",s[e],7)}function i(){var e,s,a=$.inidb.GetKeyList("aliases","");for(s in a)$.commandExists(a[s])||(e=$.inidb.get("aliases",a[s]),$.registerChatCommand("./commands/customCommands.js",a[s],$.getCommandGroup(e)))}var r=new RegExp(/\(customapi\s([\w\W:\/\$\=\?\&]+)\)/),o=new RegExp(/\(customapijson ([\w\.:\/\$=\?\&]+)\s([\w\W]+)\)/),d=new RegExp(/{([\w\W]+)}/),c=new RegExp(/\(customapi|\(sender\)|\(touser\)|\(@sender\)|\(baresender\)|\(random\)|\(pointname\)|\(uptime\)|\(game\)|\(status\)|\(follows\)|\(count\)|\(price\)/),g=new RegExp(/\(sender\)/),u=new RegExp(/\(touser\)/),l=new RegExp(/\(@sender\)/),p=new RegExp(/\(baresender\)/),f=new RegExp(/\(random\)/),h=new RegExp(/\(pointname\)/),C=new RegExp(/\(uptime\)/),x=new RegExp(/\(game\)/),w=new RegExp(/\(status\)/),v=new RegExp(/\(follows\)/),y=new RegExp(/\(count\)/),b=new RegExp(/\(price\)/);$.bind("command",function(e){var s=e.getSender().toLowerCase(),t=($.username.resolve(s,e.getTags()),e.getCommand()),m=e.getArgs(),n=e.getArguments(),i=m[0],r=m[1];if(t.equalsIgnoreCase("addcom")){if(!$.isModv3(s,e.getTags()))return void $.say($.whisperPrefix(s)+$.modMsg);if(!i||!r)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.add.usage"));i=m[0].replace("!",""),n=n.substring(n.indexOf(m[0])+m[0].length()+1),$.inidb.set("command",i,n),$.registerChatCommand("./commands/customCommands.js",i),$.logEvent("./commands/customCommands.js",28,s+" added command !"+i+' with the message "'+n+'"'),$.say($.whisperPrefix(s)+$.lang.get("customcommands.add.success",i))}if(t.equalsIgnoreCase("editcom")){if(!$.isModv3(s,e.getTags()))return void $.say($.whisperPrefix(s)+$.modMsg);if(i=m[0].replace("!",""),!i||!r)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.edit.usage"));if(!$.commandExists(i))return void $.say($.whisperPrefix(s)+$.lang.get("cmd.404",i));n=n.substring(n.indexOf(m[0])+m[0].length()+1),$.inidb.set("command",i,n),$.registerChatCommand("./commands/customCommands.js",i),$.logEvent("./commands/customCommands.js",28,s+" edited the command !"+i+' with the message "'+n+'"'),$.say($.whisperPrefix(s)+$.lang.get("customcommands.edit.success",i))}if(t.equalsIgnoreCase("delcom")){if(!$.isModv3(s,e.getTags()))return void $.say($.whisperPrefix(s)+$.modMsg);if(!m[0])return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.delete.usage"));if(i=m[0].replace("!",""),!i)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.delete.usage"));if(!$.inidb.exists("command",i))return void $.say($.whisperPrefix(s)+$.lang.get("cmd.404",i));$.inidb.del("command",i),$.inidb.del("permcom",i),$.unregisterChatCommand("./commands/customCommands.js",i),$.logEvent("./commands/customCommands.js",28,s+" deleted the command !"+i),$.say($.whisperPrefix(s)+$.lang.get("customcommands.delete.success",i))}if(t.equalsIgnoreCase("aliascom")){if(!$.isModv3(s,e.getTags()))return void $.say($.whisperPrefix(s)+$.modMsg);if(!i||!r)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.alias.usage"));if(!$.commandExists(i))return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.alias.error.target404"));if(i=m[0].replace("!",""),r=m[1].replace("!",""),$.inidb.exists("aliases",r))return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.alias.error"));$.inidb.set("aliases",r,i),$.registerChatCommand("./commands/customCommands.js",r),$.logEvent("customCommands.js",59,s+' added alias "!'+r+'" for "!'+i+'"'),$.say($.whisperPrefix(s)+$.lang.get("customcommands.alias.success",i,r))}if(t.equalsIgnoreCase("delalias")){if(!$.isModv3(s,e.getTags()))return void $.say($.whisperPrefix(s)+$.modMsg);if(!i||!r)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.alias.delete.usage"));if(!$.inidb.exists("alias",i))return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.alias.delete.error.alias.404"));i=m[0].replace("!",""),$.unregisterChatCommand(i),$.inidb.del("aliases",i),$.logEvent("customCommands.js",56,s+" deleted alias !"+i),$.say($.whisperPrefix(s)+$.lang.get("customcommands.delete.success",i))}if(t.equalsIgnoreCase("permcom")){if(!$.isAdmin(s))return void $.say($.whisperPrefix(s)+$.adminMsg);if(!i||!r)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.set.perm.usage"));if(i=m[0].replace("!",""),2==m.length){var o=m[1];if(isNaN(parseInt(o))&&(o=$.getGroupIdByName(o)),!$.commandExists(i))return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.set.perm.404",i));$.inidb.set("permcom",i,o),$.say($.whisperPrefix(s)+$.lang.get("customcommands.set.perm.success",i,$.getGroupNameById(o))),$.updateCommandGroup(i,o)}var d=m[1],o=m[2];if(isNaN(parseInt(o))&&(o=$.getGroupIdByName(o)),!$.subCommandExists(i,d))return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.set.perm.404",i+" "+d));$.inidb.set("permcom",i+" "+d,o),$.say($.whisperPrefix(s)+$.lang.get("customcommands.set.perm.success",i+" "+d,$.getGroupNameById(o))),$.updateSubcommandGroup(i,d,o)}if(t.equalsIgnoreCase("pricecom")){if(!$.isAdmin(s))return void $.say($.whisperPrefix(s)+$.adminMsg);if(!i||!r)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.set.price.usage"));if(!$.commandExists(i))return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.set.price.error.404"));if(isNaN(parseInt(r))||parseInt(r)<0)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.set.price.error.invalid"));i=m[0].replace("!",""),$.inidb.set("pricecom",i,r),list=$.inidb.GetKeyList("aliases","");for(c in list)for(c in list)$.inidb.get("aliases",list[c]).equalsIgnoreCase(i)&&$.inidb.set("pricecom",list[c],r);$.say($.whisperPrefix(s)+$.lang.get("customcommands.set.price.success",i,r,$.pointNameMultiple))}if(t.equalsIgnoreCase("listtags")){if(!$.isAdmin(s))return void $.say($.whisperPrefix(s)+$.adminMsg);$.say($.whisperPrefix(s)+"Command tags: (sender), (@sender), (baresender), (random), (uptime), (game), (status), (follows), (count), (touser), (price), (pointname), (customapi) (customjsonapi)")}if(t.equalsIgnoreCase("commands")){var c,g=$.inidb.GetKeyList("command",""),u="";for(c in g)u+="!",u+=g[c],u+=", ";if(0!=u.length)return void $.say($.whisperPrefix(s)+$.lang.get("customcommands.cmds",u))}$.inidb.exists("command",t.toLowerCase())&&(r=$.inidb.get("command",t.toLowerCase()),$.say(a(r,e,t.toLowerCase())))}),$.bind("initReady",function(){$.bot.isModuleEnabled("./commands/customCommands.js")&&(n(),i(),$.registerChatCommand("./commands/customCommands.js","addcom",2),$.registerChatCommand("./commands/customCommands.js","pricecom",2),$.registerChatCommand("./commands/customCommands.js","aliascom",2),$.registerChatCommand("./commands/customCommands.js","delalias",2),$.registerChatCommand("./commands/customCommands.js","delcom",2),$.registerChatCommand("./commands/customCommands.js","editcom",2),$.registerChatCommand("./commands/customCommands.js","permcom",1),$.registerChatCommand("./commands/customCommands.js","listtags",2),$.registerChatCommand("./commands/customCommands.js","commands",7))}),$.returnCommandCost=s,$.replaceCommandTags=a,$.permCom=t,$.getCommandPrice=m}();
